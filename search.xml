<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>[Flutter]flutteråŸºç¡€ä¹‹Dartè¯­è¨€åŸºç¡€(ä¸€)</title>
    <url>/content/f7be53c4.html</url>
    <content><![CDATA[<h4 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h4><p>Dart æ˜¯ Google å…¬å¸åœ¨2011å¹´10æœˆå‘å¸ƒçš„ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œä¸»è¦æ˜¯å°†å…¶ä½œä¸ºä¸€ç§ç»“æ„åŒ–çš„ Web å¼€å‘è¯­è¨€ã€‚å¯ä»¥ç”¨åœ¨Webã€æœåŠ¡å™¨ã€ç§»åŠ¨åº”ç”¨å’Œç‰©è”ç½‘ç­‰é¢†åŸŸçš„å¼€å‘ï¼Œæ˜¯å®½æ¾å¼€æºè®¸å¯è¯ï¼ˆä¿®æ”¹çš„BSDè¯ä¹¦ï¼‰ä¸‹çš„å¼€æºè½¯ä»¶ã€‚å®˜æ–¹ç½‘ç«™ï¼š<a href="https://dart.dev/" target="_blank" rel="noopener">https://dart.dev/</a> ã€‚</p>
<p>åœ¨ Dart ä¸­ï¼Œæ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯å¯¹è±¡ï¼Œå˜é‡ï¼Œæ•°å­—ï¼Œå‡½æ•°ç­‰éƒ½æ˜¯å¯¹è±¡ç±»å‹ï¼Œéƒ½æ˜¯ç±»çš„å®ä¾‹ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½ç»§æ‰¿è‡ª <code>Object</code> ç±»ã€‚</p>
<a id="more"></a>

<p>åœ¨è¿›è¡Œ Dart å¼€å‘å‰ï¼Œéœ€è¦å®‰è£… Dart SDKï¼Œå®‰è£…æ–¹æ³•å®˜ç½‘ç½‘ç«™æœ‰ä»‹ç»ï¼Œåœ°å€ä¸ºï¼š<a href="https://dart.dev/get-dart" target="_blank" rel="noopener">https://dart.dev/get-dart</a> ã€‚å¦‚ç›´æ¥è¿›è¡Œ Flutter å¼€å‘ï¼Œä¹Ÿå¯ä¸ç”¨ä¸‹è½½æ­¤ SDK ï¼Œç›´æ¥å®‰è£… Flutter å³å¯ã€‚Flutterå¼€å‘å·¥å…·åŒ…ä¸­åŒ…å« Dartã€‚</p>
<h4 id="äºŒã€è¯­æ³•åŸºç¡€"><a href="#äºŒã€è¯­æ³•åŸºç¡€" class="headerlink" title="äºŒã€è¯­æ³•åŸºç¡€"></a>äºŒã€è¯­æ³•åŸºç¡€</h4><h5 id="1-å…¥å£æ–¹æ³•"><a href="#1-å…¥å£æ–¹æ³•" class="headerlink" title="1. å…¥å£æ–¹æ³•"></a>1. å…¥å£æ–¹æ³•</h5><p>Dart è¯­è¨€æ–‡ä»¶æ ¼å¼ä¸º <code>.dart</code> ï¼Œå¹¶ä»¥ <code>main</code> æ–¹æ³•ä½œä¸ºç¨‹åºçš„å…¥å£ç‚¹ï¼Œæˆ‘ä»¬ä½¿ç”¨ VSCode åˆ›å»º <code>demo1.dart</code> æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(<span class="string">'hello dart!'</span>);  <span class="comment">//è¾“å‡ºç»“æœï¼šhello dart!</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>Dart è¯­è¨€æœ‰å¾ˆå¤šç®€å†™å½¢å¼ï¼Œä»¥ä¸Šçš„ <code>main</code> æ–¹æ³•å°±æ˜¯ç®€å†™ï¼Œå®Œæ•´çš„å†™æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> main(<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; args)&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(<span class="string">'hello dart!'</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>å‚æ•°ä¸ºæ³›å‹çš„å†™æ³•ï¼Œ<code>List</code> ä¸ºåˆ—è¡¨ï¼Œä¹Ÿå°±æ˜¯å…¶ä»–è¯­è¨€ä¸­çš„æ•°ç»„ã€‚ <code>main</code> æ–¹æ³•å¯ä»¥æ¥æ”¶ç”±å‘½ä»¤è¡Œè¾“å…¥çš„å‚æ•°ï¼Œå¯ä»¥é€šè¿‡ <code>args</code> å‚æ•°åœ¨ç¨‹åºä¸­è·å–ã€‚å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> main(<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; args)&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(<span class="string">'hello dart!'</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(args);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>é€šè¿‡å‘½ä»¤è¡Œçš„æ–¹å¼è¿è¡Œ <code>dart</code> æ–‡ä»¶ï¼Œé¦–å…ˆ <code>cd</code> åˆ°ç›®æ ‡æ–‡ä»¶å¤¹ï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š <code>dart demo1.dart arg1,arg2</code> ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">hello dart!</span></pre></td></tr><tr><td class="code"><pre><span class="line">[arg1,arg2]</span></pre></td></tr></table></figure>

<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½¿ç”¨çœç•¥æ–¹å¼å³å¯ã€‚</p>
<p>åœ¨ Dart ä¸­ï¼Œ<code>print</code> æ–¹æ³•ä¸æ”¯æŒå¤šå‚æ•°æ‰“å°ï¼Œå…¶å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="built_in">print</span>(<span class="built_in">Object</span> object);</span></pre></td></tr></table></figure>

<p>åªæ”¯æŒå•å‚æ•°æ‰“å°ï¼Œä½†æ˜¯å¯ä»¥åˆ©ç”¨å­—ç¬¦ä¸²æ’å€¼çš„æ–¹å¼è¿›è¡Œå¤šå‚æ•°æ‰“å°ï¼Œä½¿ç”¨ <code>$</code> ç¾å…ƒç¬¦å·ï¼Œæ¯”å¦‚æ‰“å° a, bä¸¤ä¸ªå˜é‡ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">"<span class="subst">$a</span> <span class="subst">$b</span>"</span>);</span></pre></td></tr></table></figure>

<p>ä»¥ä¸Šæ˜¯åˆ©ç”¨å­—ç¬¦ä¸²æ’å€¼è¿›è¡Œå¤šå‚æ•°æ‰“å°ï¼Œä½†å®è´¨ä¸Šä¾ç„¶æ˜¯å•å‚æ•°ï¼Œåªä¸è¿‡åˆ©ç”¨äº†å­—ç¬¦ä¸²çš„æ’å€¼ç‰¹æ€§è¾“å‡ºå¤šä¸ªå‚æ•°è€Œå·²ã€‚å½“ç„¶ä¾ç„¶å¯ä»¥åˆ©ç”¨å¤šä¸ª <code>print</code> æ‰“å°å¤šä¸ªå‚æ•°ã€‚</p>
<h5 id="2-æ•°æ®ç±»å‹"><a href="#2-æ•°æ®ç±»å‹" class="headerlink" title="2. æ•°æ®ç±»å‹"></a>2. æ•°æ®ç±»å‹</h5><p>Dart ä¸­æ‰€æœ‰ç±»å‹éƒ½æ˜¯å¯¹è±¡ï¼ŒåŸºç¡€æ•°æ®ç±»å‹ä¹Ÿæ˜¯å¯¹è±¡ï¼Œéƒ½æœ‰è‡ªå·±çš„æ–¹æ³•å’Œå±æ€§ã€‚Dart æ”¯æŒè‡ªåŠ¨ç±»å‹æ¨æ–­ï¼Œæ‰€ä»¥åœ¨å®šä¹‰æ•°æ®ç±»å‹çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼è¿›è¡Œå®šä¹‰ï¼Œç›´æ¥ä½¿ç”¨å…·ä½“æ•°æ®ç±»å‹å®šä¹‰å’Œä½¿ç”¨ <code>var</code> å…³é”®å­—è¿›è¡Œå®šä¹‰ã€‚å½“ä½¿ç”¨ <code>var</code> å®šä¹‰æ—¶ï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ®å…·ä½“çš„èµ‹å€¼æ•°æ®ç±»å‹æ¨æ–­å‡ºå®šä¹‰çš„å˜é‡æˆ–å¸¸é‡çš„æ•°æ®ç±»å‹ã€‚</p>
<p> å¯ä»¥ä½¿ç”¨ <code>runtimeType</code> æ¥æŸ¥çœ‹å¯¹è±¡çš„è¿è¡Œæ—¶ç±»å‹ã€‚</p>
<p>å› ä¸º Dart ä¸­æ‰€æœ‰çš„ç±»å‹éƒ½æ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥å®šä¹‰ä¸€ä¸ªæ•°æ®ç±»å‹ä»¥åï¼Œå¦‚æœæœªå¯¹å…¶è¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼Œåˆ™å…¶é»˜è®¤å€¼ä¸º<code>null</code> ã€‚</p>
<p>Dart ä¸­ï¼Œå˜é‡æ˜¯åŒºåˆ†å¤§å°å†™çš„ã€‚</p>
<p>*<em>2.1.1 æ•°å€¼ç±»å‹ (Numbers) *</em></p>
<p>Dart ä¸­æ•°å€¼ç±»å‹æœ‰ä¸¤ç§ï¼Œæ•´æ•°( <code>int</code> )å’Œå°æ•°( <code>double</code>)ï¼Œä»–ä»¬ç»§æ‰¿è‡ª <code>num</code> ç±»ã€‚ä½¿ç”¨ç›´æ¥æ•°æ®ç±»å‹å®šä¹‰æ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">int</span> a = <span class="number">10</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">double</span> b = <span class="number">20.1</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(a);  <span class="comment">//è¾“å‡º10</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(b);  <span class="comment">//è¾“å‡º20.1</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(a+b);<span class="comment">////<span class="markdown">è¾“å‡º30.1</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼å®šä¹‰ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> a = <span class="number">10</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> b = <span class="number">20.1</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(a);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(b);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(a+b);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(a.runtimeType);  <span class="comment">//è¾“å‡ºint</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœä¸ä¸Šé¢ç›¸åŒï¼Œä¸‹é¢çš„æ–¹å¼ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ¨æ–­å‡ºå…·ä½“çš„æ•°æ®ç±»å‹ã€‚</p>
<p>Dart ä¸­å¯ä»¥ä½¿ç”¨åè¿›åˆ¶å’Œåå…­è¿›åˆ¶è¿›è¡Œæ•´æ•°çš„èµ‹å€¼ï¼Œä¸èƒ½ä½¿ç”¨å…¶ä»–è¿›åˆ¶ã€‚</p>
<p><strong>2.1.2 å­—ç¬¦ä¸²ç±»å‹ (Strings)</strong> </p>
<p>ä½¿ç”¨å…³é”®å­— <code>String</code> æ¥å£°æ˜å­—ç¬¦ä¸²ç±»å‹ï¼Œå­—ç¬¦ä¸²ä½¿ç”¨å•å¼•å·æˆ–åŒå¼•å·åŒ…èµ·æ¥ï¼ŒDart ä¸­å­—ç¬¦ä¸²æ˜¯UTF-16ç¼–ç ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">String</span> str1 = <span class="string">'hello dart!'</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> str2 = <span class="string">"hello world!"</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(<span class="string">'<span class="subst">$str1</span> <span class="subst">$str2</span>'</span>);  <span class="comment">//è¾“å‡º hello dart! hello world!</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥åœ¨å®šä¹‰ä¸€ä¸ªå˜é‡çš„åŒæ—¶ç›´æ¥èµ‹å€¼å¤šä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">String</span> str = <span class="string">'hello dart! '</span> <span class="string">'this is'</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">   <span class="string">" a string"</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(str);  <span class="comment">//è¾“å‡º hello dart! this is a string</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå˜é‡ï¼Œä½†æ˜¯èµ‹å€¼äº†ä¸‰ä¸ªå­—ç¬¦ä¸²ï¼Œç¼–è¯‘å™¨ä¼šå°†ä¸‰ä¸ªå­—ç¬¦ä¸²åˆå¹¶ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²è¿›è¡Œå¤„ç†ã€‚ä½†æ˜¯è™½ç„¶æˆ‘ä»¬åˆ†ä¸¤è¡Œä¹¦å†™çš„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯åœ¨è¾“å‡ºæ—¶å¹¶æ²¡æœ‰åˆ†è¡Œï¼Œä¹Ÿå°±æ˜¯å®šä¹‰ä¸è¾“å‡ºçš„æ ¼å¼å¹¶ä¸ä¸€æ ·ï¼Œå¦‚æœéœ€è¦å®šä¹‰ä¸è¾“å‡ºä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="comment">//1.é€šè¿‡è½¬ä¹‰å­—ç¬¦\nè¿›è¡Œæ¢è¡Œæ“ä½œ</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">String</span> str = <span class="string">"hello dart! \nthis is a string "</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(str);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="comment">//2.é€šè¿‡```æˆ–"""å°†å­—ç¬¦ä¸²åŒ…è£¹èµ·æ¥ä¸ºå¤šè¡Œå­—ç¬¦ä¸²ï¼Œä½¿ç”¨æ­¤æ–¹å¼æ—¶ï¼Œéœ€æ³¨æ„å­—ç¬¦ä¸²çš„å¯¹é½æ–¹å¼ï¼Œå­—ç¬¦çš„å‰é¢çš„ç©ºæ ¼ä¼šåŒ…å«åœ¨å†…ï¼Œå·¦è¾¹ç•Œä¸ºç¼–è¯‘å™¨çš„è¡Œå¤´</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> str1 = <span class="string">'''hello dart! </span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="string">  this is a string'''</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(str1);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">hello dart! </span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">this</span> is a <span class="keyword">string</span> </span></pre></td></tr><tr><td class="code"><pre><span class="line">hello dart! </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">this</span> is a <span class="keyword">string</span></span></pre></td></tr></table></figure>

<p>å¯ä»¥ä½¿ç”¨åŠ å·å’Œæ’å€¼çš„æ–¹å¼è¿›è¡Œæ‹¼æ¥ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">String</span> a = <span class="string">"hello"</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">String</span> b = <span class="string">" dart!"</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(a + b);  <span class="comment">//è¾“å‡º hello dart!</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(<span class="string">"<span class="subst">$a</span><span class="subst">$b</span>"</span>); <span class="comment">//è¾“å‡º hello dart!</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>ä½¿ç”¨å­—ç¬¦ä¸²æ’å€¼çš„æ–¹å¼è¿›è¡Œæ‹¼æ¥æ—¶ï¼Œå¦‚æœ <code>$</code> åä¸ºä¸€ä¸ªæ ‡è¯†ç¬¦åˆ™å¯ç›´æ¥ä½¿ç”¨ï¼Œå¦‚æœä¸ºè¡¨è¾¾å¼åˆ™éœ€è¦ä½¿ç”¨ <code>{}</code> å°†è¡¨è¾¾å¼åŒ…å«èµ·æ¥ï¼Œå¦‚ä¸‹:</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">String</span> a = <span class="string">"hello"</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">String</span> b = <span class="string">" dart!"</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(a + b);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(<span class="string">"<span class="subst">$&#123;a.runtimeType&#125;</span> <span class="subst">$&#123;b.runtimeType&#125;</span>"</span>); <span class="comment">//æ­¤å¤„éœ€è¦ä½¿ç”¨&#123;&#125;å°†è¡¨è¾¾å¼åŒ…å«èµ·æ¥ä½œä¸ºä¸€ä¸ªæ ‡è¯†ç¬¦ä½¿ç”¨</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>åœ¨ Dart ä¸­ï¼Œå­—ç¬¦ä¸²ä¹Ÿæ˜¯ä¸€ç§é›†åˆç±»å‹ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è·å–å­—ç¬¦ä¸²ä¸­çš„å•ä¸ªå­—ç¬¦ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">String</span> str = <span class="string">"hello dart!"</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(str[<span class="number">0</span>]);  <span class="comment">//è¾“å‡º h</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(str[<span class="number">4</span>]);  <span class="comment">//è¾“å‡º o</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>ä¸‹æ ‡ä»0å¼€å§‹ã€‚</p>
<p>ä¹Ÿå¯ä»¥é€šè¿‡ <code>*</code> è¿ç®—ç¬¦å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ‹·è´æ“ä½œï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">String</span> str = <span class="string">"hello dart!"</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(str*<span class="number">2</span>);  <span class="comment">//è¾“å‡º hello dart!hello dart!</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>ä½¿ç”¨å¦‚ä¸‹æ–¹å¼åŸæ ·è¾“å‡ºå­—ç¬¦ä¸²ï¼ŒåŒ…æ‹¬é‡Œé¢çš„è½¬ä¹‰å­—ç¬¦ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> str = <span class="string">r"this is a \n string!"</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(str);  <span class="comment">//è¾“å‡º this is a \n string!</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>



<p><strong>2.1.3 å¸ƒå°”ç±»å‹ (Booleans)</strong></p>
<p>Dart ä¸­ï¼Œå¸ƒå°”ç±»å‹åªæœ‰ä¸¤ä¸ªå­—é¢é‡å€¼ï¼š<code>true</code> å’Œ <code>false</code> ã€‚</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">bool</span> a = <span class="keyword">true</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> b = <span class="keyword">false</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(<span class="string">"<span class="subst">$a</span> <span class="subst">$b</span>"</span>);  <span class="comment">//è¾“å‡º true false</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(b.runtimeType);  <span class="comment">//è¾“å‡º bool</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>ä¸Šé¢è¯´è¿‡ï¼ŒDartä¸­æ‰€æœ‰çš„ç±»å‹éƒ½æ˜¯å¯¹è±¡ï¼Œå¦‚æœåœ¨å®šä¹‰ <code>bool</code> ç±»å‹æ—¶ï¼Œæ²¡æœ‰è¿›è¡Œåˆå§‹åŒ–ï¼Œåˆ™å…¶é»˜è®¤å€¼ä¸º <code>null</code>ï¼Œåœ¨è¿›è¡Œæ¡ä»¶åˆ¤æ–­æ—¶ä¼šæŠ¥å¼‚å¸¸ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line"> <span class="built_in">bool</span> c;</span></pre></td></tr><tr><td class="code"><pre><span class="line"> <span class="keyword">if</span>(c) &#123;   </span></pre></td></tr><tr><td class="code"><pre><span class="line">   <span class="built_in">print</span>(c);</span></pre></td></tr><tr><td class="code"><pre><span class="line"> &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç ç¼–è¯‘ä¸ä¼šæŠ¥é”™ï¼Œè¿è¡Œæ—¶ä¼šæŠ¥å¦‚ä¸‹å¼‚å¸¸ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">Unhandled exception:</span></pre></td></tr><tr><td class="code"><pre><span class="line">Failed assertion: boolean expression must <span class="keyword">not</span> be <span class="literal">null</span></span></pre></td></tr></table></figure>

<p>æ‰€ä»¥åœ¨ä½¿ç”¨ <code>bool</code> ç±»å‹è¿›è¡Œæ¡ä»¶åˆ¤æ–­æ—¶ï¼Œå¦‚æœæœ‰ä¸ºç©ºçš„å¯èƒ½åº”å…ˆè¿›è¡Œæ˜¯å¦ä¸º <code>null</code> çš„åˆ¤æ–­ï¼Œå¹¶ä¸” Dart ä¸­çš„æ¡ä»¶åˆ¤æ–­å¿…é¡»ä½¿ç”¨ <code>bool</code> ç±»å‹ï¼Œå…¶ä»–ç±»å‹ä¼šç¼–è¯‘é”™è¯¯ã€‚ </p>
<p><strong>2.1.4 é›†åˆç±»å‹</strong></p>
<p><strong>åˆ—è¡¨ (Lists)</strong></p>
<p>åˆ—è¡¨ç”¨æ¥å­˜æ”¾ä¸€ç»„æ•°æ®ï¼Œåœ¨å¾ˆå¤šå…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œåˆ—è¡¨ä¹Ÿè¢«ç§°ä¸ºæ•°ç»„ï¼Œæ‰€ä»¥ä¸å…¶ä»–è¯­è¨€ä¸€æ ·ï¼Œä¸‹æ ‡ä»0å¼€å§‹ï¼Œæœ€åä¸€ä¸ªæ•°æ®å…ƒç´ çš„ä¸‹æ ‡ä¸º <code>lenght-1</code> ã€‚åˆ—è¡¨çš„å…·ä½“æ•°æ®ç±»å‹ç”±å…¶ä¸­çš„å…ƒç´ ç±»å‹å†³å®šï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> arr  = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> arr1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="string">"string"</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">List</span> arr2 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">List</span> arr3 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="string">"string"</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(<span class="string">"<span class="subst">$arr</span> \t\t\t <span class="subst">$&#123;arr.runtimeType&#125;</span>"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(<span class="string">"<span class="subst">$arr1</span> \t <span class="subst">$&#123;arr1.runtimeType&#125;</span>"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(<span class="string">"<span class="subst">$arr2</span> \t\t\t <span class="subst">$&#123;arr2.runtimeType&#125;</span>"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(<span class="string">"<span class="subst">$arr3</span> \t <span class="subst">$&#123;arr3.runtimeType&#125;</span>"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] 					 List&lt;<span class="keyword">int</span>&gt;</span></pre></td></tr><tr><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="keyword">string</span>] 	 List&lt;Object&gt;</span></pre></td></tr><tr><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] 					 List&lt;dynamic&gt;</span></pre></td></tr><tr><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="keyword">string</span>] 	 List&lt;dynamic&gt;</span></pre></td></tr></table></figure>

<p>ä»¥ä¸Šæ–¹å¼ç›´æ¥åˆ›å»º <code>List</code> å¹¶è¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼Œå®šä¹‰ç©ºåˆ—è¡¨ï¼Œä½¿ç”¨ <code>var arr = [];</code> å³å¯ã€‚éœ€è¦æ³¨æ„å¦‚æœä¸è¿›è¡Œåˆå§‹åŒ–ï¼Œå…¶æ•°æ®ç±»å‹ä¸º <code>null</code> ï¼Œå³ä¾¿ä½¿ç”¨ <code>List arr;</code> å®šä¹‰ï¼Œå…¶ <code>runtimeType</code> ç±»å‹ä¹Ÿä¸º <code>Null</code> ã€‚</p>
<p>ä¹Ÿå¯ä½¿ç”¨æ„é€ æ–¹æ³•åˆ›å»ºæ•°ç»„ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> arr = <span class="keyword">new</span> <span class="built_in">List</span>();   <span class="comment">//åˆ›å»ºç©ºåˆ—è¡¨</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> arr1 = <span class="keyword">new</span> <span class="built_in">List</span>(<span class="number">3</span>); <span class="comment">//åˆ›å»ºé•¿åº¦ä¸º3çš„åˆ—è¡¨ï¼Œä½¿ç”¨nullå¡«å……</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> arr2 = <span class="keyword">new</span> <span class="built_in">List</span>.filled(<span class="number">3</span>, <span class="number">1</span>); <span class="comment">//åˆ›å»ºé•¿åº¦ä¸º3çš„åˆ—è¡¨ï¼Œå¹¶ä½¿ç”¨æ•´å½¢æ•°æ®1å¡«å……</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> arr3 = <span class="keyword">new</span> <span class="built_in">List</span>.filled(<span class="number">3</span>, <span class="string">"a"</span>); <span class="comment">//åˆ›å»ºé•¿åº¦ä¸º3çš„åˆ—è¡¨ï¼Œå¹¶ä½¿ç”¨å­—ç¬¦ä¸²aå¡«å……</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(<span class="string">"<span class="subst">$arr</span> \t <span class="subst">$&#123;arr.runtimeType&#125;</span>"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(<span class="string">"<span class="subst">$arr1</span> \t <span class="subst">$&#123;arr1.runtimeType&#125;</span>"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(<span class="string">"<span class="subst">$arr2</span> \t <span class="subst">$&#123;arr2.runtimeType&#125;</span>"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(<span class="string">"<span class="subst">$arr3</span> \t <span class="subst">$&#123;arr3.runtimeType&#125;</span>"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">[] 	 									List&lt;dynamic&gt;</span></pre></td></tr><tr><td class="code"><pre><span class="line">[<span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>] 	  List&lt;dynamic&gt;</span></pre></td></tr><tr><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>] 					  List&lt;<span class="keyword">int</span>&gt;</span></pre></td></tr><tr><td class="code"><pre><span class="line">[a, a, a] 					  List&lt;String&gt;</span></pre></td></tr></table></figure>

<p>åœ¨ Dart ä¸­ï¼Œå¯æ˜¯çœç•¥ <code>new</code> å…³é”®å­—ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> arr = <span class="built_in">List</span>(<span class="number">2</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  arr[<span class="number">0</span>] = <span class="number">10</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  arr[<span class="number">1</span>] = <span class="string">"str"</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(<span class="string">"<span class="subst">$arr</span> \t <span class="subst">$&#123;arr.runtimeType&#125;</span>"</span>);   <span class="comment">//è¾“å‡º [10, str] 	 List&lt;dynamic&gt;</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(arr.length);  <span class="comment">//è¾“å‡º 2</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>ä»¥ä¸Šåˆ›å»ºçš„åˆ—è¡¨éƒ½æ˜¯å¯å­˜æ”¾ä»»æ„ç±»å‹çš„æ•°æ®çš„ï¼Œå¦‚æœæƒ³å­˜æ”¾å›ºå®šç±»å‹çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨æ³›å‹è¿›è¡Œæ•°æ®ç±»å‹çº¦æŸï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; arr = [<span class="string">"str1"</span>, <span class="string">"str2"</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(arr);  <span class="comment">//è¾“å‡º [str1, str2]</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> arr1 = <span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt;();</span></pre></td></tr><tr><td class="code"><pre><span class="line">  arr1.add(<span class="number">1</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  arr1.add(<span class="number">2</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(arr1);  <span class="comment">//è¾“å‡º [1, 2]</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>åˆ›å»ºå›ºå®šæ•°æ®ç±»å‹çš„åˆ—è¡¨ï¼Œå¦‚æœæ·»åŠ å…¶ä»–æ•°æ®ç±»å‹æ•°æ®ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚</p>
<p><strong>é›†åˆ (Sets)</strong></p>
<p><code>Set</code> ä¸ <code>List</code> ç±»ä¼¼ï¼Œä½†æ˜¯ <code>Set</code> ä¸ºæ— åºåˆ—è¡¨ï¼Œæ‰€ä»¥ä¸èƒ½é€šè¿‡ä¸‹æ ‡çš„æ–¹å¼è¿›è¡Œè®¿é—®ã€‚ <code>Set</code> ä¸­ä¸èƒ½æœ‰é‡å¤æ•°æ®ï¼Œå¦‚æœå­˜åœ¨é‡å¤æ•°æ®ï¼Œåªä¼šä¿ç•™ä¸€ä»½æ•°æ®ã€‚ä¾é æ­¤ç‰¹æ€§ï¼Œä¸€èˆ¬ä½¿ç”¨ <code>Set</code> æ¥å¯¹åˆ—è¡¨è¿›è¡Œå»é‡å¤„ç†ã€‚</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">Set</span> <span class="keyword">set</span> = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>&#125;;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(<span class="keyword">set</span>);   <span class="comment">//è¾“å‡º &#123;1, 2, 3, 4&#125;</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> set1 = &#123;<span class="string">"str1"</span>, <span class="string">"str2"</span>, <span class="string">"str1"</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>&#125;;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(set1);  <span class="comment">//è¾“å‡º &#123;str1, str2, 1, 2, 3&#125;</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> set2 = <span class="built_in">Set</span>();</span></pre></td></tr><tr><td class="code"><pre><span class="line">  set2.add(<span class="number">1</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  set2.add(<span class="number">2</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  set2.add(<span class="number">2</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  set2.add(<span class="string">"str"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(set2);  <span class="comment">//è¾“å‡º &#123;1, 2, str&#125;</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">Set</span>&lt;<span class="built_in">int</span>&gt; set3 = <span class="built_in">Set</span>();</span></pre></td></tr><tr><td class="code"><pre><span class="line">  set3.add(<span class="number">1</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="comment">// set3.add("str");  //é”™è¯¯</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(set3);  <span class="comment">//è¾“å‡º &#123;1&#125;</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">Set</span> set4 = <span class="built_in">Set</span>&lt;<span class="built_in">String</span>&gt;();</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(set4);  <span class="comment">//è¾“å‡º &#123;&#125;</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>æ•°ç»„å»é‡å¤„ç†ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">4</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">Set</span> <span class="keyword">set</span> = <span class="built_in">Set</span>.from(arr);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> arr1 = <span class="built_in">List</span>.from(<span class="keyword">set</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(arr1);  <span class="comment">//è¾“å‡º [1, 2, 3, 4, 5, 6]</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>



<p><strong>å­—å…¸ (Maps)</strong></p>
<p>å­—å…¸æ˜¯ä¸€ç»„é”®å€¼å¯¹çš„é›†åˆï¼Œå¯ä»¥é€šè¿‡é”®å®Œæˆå¯¹å€¼çš„ä¿®æ”¹ã€æŸ¥æ‰¾ã€æ·»åŠ æˆ–åˆ é™¤æ“ä½œï¼Œå…¶ä¸­ï¼Œé”®( key ) å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚åˆ›å»º Map ç±»å‹ï¼Œé”® (key) ä¸å€¼ (value) è¦æˆå¯¹å‡ºç°ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé”®éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œä½†æ˜¯ Dart ä¸­å¹¶æ²¡æœ‰ä¸¥æ ¼çº¦æŸé”®çš„æ•°æ®ç±»å‹ï¼Œæ‰€ä»¥é”®å¯ä»¥ä¸ºä»»æ„ç±»å‹ï¼Œå€¼ä¹Ÿå¯ä»¥ä¸ºä»»æ„ç±»å‹ã€‚å¦‚æœéœ€è¦åˆ›å»ºå›ºå®šç±»å‹çš„é”®å€¼ï¼Œå¯é€šè¿‡æ³›å‹è¿›è¡Œçº¦æŸã€‚</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> map1 = &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="string">"name"</span> : <span class="string">"zhangsan"</span>,</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="string">"age"</span> : <span class="number">20</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  &#125;;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> map2 = &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="number">1</span> : <span class="number">20</span>,</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="number">2</span> : <span class="number">30.2</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  &#125;;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">Map</span> map3 = &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="string">"name"</span> : <span class="string">"lisi"</span>,</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="number">1</span> : [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span></pre></td></tr><tr><td class="code"><pre><span class="line">  &#125;;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">Map</span> map4 = <span class="keyword">new</span> <span class="built_in">Map</span>();</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">Map</span> map5 = <span class="built_in">Map</span>.from(map1);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">int</span>&gt; map6 = &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="string">"number"</span> : <span class="number">1</span>,</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="string">"age"</span> : <span class="number">20</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  &#125;;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">Map</span> map7 = <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt;();</span></pre></td></tr><tr><td class="code"><pre><span class="line">  map7[<span class="string">"name"</span>] = <span class="string">"wanger"</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  map7[<span class="string">"age"</span>] = <span class="number">20</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(map1);  <span class="comment">//è¾“å‡º &#123;name: zhangsan, age: 20&#125;</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(map2);  <span class="comment">//è¾“å‡º &#123;1: 20, 2: 30.2&#125;</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(map3);  <span class="comment">//è¾“å‡º &#123;name: lisi, 1: [1, 2, 3]&#125;</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(map4);  <span class="comment">//è¾“å‡º &#123;&#125;</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(map5);  <span class="comment">//è¾“å‡º &#123;name: zhangsan, age: 20&#125;</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(map6);  <span class="comment">//è¾“å‡º &#123;number: 1, age: 20&#125;</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(map7);  <span class="comment">//è¾“å‡º &#123;name: wanger, age: 20&#125;</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>



<p><strong>2.1.5 æ³›å‹</strong></p>
<p>æ³›å‹ï¼Œå³é€šç”¨ç±»å‹ï¼Œä½¿ Dart ä¸­çš„ç±»å‹æ›´åŠ åŠ¨æ€ï¼Œæé«˜äº†ä»£ç çš„é‡ç”¨ç‡ã€‚Dart ä¸­ä½¿ç”¨ <code>&lt;T&gt;</code> çš„æ–¹å¼æ¥å®šä¹‰æ³›å‹ï¼Œ<code>T</code> ä¸ºæ ‡è¯†ç¬¦æˆ–å…³é”®å­—ï¼Œä¸€èˆ¬ç”¨ <code>T</code> è¡¨ç¤ºã€‚ä¸Šé¢çš„ä¾‹å­ä¸­ä¹Ÿä½¿ç”¨äº†æ³›å‹æ¥çº¦æŸæ•°æ®ç±»å‹ï¼Œä¾‹å¦‚åˆ—è¡¨ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> arr = <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;();</span></pre></td></tr><tr><td class="code"><pre><span class="line">  arr.addAll([<span class="string">"str1"</span>, <span class="string">"str2"</span>, <span class="string">"str3"</span>]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(arr);  <span class="comment">//è¾“å‡º [str1, str2, str3]</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>



<p><strong>2.1.6 ç¬¦æ–‡ (Runes)</strong></p>
<p>ç¬¦æ–‡(runes)æ˜¯å­—ç¬¦ä¸²çš„UTF-32ç¼–ç ç‚¹ï¼Œè¦åœ¨å­—ç¬¦ä¸²ä¸­è¡¨ç¤º32ä½çš„Unicodeå€¼ï¼Œå¯ä½¿ç”¨ <code>\uxxxx</code> å½¢å¼ï¼Œxxxx ä¸ºå››ä½åå…­è¿›åˆ¶å€¼ï¼Œå¦‚å¤šäºæˆ–å°‘äºå››ä½ï¼Œåˆ™éœ€è¦ä½¿ç”¨ <code>{}</code> åŒ…è£…ã€‚</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> value = <span class="string">'\u&#123;1F362&#125;'</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(value);  <span class="comment">//è¾“å‡º ğŸ¢</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>



<p><strong>2.1.7 ç¬¦å·ç±»å‹ (Symbols)</strong></p>
<p><code>Symbol</code> è¡¨ç¤ºè¿ç®—ç¬¦æˆ–æ ‡è¯†ç¬¦ï¼Œä½¿ç”¨ç›¸åŒåç§°åˆ›å»ºçš„ç¬¦å·æ˜¯ç›¸ç­‰çš„ï¼Œæœ‰å¦‚ä¸‹ä¸¤ç§æ–¹å¼åˆ›å»ºç¬¦å·ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> symb = <span class="built_in">Symbol</span>(<span class="string">"s"</span>);  <span class="comment">//é€šè¿‡æ„é€ æ–¹æ³•åˆ›å»ºç¬¦å·</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> symb1 = #s;  				 <span class="comment">//é€šè¿‡#åˆ›å»ºç¬¦å·</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(symb.runtimeType);  <span class="comment">//è¾“å‡º Symbol</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(symb1.runtimeType); <span class="comment">//è¾“å‡º Symbol</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">if</span>(symb == symb1) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">print</span>(<span class="string">"ç›¸åŒ"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>



<p><strong>2.1.8 å¸¸é‡</strong></p>
<p>ä»¥ä¸Šå£°æ˜çš„å˜é‡éƒ½æ˜¯å¯å˜é‡ï¼Œä¹Ÿå°±æ˜¯å˜é‡ï¼Œæœ‰æ—¶å€™éœ€è¦ä¸€äº›æ•°æ®æ˜¯ä¸å¯å˜çš„ï¼Œç§°ä¸ºå¸¸é‡ã€‚åœ¨ Dart ä¸­ï¼Œå®šä¹‰å¸¸é‡å¯ä»¥é€šè¿‡å…³é”®å­— <code>const</code> æˆ– <code>final</code> æ¥å®šä¹‰ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">const</span> a = <span class="number">10</span>;  <span class="comment">//å£°æ˜å…·ä½“æ•°æ®ç±»å‹å’Œvarå…³é”®å­—</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> b = <span class="string">'hello dart!'</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(<span class="string">"<span class="subst">$a</span> <span class="subst">$b</span>"</span>);  <span class="comment">//è¾“å‡º hello world! hello dart!</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(<span class="string">"<span class="subst">$&#123;a.runtimeType&#125;</span> <span class="subst">$&#123;b.runtimeType&#125;</span>"</span>);!  <span class="comment">//è¾“å‡º String String</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼Œåœ¨å£°æ˜å¸¸é‡æ—¶ï¼Œå¯ä»¥çœç•¥å…¶æ•°æ®ç±»å‹ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è¿›è¡Œæ¨æ–­ã€‚æ— è®ºä½¿ç”¨ <code>const</code> è¿˜æ˜¯ <code>final</code> å£°æ˜çš„å¸¸é‡éƒ½æ˜¯ä¸å¯ä»¥æ”¹å˜çš„ï¼Œå¹¶ä¸”åœ¨å®šä¹‰å¸¸é‡æ—¶ï¼Œåœ¨å®šä¹‰çš„åŒæ—¶å°±éœ€è¦å¯¹å…¶è¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚å¦‚æœè¯•å›¾å¯¹å¸¸é‡è¿›è¡Œé‡æ–°å¤åˆ¶ï¼Œä¹Ÿä¼šæŠ¥é”™ã€‚</p>
<p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä½¿ç”¨ <code>const</code> å’Œ <code>final</code> å£°æ˜çš„å¸¸é‡ï¼Œå…¶è¾“å‡ºçš„æœ€ç»ˆæ•°æ®ç±»å‹éƒ½ä¸º <code>String</code> ï¼Œé‚£ä¹ˆå…·ä½“ä»–ä»¬ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p><code>const</code> å®šä¹‰çš„å¸¸é‡åœ¨å®šä¹‰æ—¶å¿…é¡»èµ‹å€¼ä¸ºä¸€ä¸ªå¸¸é‡å€¼ï¼Œä¸å¯ä»¥é€šè¿‡è¡¨è¾¾å¼æˆ–å‡½æ•°è¿›è¡Œèµ‹å€¼æ“ä½œ(å¸¸é‡è¡¨è¾¾å¼å¯ä»¥)ï¼Œè€Œ <code>final</code> å®šä¹‰çš„å¸¸é‡åˆ™å¯ä»¥é€šè¿‡è¡¨è¾¾å¼æˆ–å‡½æ•°èµ‹å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ <code>const</code> å¸¸é‡ä¸ºç¼–è¯‘æ—¶å¸¸é‡ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µå°±å¿…é¡»æ˜¯å¯çŸ¥çš„ï¼Œè€Œ <code>final</code> å¸¸é‡æ˜¯åªèƒ½å¯¹å…¶è¿›è¡Œä¸€æ¬¡èµ‹å€¼ï¼Œä½†æ˜¯å¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œè®¾ç½®ã€‚ å¦‚ä¸‹ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">const</span> a = <span class="number">10</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">final</span> b = <span class="number">20.5</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">const</span> c = a ;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">final</span> d = a;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="comment">// const e = a+b;  //é”™è¯¯</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">final</span> f = a + b;</span></pre></td></tr><tr><td class="code"><pre><span class="line">	<span class="keyword">const</span> g = a * <span class="number">10</span>;  <span class="comment">//æ­£ç¡®ï¼Œå› ä¸ºaä¸ºå¸¸é‡ï¼Œå¸¸é‡è¡¨è¾¾å¼åœ¨ç¼–è¯‘æœŸå°±å¯ä»¥ç¡®å®šå€¼</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(a);  <span class="comment">//è¾“å‡º 10</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(b);  <span class="comment">//è¾“å‡º 20.5</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(c);  <span class="comment">//è¾“å‡º 10</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(d);  <span class="comment">//è¾“å‡º 10</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(f);  <span class="comment">//è¾“å‡º30.5</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(g);  <span class="comment">//è¾“å‡º 100</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p><code>const</code> è¿˜å¯ä»¥ç”¨æ¥åˆ›å»ºå¸¸é‡å€¼ä»¥åŠå£°æ˜åˆ›å»ºå¸¸é‡å€¼çš„æ„é€ å‡½æ•°(åæœŸæ–‡ç« ä¼šä»‹ç»åˆ°)ï¼Œåˆ›å»ºå¸¸é‡å€¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">List</span> a = <span class="keyword">const</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">List</span> b = <span class="keyword">const</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">if</span>(a == b) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">print</span>(<span class="string">"ç›¸åŒ"</span>);   <span class="comment">//ä¼šè¾“å‡º ç›¸åŒ</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>å¦‚æœä¸ç”¨ <code>const</code> ä¿®é¥°ï¼Œåˆ™aä¸bä¸ºä¸åŒï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">List</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">List</span> b = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">if</span>(a == b) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">print</span>(<span class="string">"ç›¸åŒ"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  &#125;<span class="keyword">else</span> <span class="built_in">print</span>(<span class="string">"ä¸åŒ"</span>);  <span class="comment">//è¾“å‡º ä¸åŒ</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>å¹¶ä¸” ä½¿ç”¨å¦‚ä¸‹æ–¹å¼å£°æ˜åˆ›å»ºçš„å¸¸é‡å€¼æ˜¯å¯ä»¥æ”¹å˜çš„ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">List</span> a = <span class="keyword">const</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]; <span class="comment">//å¯æ”¹å˜</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">const</span> b = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]; <span class="comment">//ä¸å¯æ”¹å˜</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">  a = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(a);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>ä½†æ˜¯å¯¹äº <code>const [1, 2, 3]</code> ä¸­çš„å•ä¸ªæ•°æ®å…ƒç´ æ˜¯ä¸å¯ä¿®æ”¹çš„ï¼Œä¿®æ”¹ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚å¯¹äº <code>a</code> å˜é‡æ¥è¯´æ˜¯å¯å˜çš„ï¼Œå› ä¸ºæœªä½¿ç”¨ <code>const</code> ä¿®é¥°ï¼Œæ‰€ä»¥å¯¹ <code>a</code> é‡æ–°èµ‹å€¼ <code>[4, 5, 6]</code> ä»¥åï¼Œ<code>a</code> å¯¹è±¡ç›¸å½“äºå¦‚ä¸‹å®šä¹‰ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span></pre></td></tr></table></figure>

<p>é€šè¿‡ä»¥ä¸‹ä»£ç éªŒè¯ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> a = <span class="keyword">const</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> b = <span class="keyword">const</span> [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">  a = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">if</span>(a == b) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">print</span>(<span class="string">"ç›¸åŒ"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  &#125;<span class="keyword">else</span>&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">print</span>(<span class="string">"ä¸åŒ"</span>);   <span class="comment">//è¾“å‡ºä¸åŒ</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>ä»¥ä¸‹ä»£ç ä¸ºå¯¹ <code>const [1, 2, 3]</code> å•ä¸ªå…ƒç´ ä¿®æ”¹æŠ›å‡ºå¼‚å¸¸çš„ç¤ºä¾‹ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> a = <span class="keyword">const</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">  a[<span class="number">0</span>] = <span class="number">10</span>;   <span class="comment">//é”™è¯¯ï¼Œä¸å¯ä¿®æ”¹</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>



<p><strong>2.1.9 åŠ¨æ€æ•°æ®ç±»å‹</strong></p>
<p>åœ¨ç¡®å®šæ•°æ®ç±»å‹ä»¥åå†èµ‹å€¼å…¶ä»–æ•°æ®ç±»å‹åˆ™ä¼šæŠ¥é”™ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> a = <span class="number">10</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  a = <span class="number">20.1</span>;   <span class="comment">//é”™è¯¯</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç ä¼šæŠ¥é”™å¦‚ä¸‹é”™è¯¯ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">A value of <span class="keyword">type</span> 'double' can't be assigned to a variable of <span class="keyword">type</span> '<span class="keyword">int</span>'.</span></pre></td></tr><tr><td class="code"><pre><span class="line">Try changing the <span class="keyword">type</span> of the variable, <span class="keyword">or</span> casting the right-hand <span class="keyword">type</span> to '<span class="keyword">int</span>'<span class="variable">.dart</span>(invalid_assignment)</span></pre></td></tr></table></figure>

<p>å¦‚æœå¸Œæœ›å˜é‡åœ¨èµ‹å€¼ä¸€ä¸ªæ•°æ®ç±»å‹ä»¥åå†èµ‹å€¼å…¶ä»–æ•°æ®ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨å…³é”®å­— <code>dynamic</code> å®šä¹‰ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">dynamic</span> a = <span class="number">10</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(a.runtimeType);  <span class="comment">//è¾“å‡ºint</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  a = <span class="number">20.1</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(a);  <span class="comment">//è¾“å‡º20.1</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(a.runtimeType);  <span class="comment">//è¾“å‡ºdouble</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p><code>dynamic</code> çš„æœ€ç»ˆæ•°æ®ç±»å‹ä¸ºæœ€åèµ‹å€¼çš„æ•°æ®çš„ç±»å‹ã€‚</p>
<p><strong>2.2.0 æšä¸¾ (enum)</strong></p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> Week&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  Monday,</span></pre></td></tr><tr><td class="code"><pre><span class="line">  Tuesday,</span></pre></td></tr><tr><td class="code"><pre><span class="line">  Wednesday</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> week = Week.Tuesday;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">if</span>(week == Week.Monday)&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">print</span>(<span class="string">"æ˜ŸæœŸä¸€"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(week == Week.Tuesday) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">print</span>(<span class="string">"æ˜ŸæœŸäºŒ"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(week == Week.Wednesday) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">print</span>(<span class="string">"æ˜ŸæœŸä¸‰"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(Week.values); <span class="comment">//è¾“å‡ºæ‰€æœ‰æšä¸¾å€¼</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(Week.Monday.index);  <span class="comment">//è¾“å‡ºç´¢å¼•å€¼</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(Week.Tuesday.index);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(Week.Wednesday.index);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">æ˜ŸæœŸäºŒ</span></pre></td></tr><tr><td class="code"><pre><span class="line">[Week<span class="variable">.Monday</span>, Week<span class="variable">.Tuesday</span>, Week<span class="variable">.Wednesday</span>]</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">0</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">1</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">2</span></span></pre></td></tr></table></figure>



<h5 id="3-ç±»å‹è½¬æ¢"><a href="#3-ç±»å‹è½¬æ¢" class="headerlink" title="3. ç±»å‹è½¬æ¢"></a>3. ç±»å‹è½¬æ¢</h5><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> a = <span class="number">10</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> b = <span class="number">20.5</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> c = a + b.toInt();  <span class="comment">//æµ®ç‚¹å‹è½¬æ•´å‹</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">var</span> d = a.toDouble() + b;  <span class="comment">//æ•´å‹è½¬æµ®ç‚¹å‹</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">String</span> e = b.toString();  <span class="comment">//æµ®ç‚¹å‹è½¬å­—ç¬¦ä¸²</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">double</span> f = <span class="built_in">double</span>.parse(e);  <span class="comment">//å­—ç¬¦ä¸²è½¬æµ®ç‚¹ï¼Œä½¿ç”¨æ­¤æ–¹æ³•åº”ç¡®å®šå­—ç¬¦ä¸²å¯è½¬æ¢ä¸ºæµ®ç‚¹å‹ï¼Œå¦åˆ™ä¼šæŠ¥å¼‚å¸¸ï¼Œå¦‚ä¸ç¡®å®šæ˜¯å¦å¯ä»¥è½¬æ¢åº”ä½¿ç”¨tryParseæ–¹æ³•ï¼Œæ— æ³•è½¬æ¢ä¼šè¿”å›null</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(<span class="string">"<span class="subst">$c</span> <span class="subst">$d</span> <span class="subst">$e</span> <span class="subst">$f</span>"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>



<h5 id="4-Object-ä¸-dynamic-çš„åŒºåˆ«"><a href="#4-Object-ä¸-dynamic-çš„åŒºåˆ«" class="headerlink" title="4. Object ä¸ dynamic çš„åŒºåˆ«"></a>4. <code>Object</code> ä¸ <code>dynamic</code> çš„åŒºåˆ«</h5><p>å› ä¸ºåœ¨ Dart ä¸­ï¼Œæ‰€æœ‰å†…å®¹éƒ½æ˜¯ä» <code>Object</code> ç±»æ‰©å±•è€Œæ¥ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼å®šä¹‰æ•°æ®ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Object</span> a = <span class="number">10</span>;</span></pre></td></tr></table></figure>

<p>ä¸ <code>dynamic</code> å¯¹æ¯”ï¼Œä»–ä»¬éƒ½å¯ä»¥å®šä¹‰ä¸€ç§æ•°æ®ç±»å‹ä»¥åå†æ¬¡èµ‹å€¼å…¶ä»–æ•°æ®ç±»å‹ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">Object</span> a = <span class="number">10</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  a = <span class="string">"string"</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(a);  <span class="comment">//è¾“å‡º string</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">dynamic</span> b = <span class="number">20</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  b = <span class="string">"string"</span>; <span class="comment">//è¾“å‡º string</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(b);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>ä½†æ˜¯ <code>Object</code> å®šä¹‰çš„å¯¹è±¡åœ¨è°ƒç”¨æ–¹æ³•æˆ–å±æ€§æ˜¯ï¼Œå¯ä»¥åœ¨ç¼–è¯‘æ—¶å°±åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„æ–¹æ³•æˆ–å±æ€§ï¼Œå¦‚ä¸å­˜åœ¨ï¼Œç¼–è¯‘é˜¶æ®µå°±ä¼šæŠ¥é”™ã€‚è€Œ <code>dynamic</code> åŠ¨æ€ç±»å‹ï¼Œè°ƒç”¨ä¸å­˜åœ¨çš„æ–¹æ³•æˆ–å±æ€§ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µä¸ä¼šæŠ¥é”™ï¼Œè¿è¡Œæ—¶æ‰ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main()&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">Object</span> a = <span class="number">10</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(a);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">dynamic</span> b = <span class="number">20</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">print</span>(b);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="comment">// a.run; è°ƒç”¨ä¸å­˜åœ¨çš„å±æ€§runï¼Œç¼–è¯‘æ—¶å°±ä¼šæç¤ºé”™è¯¯</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">  b.run;  <span class="comment">//ç¼–è¯‘æ—¶ä¸ä¼šæç¤ºé”™è¯¯ï¼Œè¿è¡Œæ—¶æ‰ä¼šæŠ›å‡ºå¼‚å¸¸</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>



<p>PSï¼šä»¥ä¸Šåªæ˜¯å¾ˆå°ä¸€éƒ¨åˆ†å†…å®¹ï¼Œå› ä¸ºä¸€åˆ‡çš†å¯¹è±¡ï¼Œæ‰€ä»¥æ¯ä¸ªç±»éƒ½æœ‰è‡ªå·±çš„å¾ˆå¤šå±æ€§ä¸æ–¹æ³•ï¼Œå…·ä½“å¯ä»¥å‚çœ‹ä»£ç æ–‡æ¡£ã€‚</p>
]]></content>
      <categories>
        <category>ç§»åŠ¨å¼€å‘</category>
        <category>Flutterå¼€å‘</category>
      </categories>
      <tags>
        <tag>Flutter</tag>
        <tag>Dart</tag>
        <tag>hybrid</tag>
        <tag>Native</tag>
      </tags>
  </entry>
  <entry>
    <title>[IOS.Swift]SwiftåŸºç¡€æ•°æ®ç±»å‹(ä¸€)</title>
    <url>/content/bc12b792.html</url>
    <content><![CDATA[<h4 id="å¸¸é‡ä¸å˜é‡"><a href="#å¸¸é‡ä¸å˜é‡" class="headerlink" title="å¸¸é‡ä¸å˜é‡"></a>å¸¸é‡ä¸å˜é‡</h4><p>åœ¨ <code>Swift</code> ä¸­ï¼Œå¸¸é‡(ä¸å¯å˜çš„å˜é‡)ä½¿ç”¨ <code>let</code> å…³é”®å­—å®šä¹‰ï¼Œå˜é‡ä½¿ç”¨ <code>var</code> å…³é”®å­—å®šä¹‰ï¼Œå¹¶ä¸” <code>Swift</code> å»ºè®®å°½å¯èƒ½ä½¿ç”¨ <code>let</code> å…³é”®å­—å®šä¹‰ï¼Œå› ä¸ºå¸¸é‡è¦æ›´å®‰å…¨ä¸€äº›ï¼Œå¦‚æœä¸€ä¸ªå€¼ä¸å…è®¸è¢«æ”¹å˜ï¼Œä½†åœ¨æ— æ„é—´åšäº†ä¿®æ”¹åˆ™æœ‰å¯èƒ½é€ æˆä¸€äº›Bugçš„å‡ºç°ã€‚å®šä¹‰çš„å¸¸é‡å¦‚æœè¿›è¡Œäº†ä¿®æ”¹ï¼Œåˆ™ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚</p>
<a id="more"></a>

<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç¬¬ä¸€ç§å†™æ³•ï¼Œæ­£ç¡®å†™æ³•</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">100</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> b = <span class="number">200</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//ç¬¬äºŒç§å†™æ³•ï¼Œé”™è¯¯å†™æ³•</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//var a</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//let b</span></span></pre></td></tr></table></figure>

<p>ä¸ºä»€ä¹ˆç¬¬ä¸€ç§å†™æ³•æ˜¯æ­£ç¡®çš„ï¼Œè€Œç¬¬äºŒç§å†™æ³•æ˜¯é”™è¯¯çš„å‘¢ï¼Ÿå› ä¸ºåœ¨ <code>Swift</code> ä¸­å¯ä»¥è¿›è¡Œå˜é‡ç±»å‹æ¨æ–­ï¼Œå½“æˆ‘ä»¬å®šä¹‰å˜é‡å¹¶åˆå§‹åŒ–ä»¥åï¼Œç¼–è¯‘å™¨å¯ä»¥æ ¹æ®æˆ‘ä»¬çš„åˆå§‹åŒ–å€¼å¯¹æ‰€å®šä¹‰çš„å˜é‡è‡ªåŠ¨è¿›è¡Œç±»å‹æ¨æ–­ã€‚è€Œå®šä¹‰ä½†ä¸åˆå§‹åŒ–ç¼–è¯‘å™¨å°±æ— æ³•åšå‡ºç±»å‹æ¨æ–­ã€‚å½“ç„¶å¯ä»¥è¿›è¡Œæ˜¾ç¤ºæŒ‡å‡ºå®šä¹‰çš„æ•°æ®ç±»å‹ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a:<span class="type">Int</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> b:<span class="type">Double</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//åŒæ—¶å£°æ˜ä¸‰ä¸ªDoubleç±»å‹å˜é‡</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> d, e, f:<span class="type">Double</span></span></pre></td></tr></table></figure>

<p>è™½ç„¶è¿™æ ·å†™æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯æœªåˆå§‹åŒ–çš„å˜é‡æ˜¯æ— æ³•ä½¿ç”¨çš„ï¼Œä½¿ç”¨ç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥åœ¨å®šä¹‰æ—¶æœ€å¥½ç›´æ¥è¿›è¡Œåˆå§‹åŒ–å·¥ä½œã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a:<span class="type">Int</span> = <span class="number">100</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> b:<span class="type">Double</span> = <span class="number">200.0</span></span></pre></td></tr></table></figure>

<p>å»ºè®®ä½¿ç”¨ç¬¬ä¸€ç§å†™æ³•ï¼Œè®©ç¼–è¯‘å™¨è‡ªåŠ¨è¿›è¡Œç±»å‹æ¨æ–­ã€‚</p>
<p>ä»¥ä¸Šä»£ç å¯ä»¥å‘ç°ï¼Œåœ¨æ¯ä¸€ä¸ªä»£ç åå¹¶æ²¡æœ‰ä½¿ç”¨åˆ†å·(<code>;</code>)ï¼Œåœ¨ <code>Swift</code> ä¸­ï¼Œä¸€è¡Œåªæœ‰ä¸€æ¡è¯­å¥æ˜¯å¯ä»¥ä¸åŠ åˆ†å·çš„ï¼ŒåŠ äº†ä¹Ÿæ²¡æœ‰é”™ï¼Œä½†æ˜¯å¦‚æœä¸€è¡Œçš„è¯­å¥å¤§äº1ï¼Œåˆ™éœ€è¦ä½¿ç”¨åˆ†å·éš”å¼€ï¼Œä»¥ä¸‹éƒ½æ˜¯æ­£ç¡®çš„å†™æ³•ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">100</span>, b = <span class="number">200</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">10</span>; <span class="keyword">var</span> y = <span class="number">20</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//ä»¥ä¸‹åˆ†è¡Œå†™ä¹Ÿæ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯ä¸ä¾¿äºé˜…è¯»</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="built_in">c</span> =</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="number">100</span></span></pre></td></tr></table></figure>

<p>å»ºè®®æ¯ä¸€è¡Œåªå®šä¹‰ä¸€æ¡è¯­å¥ã€‚</p>
<p><code>Swift</code> ä¸­ä¸å…è®¸ä½¿ç”¨ç³»ç»Ÿæä¾›çš„å…³é”®å­—ä½œä¸ºå˜é‡åï¼Œå¦‚æœæƒ³ä½¿ç”¨ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹æ–¹å¼ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ­£ç¡®ï¼Œéœ€è¦ä½¿ç”¨``å°†å…³é”®å­—åŒ…èµ·æ¥</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> `<span class="class"><span class="keyword">class</span>` = 10</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="class">`<span class="title">class</span>` = 100</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="class"></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="class">//é”™è¯¯</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="class"><span class="title">var</span> <span class="title">class</span> = 10</span></span></pre></td></tr></table></figure>



<h4 id="è¾“å‡º"><a href="#è¾“å‡º" class="headerlink" title="è¾“å‡º"></a>è¾“å‡º</h4><p><code>print</code> å¯¹è±¡æ‰“å°æä¾›çš„å†…å®¹ã€‚</p>
<p><code>debugPrint</code> å°†æœ€é€‚åˆè°ƒè¯•çš„ç»™å®šé¡¹çš„æ–‡æœ¬è¡¨ç¤ºå½¢å¼å†™å…¥æ ‡å‡†è¾“å‡ºã€‚</p>
<p>éƒ½æ˜¯å°†è¦æ‰“å°çš„å†…å®¹è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œä½†æ˜¯ <code>debugPrint</code> çš„æ‰“å°ç»“æœéå¸¸ä¸°å¯Œï¼Œä¸æ‰“å°å†…å®¹ç›¸å…³çš„å†…å®¹éƒ½ä¼šåšè¾“å‡ºï¼Œç‰¹åˆ«åœ¨å¤æ‚å¯¹è±¡è¾“å‡ºæ—¶ï¼Œæ¯”è¾ƒæ˜æ˜¾ï¼Œæ¯”å¦‚ç½‘ç»œã€‚</p>
<p><code>Swift</code>ä½¿ç”¨å­—ç¬¦ä¸²æ’å€¼(string interpolation)çš„æ–¹å¼å°†å¸¸é‡åæˆ–å˜é‡åå½“åšå ä½ç¬¦æ’å…¥åˆ°å­—ç¬¦ä¸²ä¸­ï¼Œ<code>Swift</code> ä¼šä½¿ç”¨è¯¥å˜é‡æˆ–è€…å¸¸é‡çš„å€¼æ›¿æ¢è¿™äº›å ä½ç¬¦ã€‚ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ ¼å¼ \(å˜é‡å)</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> world = <span class="string">"hello world"</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">"this is hello \(world)"</span>)</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span> is hello hello world</span></pre></td></tr></table></figure>



<h4 id="Int-æ•´å‹"><a href="#Int-æ•´å‹" class="headerlink" title="Int æ•´å‹"></a><code>Int</code> æ•´å‹</h4><p><code>Swift</code> ä¸­æ•´å‹æœ‰å¦‚ä¸‹å‡ ç§ï¼š</p>
<p>æœ‰ç¬¦å·å‹ï¼š<code>Int8</code>ã€<code>Int16</code>ã€<code>Int32</code>ã€<code>Int64</code>ã€<code>Int</code></p>
<p>æ— ç¬¦å·å‹ï¼š<code>UInt8</code>ã€<code>UInt16</code>ã€<code>UInt32</code>ã€<code>UInt64</code>ã€<code>UInt</code></p>
<p>8ã€16ã€32ã€64ä»£è¡¨ä½ï¼Œæ¯”å¦‚ï¼š<code>Int8</code> 8ä½æœ‰ç¬¦å·æ•´å‹ï¼Œåœ¨å†…å­˜ä¸­å 8ä½ï¼Œå ä½ä¸åŒï¼Œæ•°å€¼å¤§å°èŒƒå›´ä¸åŒã€‚</p>
<p><code>Int</code> æ‰€å å†…å­˜ç©ºé—´ä¸å½“å‰å¹³å°åŸç”Ÿå­—é•¿ç›¸åŒï¼Œ32ä½å¹³å°ï¼Œ<code>Int</code> ä¸ <code>Int32</code> é•¿åº¦ç›¸åŒï¼Œ64ä½å¹³å°ï¼Œ<code>Int</code> ä¸ <code>Int64</code> é•¿åº¦ç›¸åŒã€‚ç›¸åº”çš„ï¼Œ<code>UInt</code> ä¹Ÿä¸å¹³å°åŸç”Ÿå­—é•¿ç›¸åŒï¼Œ32ä½å¹³å°ï¼Œ<code>UInt</code> ä¸ <code>UInt32</code> é•¿åº¦ç›¸åŒï¼Œ64ä½å¹³å°ï¼Œ<code>UInt</code> ä¸ <code>UInt64</code> é•¿åº¦ç›¸åŒã€‚</p>
<p>æ•´å‹å¯ä»¥æœ‰å››ç§è¡¨ç¤ºå½¢å¼ï¼šåè¿›åˆ¶(æ— å‰ç¼€)ã€äºŒè¿›åˆ¶(<code>0b</code>å‰ç¼€)ã€å…«è¿›åˆ¶(<code>0o</code>å‰ç¼€)ã€åå…­è¿›åˆ¶(<code>0x</code>å‰ç¼€)ã€‚</p>
<p>å¯ä»¥é€šè¿‡ <code>Int.max</code> æ¥è·å– <code>Int</code> çš„æœ€å¤§å€¼ï¼Œ<code>Int.min</code> è·å–æœ€å°å€¼ï¼Œå…¶ä»–æ•´å‹ä¹Ÿå¦‚æ­¤ã€‚</p>
<p><strong><em>å°½é‡ä¸è¦ä½¿ç”¨ <code>UInt</code> ï¼Œå³ä¾¿å˜é‡ä¿å­˜çš„æ€»æ˜¯éè´Ÿçš„å€¼ï¼Œç»Ÿä¸€ä½¿ç”¨ <code>Int</code> å‹å¯ä»¥æé«˜ä»£ç çš„å¤ç”¨æ€§ï¼Œé¿å…åœ¨ä¸åŒæ•°æ®ç±»å‹ä¹‹é—´è¿›è¡Œè½¬æ¢ï¼Œå¹¶å¯åŒ¹é…æ•°å€¼çš„ç±»å‹æ¨æ–­ã€‚éç‰¹æ®Šè¦æ±‚å†…å­˜ä¼˜åŒ–ç­‰æƒ…å†µï¼Œåº”å°½é‡ä½¿ç”¨<code>Int</code></em></strong></p>
<h4 id="Double-å’Œ-Float-å­—ç¬¦å‹"><a href="#Double-å’Œ-Float-å­—ç¬¦å‹" class="headerlink" title="Double å’Œ Float å­—ç¬¦å‹"></a><code>Double</code> å’Œ <code>Float</code> å­—ç¬¦å‹</h4><p>æµ®ç‚¹æ•°å¯ä»¥è¡¨ç¤ºæ›´å¤§èŒƒå›´çš„æ•°ã€‚</p>
<p><code>Float</code> è¡¨ç¤º32ä½æµ®ç‚¹æ•°ï¼Œå½“è¦æ±‚ç²¾åº¦ä¸é«˜æ—¶å¯ä»¥ä½¿ç”¨æ­¤ç§ç±»å‹ï¼Œå¯ä»¥è¾“å‡ºåˆ°å°æ•°ç‚¹å6ä½ã€‚</p>
<p><code>Double</code> è¡¨ç¤º64ä½æµ®ç‚¹æ•°ï¼Œå­˜å‚¨å¾ˆå¤§æˆ–é«˜ç²¾åº¦æµ®ç‚¹æ•°æ—¶ä½¿ç”¨ï¼Œå¯ä»¥è¾“å‡ºåˆ°å°æ•°ç‚¹å15ä½ã€‚</p>
<p>æµ®ç‚¹å¯ä»¥æœ‰åè¿›åˆ¶(æ— å‰ç¼€)ã€åå…­è¿›åˆ¶(<code>0x</code>å‰ç¼€)è¡¨ç¤ºã€‚ä¸¤ç§éƒ½å¯ä»¥ä½¿ç”¨æŒ‡æ•°æ–¹å¼è¡¨ç¤ºã€‚</p>
<p>å½“å£°æ˜æµ®ç‚¹å‹å˜é‡æ—¶ï¼Œå¦‚ä¸æŒ‡å®šæ•°æ®ç±»å‹ï¼Œé€šè¿‡è‡ªåŠ¨æ¨æ–­ï¼Œé‚£ä¹ˆ <code>Swift</code> ä¼šè‡ªåŠ¨æ¨æ–­å…¶ä¸º <code>Double</code> ç±»å‹ã€‚</p>
<p>åœ¨ <code>Swift</code> ä¸­ï¼Œæ­£æµ®ç‚¹æ•°é™¤ä»¥0.0ï¼Œå¾—åˆ°çš„ç»“æœè¡¨ç¤ºæ­£æ— ç©·å¤§ï¼Œè´Ÿæµ®ç‚¹æ•°é™¤ä»¥0.0ï¼Œå¾—åˆ°çš„ç»“æœè¡¨ç¤ºè´Ÿæ— ç©·å¤§ï¼Œ0.0é™¤ä»¥0.0æˆ–å¯¹ä¸€ä¸ªè´Ÿæ•°å¼€æ–¹çš„ç»“æœè¡¨ç¤ºéæ•°ã€‚æ‰€æœ‰çš„æ­£æ— ç©·å¤§éƒ½ç›¸ç­‰ï¼Œæ‰€æœ‰çš„è´Ÿæ— ç©·å¤§éƒ½ç›¸ç­‰ï¼Œéæ•°ä¸ä»»ä½•æ•°éƒ½ä¸ç›¸ç­‰ï¼ŒåŒ…æ‹¬å®ƒè‡ªå·±ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">100</span>/<span class="number">0.0</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a1 = <span class="number">200</span>/<span class="number">0.0</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> a == a1 &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">print</span>(<span class="string">"ç›¸ç­‰"</span>)</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;<span class="keyword">else</span>&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">print</span>(<span class="string">"ä¸ç›¸ç­‰"</span>)</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> b = -<span class="number">100</span>/<span class="number">0.0</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> b1 = -<span class="number">200</span>/<span class="number">0.0</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(b == b1)</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="built_in">c</span> = <span class="number">0.0</span>/<span class="number">0.0</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> c1 = <span class="number">0.0</span>/<span class="number">0.0</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">c</span> == c1 &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">print</span>(<span class="string">"ç›¸ç­‰"</span>)</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> a == <span class="built_in">c</span> &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">print</span>(<span class="string">"ç›¸ç­‰"</span>)</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;<span class="keyword">else</span>&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">print</span>(<span class="string">"ä¸ç›¸ç­‰"</span>)</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">ç›¸ç­‰</span></pre></td></tr><tr><td class="code"><pre><span class="line">true</span></pre></td></tr><tr><td class="code"><pre><span class="line">ä¸ç›¸ç­‰</span></pre></td></tr></table></figure>

<p><strong><em>åªæœ‰æµ®ç‚¹æ•°æ‰èƒ½é™¤ä»¥0.0ï¼Œæ•´æ•°é™¤ä»¥0ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚</em></strong></p>
<h4 id="æ•°å€¼ç±»å‹è½¬æ¢"><a href="#æ•°å€¼ç±»å‹è½¬æ¢" class="headerlink" title="æ•°å€¼ç±»å‹è½¬æ¢"></a>æ•°å€¼ç±»å‹è½¬æ¢</h4><p>åœ¨ <code>Swift</code> ä¸­ï¼Œä¸ºäº†å¢åŠ å¯è¯»æ€§ï¼Œæ•°å€¼ç±»å‹æ•°æ®å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¡¨ç¤ºæ–¹å¼ï¼Œå¹¶ä¸å½±å“ä½¿ç”¨æ•ˆæœï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">1_000</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> d = <span class="number">1_000.1_000</span></span></pre></td></tr></table></figure>

<p><code>Swift</code> ä¸­ä¸åŒæ•°æ®ç±»å‹ä¹‹é—´ä¸èƒ½è¿›è¡Œéšå¼è½¬æ¢ï¼Œå³ä¾¿éƒ½æ˜¯æ•´å‹çš„ <code>Int</code> ä¸ <code>Int64</code> ç­‰ä¹Ÿä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œå¿…é¡»æ˜¾ç¤ºè½¬æ¢ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢ä¸åŒæ•°æ®ç±»å‹ä¹‹é—´ä¸èƒ½è½¬æ¢æˆ–å–å€¼èŒƒå›´ä¸åŒç­‰é€ æˆçš„é—®é¢˜ã€‚æ˜¾ç¤ºè½¬æ¢æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a:Int = <span class="number">10</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> b:Int64 = <span class="number">20</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> c = Int64(a) + b</span></pre></td></tr></table></figure>

<p>æµ®ç‚¹æ•°ä¸æ•´æ•°ä¹‹é—´æ“ä½œä¹Ÿè¦æ˜¾ç¤ºè½¬æ¢ã€‚</p>
<h4 id="Bool-å¸ƒå°”å‹"><a href="#Bool-å¸ƒå°”å‹" class="headerlink" title="Bool å¸ƒå°”å‹"></a><code>Bool</code> å¸ƒå°”å‹</h4><p><code>Swift</code> ä¸­å¸ƒå°”ç±»å‹åªæœ‰ä¸¤ä¸ªå€¼ï¼Œ<code>true</code> ã€ <code>false</code> ï¼Œå…¶ä»–å€¼å¹¶ä¸èƒ½å½“åšå¸ƒå°”ç±»å‹ä½¿ç”¨ï¼Œä¸èƒ½ç”¨äºåˆ¤æ–­çœŸå‡ã€‚æ¯”å¦‚ï¼Œé0å€¼å¹¶ä¸èƒ½å½“åš <code>true</code> ä½¿ç”¨ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ­£ç¡®</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="literal">true</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> a &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">print</span>(<span class="string">"çœŸ"</span>)</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;<span class="keyword">else</span> &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">print</span>(<span class="string">"å‡"</span>)</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//é”™è¯¯ï¼Œbä¸ºæ•´å‹ï¼Œå¹¶éå¸ƒå°”ç±»å‹</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> b = <span class="number">0</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> b &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">print</span>(<span class="string">"çœŸ"</span>)</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;<span class="keyword">else</span> &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">print</span>(<span class="string">"å‡"</span>)</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>ä½†æ˜¯å¯ä»¥ä½¿ç”¨æ¡ä»¶æ¥åˆ¤æ–­çœŸå‡ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ­£ç¡®</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> b = <span class="number">0</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> b &gt; <span class="number">0</span> &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">print</span>(<span class="string">"çœŸ"</span>)</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;<span class="keyword">else</span> &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">print</span>(<span class="string">"å‡"</span>)</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>



<h4 id="tuple-å…ƒç»„"><a href="#tuple-å…ƒç»„" class="headerlink" title="tuple å…ƒç»„"></a><code>tuple</code> å…ƒç»„</h4><p>å…ƒç»„ï¼Œä½¿ç”¨åœ†æ‹¬å·æŠŠå¤šä¸ªå€¼ç»„åˆæˆä¸€ä¸ªå¤åˆå€¼ã€‚å…ƒç»„å†…çš„å€¼å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œå¹¶ä¸è¦æ±‚å…ƒç»„å†…çš„å€¼å…·æœ‰ç›¸åŒçš„ç±»å‹ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å£°æ˜ä½†æœªåˆå§‹åŒ–ï¼Œä¸å¯ä½¿ç”¨</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user : (<span class="type">Int</span>, <span class="type">Int</span>, <span class="type">Bool</span>)</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//åˆå§‹åŒ–ï¼Œå¯ä½¿ç”¨</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">user = (<span class="number">1</span>, <span class="number">2</span>, <span class="literal">true</span>)</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//å£°æ˜å¹¶åˆå§‹åŒ–</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user1:(<span class="type">Int</span>, <span class="type">Bool</span>)  = (<span class="number">10</span>, <span class="literal">false</span>)</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(user1)</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨ç±»å‹æ¨æ–­ä¸º(Int, Bool)</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user3 = (<span class="number">10</span>, <span class="literal">true</span>)</span></pre></td></tr></table></figure>

<p>å…ƒç»„ä¹Ÿå¯ä»¥åµŒå¥—ä½¿ç”¨</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user4 = (<span class="number">10</span>, (<span class="number">10</span>, <span class="number">20</span>))</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user5:(<span class="type">Int</span>, (<span class="type">Int</span>, <span class="type">String</span>)) = (<span class="number">10</span>, (<span class="number">20</span>, <span class="string">"hello"</span>))</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(user4)</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">"\(user5)"</span>)</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">(<span class="number">10</span>, (<span class="number">10</span>, <span class="number">20</span>))</span></pre></td></tr><tr><td class="code"><pre><span class="line">(<span class="number">10</span>, (<span class="number">20</span>, <span class="string">"hello"</span>))</span></pre></td></tr></table></figure>

<p>è·å–å…ƒç»„å…ƒç´ çš„å€¼å¯ä»¥é€šè¿‡ä¸‹æ ‡æ¥è·å–ï¼Œä¸æ•°ç»„ä¸€æ ·ï¼Œä¸‹æ ‡ä»0å¼€å§‹ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user1:(<span class="type">Int</span>, <span class="type">Bool</span>)  = (<span class="number">10</span>, <span class="literal">false</span>)</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user2 = (<span class="number">10</span>, (<span class="number">10</span>, <span class="number">20</span>))</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user3:(<span class="type">Int</span>, (<span class="type">Int</span>, <span class="type">String</span>)) = (<span class="number">10</span>, (<span class="number">20</span>, <span class="string">"hello"</span>))</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(user1.<span class="number">0</span>, user1.<span class="number">1</span>)</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(user2.<span class="number">0</span>, user2.<span class="number">1.0</span>, user2.<span class="number">1.1</span>)</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(user3.<span class="number">1</span>)</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line"><span class="number">10</span> false</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">10</span> <span class="number">10</span> <span class="number">20</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">(<span class="number">20</span>, <span class="string">"hello"</span>)</span></pre></td></tr></table></figure>

<p>å¯ä»¥å¯¹å…ƒç»„è¿›è¡Œæ‹†åˆ†ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> (name, age) = user1</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> (name1, (age1, sex)) = user2</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(name, age)</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(name1, age1, sex)</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">å¼ ä¸‰ <span class="number">20</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">æå›› <span class="number">22</span> m</span></pre></td></tr></table></figure>

<p>å¦‚æœåªéœ€è¦éƒ¨åˆ†å…ƒç´ ï¼Œåˆ†è§£æ—¶ï¼Œå¯æ˜¯ä½¿ç”¨ <code>_</code> ä¸‹åˆ’çº¿æ¥ä½œä¸ºè¢«å¿½ç•¥éƒ¨åˆ†çš„å ä½ç¬¦ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> (name, <span class="number">_</span>) = user1</span></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥ä¸ºå…ƒç»„çš„æ•°æ®å…ƒç´ å‘½åï¼Œå¯ä»¥é€šè¿‡åç§°æ¥å¯¹å…ƒç»„å…ƒç´ è¿›è¡Œè®¿é—®ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user = (name:<span class="string">"zhangsan"</span>, age:<span class="number">20</span>)</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(user.name, user.age)</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> user1:(name:<span class="type">String</span>, age:<span class="type">Int</span>)</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸æŒ‡å®šå…ƒç´ åç§°åˆ™éœ€è¦æŒ‰ç…§å…ƒç´ ç±»å‹é¡ºåºè¿›è¡Œå¤åˆ¶</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">user1 = (<span class="string">"zhangsan"</span>, <span class="number">29</span>)</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//æŒ‡å®šåç§°åˆ™å¯ä»¥ä¸ç”¨æŒ‰ç…§é¡ºåº</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">user1 = (age:<span class="number">20</span>, name: <span class="string">"å¼ ä¸‰"</span>)</span></pre></td></tr></table></figure>

<p>å½“å…ƒç»„ä¸­åªæœ‰ä¸€ä¸ªæ•°æ®æ—¶ï¼Œ<code>Swift</code> ä¼šå°†åªæœ‰ä¸€ä¸ªæ•°æ®çš„å…ƒç»„å½“åšå…¶ä¸­æ•°æ®çš„æ•°æ®ç±»å‹æ¥å¤„ç†ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ­¤æ—¶çš„ageä¸ºIntç±»å‹ï¼Œè€Œéå…ƒç»„</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> age = (<span class="number">20</span>)</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//æ‰€ä»¥å¦‚ä¸‹æ–¹æ³•æ˜¯é”™è¯¯çš„ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//let age:(num:Int)</span></span></pre></td></tr></table></figure>

<p>å¯ä»¥ä½¿ç”¨ <code>type(of: &lt;T&gt;)</code> æŸ¥çœ‹æ•°æ®ç±»å‹ã€‚</p>
<p>å¦‚æœå…ƒç»„ä¸­æ•°æ®ç±»å‹ç›¸åŒï¼Œå¯ä»¥å¿«é€Ÿäº¤æ¢å…ƒç»„ä¸­æ•°æ®å…ƒç»„çš„å€¼ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> i = <span class="number">10</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> j = <span class="number">20</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">(i, j) = (j, i)</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(i, j)  <span class="comment">//è¾“å‡º 20 10</span></span></pre></td></tr></table></figure>

<p>å¯ä»¥å®šä¹‰ç©ºå…ƒç»„ï¼Œä½†æ˜¯ä¸èƒ½èµ‹å€¼ï¼Œæ— æ³•ä½¿ç”¨ï¼Œåªèƒ½æ˜¯ç©ºå…ƒç»„ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ— æ³•å†æ¬¡è¿›è¡Œèµ‹å€¼</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> s = ()</span></pre></td></tr></table></figure>



<h4 id="Optional-å¯é€‰ç±»å‹"><a href="#Optional-å¯é€‰ç±»å‹" class="headerlink" title="Optional å¯é€‰ç±»å‹"></a><code>Optional</code> å¯é€‰ç±»å‹</h4><p>åœ¨ <code>Swift</code> ä¸­ï¼Œä½¿ç”¨å¯é€‰ç±»å‹æ¥è¡¨ç¤ºä¸€ä¸ªå˜é‡æˆ–å¸¸é‡æœ‰å¯èƒ½æœ‰å€¼ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰å€¼(<code>nil</code>)ï¼Œä¹Ÿç§°ä¸ºå€¼ç¼ºå¤±ã€‚éå¯é€‰ç±»å‹æ•°æ®æ˜¯ä¸èƒ½ä¸º <code>nil</code> çš„ã€‚<code>Swift</code> ä¸­ <code>nil</code> ä»£è¡¨ä¸€ä¸ªç¡®å®šçš„å€¼ï¼Œå³å€¼ç¼ºå¤±ï¼Œä»»ä½•å¯é€‰ç±»å‹æ•°æ®éƒ½å¯ä»¥è®¾ç½®ä¸º <code>nil</code>ã€‚ å¦‚æœä¸€ä¸ªå˜é‡æˆ–å¸¸é‡æœ‰å¯èƒ½è¢«èµ‹äºˆç©ºå€¼(å€¼ç¼ºå¤±)ï¼Œåˆ™è¦å£°æ˜ä¸ºå¯é€‰ç±»å‹ï¼Œå¦åˆ™èµ‹ <code>nil</code> å€¼æ—¶ä¼šæŠ¥é”™ã€‚</p>
<p>éå¯é€‰ç±»å‹çš„å˜é‡æˆ–å¸¸é‡åœ¨æœªåˆå§‹åŒ–ä¹‹å‰æ˜¯æ— æ³•ä½¿ç”¨çš„ï¼Œå¯é€‰ç±»å‹æœªåˆå§‹åŒ–åˆ™ä¼šè‡ªåŠ¨è®¾ç½®ä¸º <code>nil</code> (å¯é€‰ç±»å‹å¸¸é‡ä½¿ç”¨å‰ä¹Ÿå¿…é¡»åˆå§‹åŒ–ï¼Œå¦åˆ™ç¼–è¯‘ä¼šæŠ¥é”™ï¼Œä½†æ˜¯å¯è®¾ç½®ä¸º <code>nil</code> )ã€‚å¯é€‰ç±»å‹ä½¿ç”¨å¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a:<span class="type">Int?</span> = <span class="number">10</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> b = a</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(b)</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">c</span>:<span class="type">Int?</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">c</span>)</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> d:<span class="type">Bool?</span> = <span class="literal">true</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(d)</span></pre></td></tr></table></figure>

<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">Optional(<span class="number">10</span>)</span></pre></td></tr><tr><td class="code"><pre><span class="line">nil</span></pre></td></tr><tr><td class="code"><pre><span class="line">Optional(true)</span></pre></td></tr></table></figure>

<p>ä¸‹é¢çš„å†™æ³•æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºeéå¯é€‰å€¼ç±»å‹ï¼Œä¸èƒ½ä¸º <code>nil</code>ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> e:<span class="type">Int</span> = <span class="literal">nil</span>  <span class="comment">//é”™è¯¯</span></span></pre></td></tr></table></figure>

<p>é€šè¿‡ä¸Šé¢çš„è¾“å‡ºç»“æœå¯ä»¥å‘ç°ï¼Œè¾“å‡ºçš„éƒ½æ˜¯å¯é€‰å€¼ç±»å‹ï¼Œè€ŒéåŸºæœ¬æ•°æ®ç±»å‹ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥è¿›è¡ŒåŸºæœ¬ç±»å‹çš„æ“ä½œï¼Œéœ€è¦è¿›è¡Œå¼ºåˆ¶è§£ææ“ä½œï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a:<span class="type">Int?</span> = <span class="number">10</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> b:<span class="type">Int?</span> = <span class="number">20</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//cä¸ºIntç±»å‹</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="built_in">c</span> = a! + b!</span></pre></td></tr></table></figure>

<p><code>Int?</code> ä¸ <code>Int</code> æ˜¯ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œåœ¨è¿ç®—å‰éœ€è¦å…ˆè·å–å˜é‡çš„å®é™…å­˜å‚¨å€¼ï¼Œå°±éœ€è¦é€šè¿‡ <code>å˜é‡å!</code> è¿™ç§å½¢å¼è¿›è¡Œå¼ºåˆ¶è§£æã€‚<code>!</code> è¡¨ç¤ºå·²çŸ¥è¯¥å¯é€‰å˜é‡æœ‰å€¼ï¼Œæå–å…¶ä¸­çš„å€¼ã€‚ä½¿ç”¨ <code>!</code> çš„å‰æå°±æ˜¯ä¿è¯è¦è§£æçš„å¯é€‰å˜é‡æˆ–å¸¸é‡å¿…é¡»æœ‰å€¼ï¼Œæ‰èƒ½è§£ææˆåŠŸï¼Œå¦åˆ™ä¼šå¯¼è‡´è¿è¡Œæ—¶é”™è¯¯ã€‚å¯ä»¥å…ˆåšåˆ¤æ–­åœ¨è¿›è¡Œè§£æï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a:<span class="type">Int?</span> = <span class="number">10</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> b:<span class="type">Int?</span> = <span class="number">20</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> a != <span class="literal">nil</span> &amp;&amp; b != <span class="literal">nil</span> &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">let</span> <span class="built_in">c</span> = a! + b!</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p><code>Swift</code> æä¾›äº†æ›´ä¸ºæ–¹ä¾¿çš„è§£ææ–¹æ³•ï¼Œå¯é€‰ç»‘å®š(optional binding)ï¼Œ å¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a:<span class="type">Int?</span> = <span class="number">10</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> b:<span class="type">Int?</span> = <span class="number">20</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> tmpa = a, <span class="keyword">let</span> tmpb = b &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">print</span>(tmpa, tmpb)</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>é€šè¿‡ <code>if let</code> æˆ– <code>if var</code> ç»“åˆä½¿ç”¨ï¼Œå°±æ˜¯å…ˆåˆ¤æ–­å¯é€‰ç±»å‹å˜é‡æ˜¯å¦ä¸º <code>nil</code> ï¼Œå¦‚æœä¸ä¸º <code>nil</code> ï¼Œå°†ä¼šå¯¹å¯é€‰å˜é‡è¿›è¡Œå¼ºåˆ¶è§£æï¼Œå¹¶å°†è§£æåçš„å€¼èµ‹ç»™å£°æ˜çš„å˜é‡æˆ–å¸¸é‡ã€‚</p>
<p>ä¸Šé¢çš„ä»£ç ï¼Œå¦‚æœéœ€è¦å¯¹<code>a</code>æˆ–<code>b</code>çš„å€¼è¿›è¡Œä¿®æ”¹ï¼Œåˆ™ä½¿ç”¨ <code>if var tmpa</code> , <code>if var tmpb</code> å®šä¹‰å³å¯ã€‚</p>
<p>ä¸Šé¢çš„ä¾‹å­è¯´çš„æ˜¯å˜é‡æˆ–å¸¸é‡æœ‰å¯èƒ½æ²¡æœ‰å€¼çš„æƒ…å†µä¸‹éœ€è¦è¿›è¡Œåˆ¤æ–­è§£æï¼Œä½†æ˜¯å¦‚æœåœ¨ç¬¬ä¸€æ¬¡èµ‹å€¼åèƒ½ç¡®ä¿ä¸€ä¸ªå¯é€‰ç±»å‹æ€»æ˜¯æœ‰å€¼(ä¸ä¼šé‡æ–°è¢«è®¾ç½®ä¸º <code>nil</code> )ï¼Œåˆ™æ¯æ¬¡è§£ææ¯”è¾ƒä½æ•ˆï¼Œæ¯”å¦‚ï¼Œå®šä¹‰ä¸€ä¸ªå¸¸é‡å¯é€‰å€¼ï¼Œå¹¶èµ‹åˆå€¼(éç©º, <code>nil</code>)ï¼Œåˆ™å¸¸é‡ä¸èƒ½è¢«æ”¹å˜ï¼Œå¯ä»¥ä½¿ç”¨éšå¼å¯é€‰ç±»å‹ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a:<span class="type">Int!</span> = <span class="number">20</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> b = a + <span class="number">10</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(b)</span></pre></td></tr></table></figure>

<p><code>Int?</code> ä¸ <code>Int!</code> çš„åŒºåˆ«åœ¨äºï¼šå½“éœ€è¦è·å– <code>Int?</code> ç±»å‹çš„å€¼æ—¶ï¼Œéœ€è¦è¿›è¡Œæ‰‹åŠ¨è§£ææ“ä½œï¼Œå¦‚ä¸Šé¢çš„ä¾‹å­ã€‚ä½¿ç”¨ <code>Int!</code> æ—¶æ— éœ€æ‰‹åŠ¨è¿›è¡Œè§£æï¼Œ<code>Swift</code> ä¼šéšå¼æ‰§è¡Œè‡ªåŠ¨è§£æã€‚æ‰€ä»¥ä½¿ç”¨éšå¼è§£æå¯é€‰ç±»å‹è¦ç¡®ä¿å¯é€‰ç±»å‹æœ‰å€¼ï¼Œå¦åˆ™ä¹Ÿå¯¼è‡´é”™è¯¯ã€‚å½“ç„¶éšå¼è§£æå¯é€‰ç±»å‹ä¹Ÿå¯ä»¥è¿›è¡Œåˆ¤ç©ºå’Œè¿›è¡Œå¯é€‰ç»‘å®šæ“ä½œã€‚</p>
<h4 id="typealias-ç±»å‹åˆ«å"><a href="#typealias-ç±»å‹åˆ«å" class="headerlink" title="typealias ç±»å‹åˆ«å"></a><code>typealias</code> ç±»å‹åˆ«å</h4><p><code>Swift</code> ä¸­ä½¿ç”¨ <code>typealias</code> (type aliases)æ¥å¯¹ç°æœ‰ç±»å‹å®šä¹‰åˆ«åï¼Œå…¶ä»–è¯­è¨€ä¸€èˆ¬ä½¿ç”¨ <code>typedef</code> æ¥åšæ­¤æ“ä½œã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typealias</span> <span class="type">MyInt</span> = <span class="type">Int</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a:<span class="type">MyInt</span> = <span class="number">10</span></span></pre></td></tr></table></figure>

<p>å®šä¹‰å¥½åï¼Œ<code>MyInt</code> ä¸ <code>Int</code> å®Œå…¨ç›¸åŒã€‚</p>
]]></content>
      <categories>
        <category>ç§»åŠ¨å¼€å‘</category>
        <category>IOSå¼€å‘</category>
      </categories>
      <tags>
        <tag>IOS</tag>
        <tag>Swift</tag>
        <tag>Int</tag>
        <tag>Tuple</tag>
      </tags>
  </entry>
  <entry>
    <title>[IOS.OC]çº¿ç¨‹é”</title>
    <url>/content/9ff26aaa.html</url>
    <content><![CDATA[<h4 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h4><p>åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œé”æ˜¯åœ¨æ‰§è¡Œå¤šçº¿ç¨‹æ—¶ç”¨äºå¼ºè¡Œé™åˆ¶èµ„æºè®¿é—®çš„åŒæ­¥æœºåˆ¶ã€‚ä¸»è¦æ˜¯ä¸ºäº†è§£å†³å…±äº«èµ„æºçš„å®‰å…¨é—®é¢˜ã€‚å½“ä¸åŒçš„çº¿ç¨‹åŒæ—¶æ“ä½œä¸€å—å†…å­˜æ•°æ®æ—¶ï¼Œå¦‚æœä¸åŠ ä»¥é™åˆ¶ï¼Œä¼šå‘ç”Ÿæ•°æ®é”™ä¹±ç­‰å¼‚å¸¸é—®é¢˜ã€‚åŠ é”ï¼Œåˆ™æ¯ä¸ªçº¿ç¨‹åœ¨è®¿é—®å¯¹åº”èµ„æºæ—¶ï¼Œéœ€è¦å…ˆè·å–é”ä¿¡æ¯ï¼Œå†æ ¹æ®ä¿¡æ¯å†³å®šæ˜¯å¦å¯ä»¥è®¿é—®ã€‚å½“ä¸€æ¡çº¿ç¨‹è®¿é—®ç‰¹å®šèµ„æºæ—¶ï¼Œä½¿ç”¨é”ä¼šé”å®šè¯¥ç‰¹å®šèµ„æºï¼Œæ­¤æ—¶å…¶ä»–çº¿ç¨‹æ— æ³•è®¿é—®è¯¥èµ„æºã€‚å½“èµ„æºè®¿é—®ç»“æŸåï¼Œä¼šæ¢å¤é”çš„çŠ¶æ€ï¼Œå…è®¸å…¶ä»–çº¿ç¨‹è®¿é—®ï¼Œè¿™æ ·å°±ä¿è¯äº†åœ¨åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªå¯¹è±¡è®¿é—®ç‰¹å®šèµ„æºï¼Œå®ç°æ•°æ®å®‰å…¨ã€‚</p>
<a id="more"></a>

<h4 id="äºŒã€é”å®ç°"><a href="#äºŒã€é”å®ç°" class="headerlink" title="äºŒã€é”å®ç°"></a>äºŒã€é”å®ç°</h4><h5 id="1-atomicä¸nonatomic"><a href="#1-atomicä¸nonatomic" class="headerlink" title="1.atomicä¸nonatomic"></a>1.<code>atomic</code>ä¸<code>nonatomic</code></h5><p>åœ¨è¯´é”ä¹‹å‰ï¼Œå…ˆæ¥çœ‹ä¸‹åŸå­ä¸éåŸå­ï¼š</p>
<p><code>atomic</code> åŸå­çš„ï¼Œä½¿ç”¨<code>atomic</code>å±æ€§æ ‡å¿—è¡¨ç¤ºçš„æ˜¯æ— è®ºå¤šå°‘ä¸ªçº¿ç¨‹è®¿é—®ç»™å®šå±æ€§ï¼Œå…¶å€¼çš„è®¾ç½®æˆ–è·å–éƒ½ä¼šè·å¾—ä¸€ä¸ªå®Œæ•´çš„å€¼ï¼Œè€Œä¸æ˜¯éƒ¨åˆ†å€¼ã€‚å¹¶ä¸æ˜¯è¡¨ç¤ºçº¿ç¨‹å®‰å…¨ï¼Œåªæ˜¯è¡¨ç¤ºå€¼çš„å®Œæ•´æ€§ã€‚å½“æœ‰å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€å±æ€§è¿›è¡Œå†™å…¥æ“ä½œæ—¶ï¼Œåªèƒ½ä¿è¯æ¯æ¬¡è¯»çš„æ—¶å€™ä¸Šä¸€æ¬¡å†™å…¥æ“ä½œå·²ç»å®Œæˆã€‚ä½†æ˜¯å¦‚æœæ­¤æ—¶æœ‰è¯»å–æ“ä½œï¼Œå¹¶ä¸èƒ½ä¿è¯è¯»å–åˆ°çš„å€¼æ˜¯å“ªæ¬¡å†™å…¥åçš„å€¼ï¼Œæœ‰å¯èƒ½æ˜¯å†™å…¥ä¹‹å‰ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å…¶ä¸­ï¼ŒæŸä¸ªå†™å…¥åçš„å€¼ç­‰ã€‚</p>
<p><code>nonatomic</code>éåŸå­çš„ï¼Œä¹Ÿå°±æ˜¯ä¸<code>atomic</code>ç›¸åï¼Œå½“å¤šçº¿ç¨‹è®¿é—®æ—¶ï¼Œæœ‰å¯èƒ½ä¼šè·å–åˆ°ä¸€ä¸ªä¸å®Œæ•´çš„ç»“æœï¼Œæ¯”å¦‚å½“ä¸€ä¸ªçº¿ç¨‹åœ¨è¿›è¡Œå†™å…¥æ“ä½œæ—¶ï¼Œæ‰§è¡Œåˆ°<code>setter</code>æ–¹æ³•ä¸­çš„æŸä¸€éƒ¨åˆ†ï¼Œæ­¤æ—¶å¦å¤–ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œäº†å†™å…¥æ“ä½œï¼Œä¼šé€ æˆæ•°æ®é”™ä¹±æˆ–å´©æºƒç­‰ï¼Œå…·ä½“çœ‹æ‰§è¡Œåˆ°ä»€ä¹ˆä½ç½®ã€‚åŒæ ·ä¹Ÿéçº¿ç¨‹å®‰å…¨ã€‚</p>
<p>å…¶éƒ¨åˆ†æºç å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!atomic) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    oldValue = *slot;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    *slot = newValue;</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125; <span class="keyword">else</span> &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">spinlock_t</span>&amp; slotlock = PropertyLocks[slot];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    slotlock.lock();</span></pre></td></tr><tr><td class="code"><pre><span class="line">    oldValue = *slot;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    *slot = newValue;        </span></pre></td></tr><tr><td class="code"><pre><span class="line">    slotlock.unlock();</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p><code>atomic</code>å±æ€§æ—¶ï¼Œå†…éƒ¨ä½¿ç”¨è‡ªæ—‹é”è¿›è¡Œé”å®šæ“ä½œï¼Œè€Œ<code>nonatomic</code>å¹¶æ²¡æœ‰æ­¤æ“ä½œã€‚å®šä¹‰å±æ€§æ—¶ï¼Œå¦‚ä¸æŒ‡å®šé»˜è®¤ä¸º<code>atomic</code>ã€‚</p>
<p>æœ‰å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@property</span> (atomic, <span class="keyword">assign</span>) <span class="built_in">NSInteger</span> countIndex;</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@end</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">self</span>.countIndex = <span class="number">10</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="built_in">NSThread</span> detachNewThreadWithBlock:^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        [<span class="keyword">self</span> currentIndex];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="built_in">NSThread</span> detachNewThreadWithBlock:^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        [<span class="keyword">self</span> currentIndex];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;];</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)currentIndex &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">while</span> (_countIndex &gt; <span class="number">0</span>) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        sleep(<span class="number">1</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="keyword">self</span>.countIndex--;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%ld"</span>, <span class="keyword">self</span>.countIndex);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line"><span class="number">9</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">8</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">7</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">7</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">6</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">6</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">5</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">4</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">3</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">3</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">2</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">1</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">0</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">0</span></span></pre></td></tr></table></figure>

<p>ä¹Ÿè¯æ˜äº†<code>atomic</code>æ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚æ—¢ç„¶éçº¿ç¨‹å®‰å…¨ï¼Œå°±éœ€è¦æ‰‹åŠ¨æ·»åŠ é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p>
<h5 id="2-POSIX-Mutex-Lock"><a href="#2-POSIX-Mutex-Lock" class="headerlink" title="2.POSIX Mutex Lock"></a>2.POSIX Mutex Lock</h5><p> Cè¯­è¨€å®ç°ï¼Œæ˜¯ä¸€å¥—è·¨å¹³å°çš„å¤šçº¿ç¨‹APIã€‚pthreadæ˜¯ä¸€å¥—éå¸¸å¼ºå¤§çš„å¤šçº¿ç¨‹é”ï¼Œå¯ä»¥åˆ›å»ºäº’æ–¥é”ï¼ˆæ™®é€šé”ï¼‰ã€é€’å½’é”ã€ä¿¡å·é‡ã€æ¡ä»¶é”ã€è¯»å†™é”ã€onceé”ç­‰ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰æ¶‰åŠçš„é”ï¼Œéƒ½å¯ä»¥ç”¨pthreadæ¥å®ç°ã€‚éœ€è¦æ·»åŠ å¤´æ–‡ä»¶<code>#import &lt;pthread.h&gt;</code>ï¼Œåœ¨ä½¿ç”¨ä¹‹å‰è¦å…ˆåˆå§‹åŒ–ï¼ŒåŸºæœ¬ä½¿ç”¨å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¼•å…¥å¤´æ–‡ä»¶</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;pthread.h&gt;</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//å®šä¹‰äº’æ–¥é”å˜é‡</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">pthread_mutex_t</span> mutex;</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//é™æ€åˆå§‹åŒ–é”ï¼Œå®šä¹‰çš„æ—¶å€™å°±è¦åˆå§‹åŒ–</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//    pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//åŠ¨æ€åˆå§‹åŒ–é”ï¼Œä½¿ç”¨é»˜è®¤å±æ€§ï¼Œä¼ NULLå³å¯</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">pthread_mutex_init(&amp;mutex, <span class="literal">NULL</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//åŠ é”</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">pthread_mutex_lock(&amp;mutex);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//è§£é”</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">pthread_mutex_unlock(&amp;mutex);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//é”€æ¯é”</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">pthread_mutex_destroy(&amp;mutex);</span></pre></td></tr></table></figure>

<p>äº’æ–¥é”å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;pthread.h&gt;</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () </span>&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    pthread_mutex_t mutex;</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">NSInteger</span> countIndex;</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@end</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">//åŠ¨æ€åˆå§‹åŒ–é”ï¼Œä½¿ç”¨é»˜è®¤å±æ€§ï¼Œä¼ NULLå³å¯</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    pthread_mutex_init(&amp;mutex, <span class="literal">NULL</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">self</span>.countIndex = <span class="number">10</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="built_in">NSThread</span> detachNewThreadWithBlock:^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        [<span class="keyword">self</span> currentIndex];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="built_in">NSThread</span> detachNewThreadWithBlock:^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        [<span class="keyword">self</span> currentIndex];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;];</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)currentIndex &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">while</span> (_countIndex) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="comment">//åŠ é”</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">        pthread_mutex_lock(&amp;mutex);</span></pre></td></tr><tr><td class="code"><pre><span class="line">      	sleep(<span class="number">1</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="keyword">if</span>(_countIndex &gt; <span class="number">0</span>)&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">            <span class="keyword">self</span>.countIndex = <span class="keyword">self</span>.countIndex - <span class="number">1</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"%ld"</span>, <span class="keyword">self</span>.countIndex);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        &#125;<span class="keyword">else</span> &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"æ‰§è¡Œç»“æŸ"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">            <span class="comment">//é”€æ¯é”</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">            pthread_mutex_destroy(&amp;mutex);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="comment">//è§£é”</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">        pthread_mutex_unlock(&amp;mutex);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>é€’å½’é”ï¼Œæ›´æ”¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è®¾ç½®å±æ€§</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">pthread_mutexattr_t</span> attr;</span></pre></td></tr><tr><td class="code"><pre><span class="line">pthread_mutexattr_init(&amp;attr);</span></pre></td></tr><tr><td class="code"><pre><span class="line">pthread_mutexattr_settype(&amp;attr, PTHREAD_MUTEX_RECURSIVE);</span></pre></td></tr><tr><td class="code"><pre><span class="line">pthread_mutex_init(&amp;mutex, &amp;attr);</span></pre></td></tr><tr><td class="code"><pre><span class="line">pthread_mutexattr_destroy(&amp;attr);</span></pre></td></tr></table></figure>



<h5 id="3-synchronized-æŒ‡ä»¤"><a href="#3-synchronized-æŒ‡ä»¤" class="headerlink" title="3.synchronized æŒ‡ä»¤"></a>3.<code>synchronized</code> æŒ‡ä»¤</h5><p><code>@synchronized</code> éšå¼çš„åˆ›å»ºä¸€ç§å…¶ä»–é”èƒ½å®ç°çš„åŠŸèƒ½ï¼Œé€šè¿‡ä¸åŒçº¿ç¨‹å…±ç”¨åŒä¸€æ ‡è¯†ç¬¦çš„æ–¹å¼æ¥è¾¾åˆ°äº’æ–¥çš„ç›®çš„ã€‚ä¼ é€’ç»™<code>@synchronized</code>æŒ‡ä»¤çš„å¯¹è±¡æ˜¯ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œç”¨äºåŒºåˆ†å—ä¿æŠ¤çš„å—ã€‚å¦‚æœåœ¨ä¸åŒçº¿ç¨‹ä½¿ç”¨ä¸åŒçš„å¯¹è±¡æ ‡è¯†ç¬¦ï¼Œåˆ™æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šè·å¾—è‡ªå·±çš„é”ï¼Œè€Œä¸è¢«å…¶å®ƒé”é˜»å¡ã€‚<code>@synchronized</code>å—éšå¼åœ°å‘å—ä¿æŠ¤çš„ä»£ç æ·»åŠ äº†ä¸€ä¸ªå¼‚å¸¸å¤„ç†ç¨‹åºï¼Œè¿™ä¸ªå¤„ç†ç¨‹åºåœ¨æŠ›å‡ºå¼‚å¸¸æ—¶ä¼šè‡ªåŠ¨é‡Šæ”¾äº’æ–¥ï¼Œè¿™æ„å‘³ç€ä¸ºäº†ä½¿ç”¨@synchronizedæŒ‡ä»¤ï¼Œæ‚¨è¿˜å¿…é¡»åœ¨ä»£ç ä¸­å¯ç”¨Objective-Cå¼‚å¸¸å¤„ç†ã€‚æ‰€ä»¥ä¼šå¸¦æ¥ä¸€å®šçš„é¢å¤–å¼€é”€ï¼Œå¦‚æœå¤§é‡ä½¿ç”¨<code>@synchronized</code>æŒ‡ä»¤åˆ™æ•ˆç‡è¾ƒä½ã€‚</p>
<p>ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)currentIndex &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">while</span> (_countIndex) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="keyword">@synchronized</span> (<span class="keyword">self</span>) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">            sleep(<span class="number">1</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">            <span class="keyword">if</span>(_countIndex &gt; <span class="number">0</span>)&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">                <span class="keyword">self</span>.countIndex = <span class="keyword">self</span>.countIndex - <span class="number">1</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@"%ld"</span>, <span class="keyword">self</span>.countIndex);</span></pre></td></tr><tr><td class="code"><pre><span class="line">            &#125;<span class="keyword">else</span> &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@"æ‰§è¡Œç»“æŸ"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">            &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>PSï¼š<code>synchronized</code>æ ‡è¯†token ä¸ºä»»æ„<code>id</code>ç±»å‹ï¼Œä¸€èˆ¬ä½¿ç”¨<code>self</code>ã€‚</p>
<h5 id="4-NSLock"><a href="#4-NSLock" class="headerlink" title="4.NSLock"></a>4.<code>NSLock</code></h5><p><code>NSLock</code> äº’æ–¥é”ï¼Œäº’æ–¥é”æ˜¯ä¸€ç§ä¿¡å·é‡ï¼Œæ¯ä¸€æ¬¡åªæˆæƒä¸€ä¸ªçº¿ç¨‹è®¿é—®æƒé™ã€‚å¦‚æœæ­£åœ¨ä½¿ç”¨äº’æ–¥é”å¹¶ä¸”å¦ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å–å®ƒï¼Œè¯¥çº¿ç¨‹å°†é˜»å¡ï¼Œç›´åˆ°äº’æ–¥é”è¢«å…¶åŸå§‹æŒæœ‰è€…é‡Šæ”¾ä¸ºæ­¢ã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹ç«äº‰ç›¸åŒçš„äº’æ–¥é”ï¼Œä¸€æ¬¡åªèƒ½è®¿é—®ä¸€ä¸ªã€‚<code>NSLock</code>ç±»ä½¿ç”¨POSIXçº¿ç¨‹æ¥å®ç°å…¶é”å®šè¡Œä¸ºï¼Œå‘<code>NSLock</code>å¯¹è±¡å‘é€è§£é”æ¶ˆæ¯æ—¶ï¼Œå¿…é¡»ç¡®ä¿è¯¥æ¶ˆæ¯æ˜¯ä»å‘é€åˆå§‹é”å®šæ¶ˆæ¯çš„åŒä¸€çº¿ç¨‹å‘é€çš„ã€‚ä»å…¶ä»–çº¿ç¨‹è§£é”é”å¯èƒ½å¯¼è‡´æœªå®šä¹‰çš„è¡Œä¸ºã€‚ä¸åº”ä½¿ç”¨æ­¤ç±»æ¥å®ç°é€’å½’é”ã€‚åœ¨åŒä¸€çº¿ç¨‹ä¸Šä¸¤æ¬¡è°ƒç”¨<code>lock</code>æ–¹æ³•å°†æ°¸ä¹…é”å®šæ‚¨çš„çº¿ç¨‹ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">NSInteger</span> countIndex;</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSLock</span> * mlock;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@end</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">self</span>.countIndex = <span class="number">10</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">self</span>.mlock = [[<span class="built_in">NSLock</span> alloc] init];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">self</span>.mlock.name = <span class="string">@"my lock"</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="built_in">NSThread</span> detachNewThreadWithBlock:^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        [<span class="keyword">self</span> currentIndex];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="built_in">NSThread</span> detachNewThreadWithBlock:^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        [<span class="keyword">self</span> currentIndex];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;];</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)currentIndex &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">while</span> (_countIndex) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="comment">//åŠ é”</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">        [<span class="keyword">self</span>.mlock lock];</span></pre></td></tr><tr><td class="code"><pre><span class="line">        sleep(<span class="number">1</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="keyword">if</span>(_countIndex &gt; <span class="number">0</span>)&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">            <span class="keyword">self</span>.countIndex = <span class="keyword">self</span>.countIndex - <span class="number">1</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"%ld"</span>, <span class="keyword">self</span>.countIndex);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        &#125;<span class="keyword">else</span> &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"æ‰§è¡Œç»“æŸ"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="comment">//è§£é”</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">        [<span class="keyword">self</span>.mlock unlock];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>æ­¤å¤–<code>NSLock</code>ä¸­è¿˜å®šä¹‰äº†<code>tryLock</code>ã€<code>lockBeforeDate</code>ã€‚<code>tryLock</code>ä¼šå°è¯•è·å–é”ï¼Œå¹¶ç«‹å³è¿”å›æ˜¯å¦æˆåŠŸï¼Œä¸ä¼šé˜»å¡çº¿ç¨‹ã€‚<code>lockBeforeDate</code>åœ¨æŒ‡å®šæ—¶é—´ä¹‹å‰è·å–é”ï¼Œæ­¤æ–¹æ³•ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°æ—¶é—´ç»“æŸï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´å†…æœªè·å–åˆ°é”åˆ™è¿”å›NOã€‚</p>
<h5 id="5-NSRecursiveLock-é€’å½’é”"><a href="#5-NSRecursiveLock-é€’å½’é”" class="headerlink" title="5.NSRecursiveLock é€’å½’é”"></a>5.<code>NSRecursiveLock</code> é€’å½’é”</h5><p>â€œé€’å½’é”â€ ï¼Œé¡¾åæ€ä¹‰ï¼Œå¸¸ç”¨åœ¨é€’å½’å‡½æ•°ä¸­ä»¥é˜²æ­¢é€’å½’é˜»å¡çº¿ç¨‹ã€‚å½“ç„¶ä¹Ÿå¯ä»¥åœ¨éé€’å½’å‡½æ•°ä¸­ä½¿ç”¨ã€‚<code>NSRecursiveLock</code>å®šä¹‰çš„é”ï¼Œå¯ä»¥è¢«åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å–ï¼Œè€Œä¸ä¼šå¯¼è‡´æ­»é”é—®é¢˜ã€‚é€’å½’é”ä¼šè®°å½•æˆåŠŸè·å–çš„æ¬¡æ•°ã€‚æ¯ä¸ªæˆåŠŸé”çš„è·å–å¿…é¡»é€šè¿‡ç›¸åº”çš„è°ƒç”¨æ¥å¹³è¡¡è§£é”gè¯¥é”ã€‚åªæœ‰å½“é”å’Œè§£é”è°ƒç”¨å½¼æ­¤å¹³è¡¡æ—¶ï¼Œé”æ‰ä¼šè¢«é‡Šæ”¾ï¼Œå…¶ä»–çº¿ç¨‹æ‰èƒ½è·å–ã€‚ä½¿ç”¨å±æ€§ä¸<code>NSLock</code>ç›¸åŒã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">NSInteger</span> countIndex;</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSRecursiveLock</span> * recursiveLock;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@end</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">self</span>.countIndex = <span class="number">10</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">self</span>.recursiveLock = [[<span class="built_in">NSRecursiveLock</span> alloc] init];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>), ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        [<span class="keyword">self</span> recursiveMethod];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>), ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        [<span class="keyword">self</span> recursiveMethod];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)recursiveMethod &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">//åŠ é”</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">self</span>.recursiveLock lock];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    sleep(<span class="number">1</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">if</span>(<span class="keyword">self</span>.countIndex != <span class="number">0</span>)&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        </span></pre></td></tr><tr><td class="code"><pre><span class="line">        --<span class="keyword">self</span>.countIndex;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"countIndex:%ld"</span>, <span class="keyword">self</span>.countIndex);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        [<span class="keyword">self</span> recursiveMethod];</span></pre></td></tr><tr><td class="code"><pre><span class="line">        </span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">//è§£é”</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">self</span>.recursiveLock unlock];</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>PSï¼šåœ¨é€’å½’å‡½æ•°ä¸­åŠ é”ï¼Œå¦‚ä¸ä½¿ç”¨é€’å½’é”åˆ™ä¼šé€ æˆæ­»é”ï¼Œçº¿ç¨‹å°†ä¼šè¢«é”æ­»ã€‚</p>
<p>å› ä¸ºåœ¨è·å–é”ä¸è§£é”å¹³è¡¡ä¹‹å‰ï¼Œé€’å½’é”ä¸ä¼šè¢«é‡Šæ”¾ï¼Œæ‰€ä»¥ä¼šæ¶ˆè€—ä¸€å®šçš„æ€§èƒ½ã€‚é•¿æ—¶é—´æŒæœ‰é€’å½’æ‰€ä¼šå¯¼è‡´å…¶ä»–çº¿ç¨‹é˜»å¡ï¼Œç›´åˆ°é€’å½’å®Œæˆã€‚æ‰€ä»¥å¦‚æœå¯¹æ€§èƒ½éœ€æ±‚è¾ƒé«˜ï¼Œå¯ä»¥é€šè¿‡é‡å†™ä»£ç æ¥æ¶ˆé™¤é€’å½’ï¼Œå¯è·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚</p>
<h5 id="6-OSSpinLock-ä¸-os-unfair-lock-lock"><a href="#6-OSSpinLock-ä¸-os-unfair-lock-lock" class="headerlink" title="6.OSSpinLock ä¸ os_unfair_lock_lock"></a>6.<code>OSSpinLock</code> ä¸ <code>os_unfair_lock_lock</code></h5><p><code>os_unfair_lock_lock</code>ä¸º<code>OSSpinLock</code>çš„æ›¿ä»£å“ï¼Œ<code>OSSpinLock</code>å·²åºŸå¼ƒï¼Œå¦‚æœéœ€è¦ä½¿ç”¨è‡ªæ—‹é”ï¼Œè¦ä½¿ç”¨<code>os_unfair_lock_lock</code>ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å®šä¹‰é”</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">os_unfair_lock lock = OS_UNFAIR_LOCK_INIT;</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//åŠ é”</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">os_unfair_lock_lock(&amp;lock);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//è§£é”</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">os_unfair_lock_unlock(&amp;lock);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="comment">//å°è¯•åŠ é”</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//  BOOL isLock = os_unfair_lock_trylock(&amp;lock);</span></span></pre></td></tr></table></figure>



<h5 id="7-NSCondition-æ¡ä»¶"><a href="#7-NSCondition-æ¡ä»¶" class="headerlink" title="7.NSCondition æ¡ä»¶"></a>7.<code>NSCondition</code> æ¡ä»¶</h5><p>æ¡ä»¶å¯¹è±¡æ—¢å……å½“ç»™å®šçº¿ç¨‹ä¸­çš„é”åˆå……å½“æ£€æŸ¥ç‚¹ã€‚é”åœ¨æµ‹è¯•æ¡ä»¶å¹¶æ‰§è¡Œæ¡ä»¶è§¦å‘çš„ä»»åŠ¡æ—¶ä¿æŠ¤æ‚¨çš„ä»£ç ã€‚æ£€æŸ¥ç‚¹è¡Œä¸ºè¦æ±‚æ¡ä»¶åœ¨çº¿ç¨‹ç»§ç»­æ‰§è¡Œå…¶ä»»åŠ¡ä¹‹å‰ä¸ºçœŸã€‚æ¡ä»¶ä¸æˆç«‹æ—¶ï¼Œçº¿ç¨‹å°†é˜»å¡ã€‚å®ƒä¿æŒé˜»å¡çŠ¶æ€ï¼Œç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹å‘æ¡ä»¶å¯¹è±¡å‘å‡ºä¿¡å·ä¸ºæ­¢ã€‚</p>
<p>æ¯å½“æ‚¨ä½¿ç”¨æ¡ä»¶å¯¹è±¡æ—¶ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯é”å®šæ¡ä»¶ã€‚é”å®šæ¡ä»¶å¯ç¡®ä¿æ‚¨çš„è°“è¯å’Œä»»åŠ¡ä»£ç å…å—ä½¿ç”¨ç›¸åŒæ¡ä»¶çš„å…¶ä»–çº¿ç¨‹çš„å¹²æ‰°ã€‚å®Œæˆä»»åŠ¡åï¼Œæ‚¨å¯ä»¥æ ¹æ®ä»£ç éœ€æ±‚è®¾ç½®å…¶ä»–è°“è¯æˆ–å‘å‡ºå…¶ä»–æ¡ä»¶ä¿¡å·ã€‚æŒ‰ä½æ¡ä»¶å¯¹è±¡çš„é”æ—¶ï¼Œåº”å§‹ç»ˆè®¾ç½®è°“è¯å’Œä¿¡å·æ¡ä»¶ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">NSInteger</span> countIndex;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@end</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">self</span>.countIndex = <span class="number">0</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSCondition</span> * condition = [[<span class="built_in">NSCondition</span> alloc] init];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>), ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">      </span></pre></td></tr><tr><td class="code"><pre><span class="line">        [condition lock];</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="keyword">while</span> (!<span class="keyword">self</span>.countIndex) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"ç­‰å¾…æ‰§è¡Œ"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">            [condition wait];</span></pre></td></tr><tr><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        --<span class="keyword">self</span>.countIndex;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"æ‰§è¡Œ:%ld"</span>,<span class="keyword">self</span>.countIndex);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        [condition unlock];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>), ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        [condition lock];</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="keyword">self</span>.countIndex += <span class="number">10</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"å‘ä¿¡å·"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        [condition signal];</span></pre></td></tr><tr><td class="code"><pre><span class="line">        [condition unlock];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">ç­‰å¾…æ‰§è¡Œ</span></pre></td></tr><tr><td class="code"><pre><span class="line">å‘ä¿¡å·</span></pre></td></tr><tr><td class="code"><pre><span class="line">æ‰§è¡Œ:<span class="number">9</span></span></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ä»£ç åªç”¨äº†ä¸¤ä¸ªå¹¶å‘æ¼”ç¤ºï¼Œå¯èƒ½æœ‰å¤šæ¡çº¿ç¨‹è®¿é—®æ•°æ®ï¼Œéœ€è¦æ·»åŠ é”ä¿è¯æ•°æ®å®‰å…¨ã€‚å…¶ä»–æ–¹æ³•ï¼š</p>
<p><code>waitUntilDate</code> ç­‰å¾…ç›´åˆ°å‘å‡ºæ¡ä»¶ä¿¡å·æˆ–è¾¾åˆ°æŒ‡å®šçš„æ—¶é—´é™åˆ¶ä¸ºæ­¢ï¼Œé˜»å¡å½“å‰çº¿ç¨‹ã€‚å¿…é¡»åœ¨è°ƒç”¨æ­¤æ–¹æ³•ä¹‹å‰é”å®šæ¥æ”¶å™¨ã€‚<br><code>broadcast</code> å‘å‡ºçŠ¶æ€ä¿¡å·ï¼Œå”¤é†’æ‰€æœ‰ç­‰å¾…è¯¥çŠ¶æ€çš„çº¿ç¨‹ã€‚ä¸ºé¿å…å‡ºç°ç«äº‰æƒ…å†µï¼Œä»…åº”åœ¨æ¥æ”¶å™¨é”å®šæ—¶è°ƒç”¨æ­¤æ–¹æ³•ã€‚</p>
<h5 id="8-NSConditionLockæ¡ä»¶é”"><a href="#8-NSConditionLockæ¡ä»¶é”" class="headerlink" title="8.NSConditionLockæ¡ä»¶é”"></a>8.<code>NSConditionLock</code>æ¡ä»¶é”</h5><p>æ¡ä»¶é”æ ¹æ®ç‰¹å®šçš„æ¡ä»¶è¿›è¡Œé”æˆ–è€…è§£é”ï¼Œé€šå¸¸ï¼Œå½“åº”ç”¨ç¨‹åºä¸­çš„çº¿ç¨‹éœ€è¦ä»¥ç‰¹å®šé¡ºåºæ‰§è¡Œæ—¶ï¼ˆä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹äº§ç”Ÿå¦ä¸€ä¸ªçº¿ç¨‹æ¶ˆè€—çš„æ•°æ®æ—¶ï¼‰ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>NSConditionLock</code>å¯¹è±¡ã€‚åœ¨ç”Ÿäº§è€…æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ¶ˆè´¹è€…ä¼‘çœ ç­‰å¾…è·å–ä¸€ä¸ªä»¥ç”Ÿäº§è€…å®Œæˆå…¶æ“ä½œä¸ºæ¡ä»¶çš„é”ã€‚ä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥å…·æœ‰å¤šä¸ª<code>NSConditionLock</code>å¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½ä¿æŠ¤ä»£ç çš„ä¸åŒéƒ¨åˆ†ã€‚ä½†æ˜¯ï¼Œå¿…é¡»åœ¨åº”ç”¨ç¨‹åºæˆä¸ºå¤šçº¿ç¨‹ä¹‹å‰åˆ›å»ºè¿™äº›å¯¹è±¡ã€‚</p>
<p><code>NSConditionLock</code>å¯¹è±¡å“åº”çš„é”å®šå’Œè§£é”æ–¹æ³•å¯ä»¥ä»»æ„ç»„åˆä½¿ç”¨</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">NSInteger</span> countIndex;</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSConditionLock</span> * conditionLock;</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> * mutableArray;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@end</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">self</span>.countIndex = <span class="number">10</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">self</span>.conditionLock = [[<span class="built_in">NSConditionLock</span> alloc] init];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">self</span>.mutableArray = [[<span class="built_in">NSMutableArray</span> alloc] initWithCapacity:<span class="number">5</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"æ¡ä»¶é”çš„æ¡ä»¶:%ld"</span>, (<span class="keyword">long</span>)<span class="keyword">self</span>.conditionLock.condition);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>), ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        [<span class="keyword">self</span> producersMethod];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>), ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        [<span class="keyword">self</span> consumersMethod];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)producersMethod &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        sleep(<span class="number">1</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        [<span class="keyword">self</span>.conditionLock lock];</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"å¼€å§‹ç”Ÿäº§æ•°æ®"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"%d"</span>, i);</span></pre></td></tr><tr><td class="code"><pre><span class="line">            [<span class="keyword">self</span>.mutableArray addObject:[<span class="built_in">NSNumber</span> numberWithInt:i]];</span></pre></td></tr><tr><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        [<span class="keyword">self</span>.conditionLock unlockWithCondition:<span class="number">5</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)consumersMethod &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        sleep(<span class="number">1</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        [<span class="keyword">self</span>.conditionLock lockWhenCondition:<span class="number">5</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"å¼€å§‹æ¶ˆè´¹æ•°æ®"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, <span class="keyword">self</span>.mutableArray[<span class="number">0</span>]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">            [<span class="keyword">self</span>.mutableArray removeObjectAtIndex:<span class="number">0</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        [<span class="keyword">self</span>.conditionLock unlockWithCondition:<span class="number">0</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">æ¡ä»¶é”çš„æ¡ä»¶:<span class="number">0</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">å¼€å§‹ç”Ÿäº§æ•°æ®</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">0</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">1</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">2</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">3</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">4</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">å¼€å§‹æ¶ˆè´¹æ•°æ®</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">0</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">1</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">2</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">3</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">4</span></span></pre></td></tr></table></figure>

<p><code>unlockWithCondition</code>æ–¹æ³•ä¸ºè§£é”å¹¶è®¾ç½®æ–°çš„é”å®šæ¡ä»¶ã€‚<code>lockWhenCondition</code>å°è¯•è·å–é”ï¼Œæ¥æ”¶è€…çš„æ¡ä»¶å¿…é¡»ç­‰äºé”å®šæ“ä½œæˆåŠŸä¹‹å‰çš„æ¡ä»¶ã€‚æ­¤æ–¹æ³•ä¼šé˜»å¡çº¿ç¨‹çš„æ‰§è¡Œï¼Œç›´åˆ°å¯ä»¥è·å–é”ä¸ºæ­¢ã€‚è¿˜æœ‰ä¸€äº›å…¶ä»–æ–¹æ³•ï¼š</p>
<p><code>lockBeforeDate</code> å°è¯•åœ¨æŒ‡å®šæ—¥æœŸä¹‹å‰è·å–é”ï¼Œæ­¤æ–¹æ³•å°†é˜»å¡çº¿ç¨‹çš„æ‰§è¡Œï¼Œç›´åˆ°æ¥æ”¶è€…è·å¾—é”å®šæˆ–è¾¾åˆ°é™åˆ¶ä¸ºæ­¢ã€‚<br><code>lockWhenCondition:beforeDate</code> å°è¯•åœ¨æŒ‡å®šçš„æ—¶é—´ä¹‹å‰è·å–æŒ‡å®šé”ã€‚æ¥æ”¶è€…çš„æ¡ä»¶å¿…é¡»ç­‰äºé”å®šæ“ä½œæˆåŠŸä¹‹å‰çš„æ¡ä»¶ã€‚æ­¤æ–¹æ³•å°†é˜»æ­¢çº¿ç¨‹çš„æ‰§è¡Œï¼Œç›´åˆ°å¯ä»¥è·å–é”æˆ–è¾¾åˆ°é™åˆ¶ä¸ºæ­¢ã€‚<br><code>tryLock</code>å°è¯•è·å–é”è€Œä¸è€ƒè™‘æ¥æ”¶è€…çš„çŠ¶å†µï¼Œä¸é˜»å¡çº¿ç¨‹ã€‚<br><code>tryLockWhenCondition</code> æ ¹æ®æŒ‡å®šæ¡ä»¶å°è¯•è·å–é”ã€‚ä½œä¸ºå…¶å®ç°çš„ä¸€éƒ¨åˆ†ï¼Œæ­¤æ–¹æ³•å°†è°ƒç”¨<code>lockWhenConditionï¼šbeforeDate</code>ã€‚æ­¤æ–¹æ³•ç«‹å³è¿”å›ã€‚</p>
<h5 id="9-dispatch-semaphore"><a href="#9-dispatch-semaphore" class="headerlink" title="9.dispatch_semaphore"></a>9.<code>dispatch_semaphore</code></h5><p>é€šè¿‡éƒ½ä¿¡å·è®¡æ•°çš„æ§åˆ¶æ¥æ§åˆ¶å¹¶å‘æ•°é‡ï¼Œè¾¾åˆ°å¯¹èµ„æºçš„åŒæ­¥è®¿é—®çš„ç›®çš„ï¼Œå…·ä½“å¯ä»¥çœ‹ <a href="http://www.mwpush.com/content/d04bd655.html">[IOS.OC]GCDçš„ä½¿ç”¨ç²¾è§£(ä¸‰)</a></p>
<h5 id="10-NSDistributedLockåˆ†å¸ƒé”"><a href="#10-NSDistributedLockåˆ†å¸ƒé”" class="headerlink" title="10.NSDistributedLockåˆ†å¸ƒé”"></a>10.<code>NSDistributedLock</code>åˆ†å¸ƒé”</h5><p>åœ¨å¤šä¸ªä¸»æœºä¸Šçš„å¤šä¸ªåº”ç”¨ç¨‹åºä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>NSDistributedLock</code>ç±»æ¥é™åˆ¶å¯¹æŸäº›å…±äº«èµ„æº(æ–‡ä»¶)çš„è®¿é—®ã€‚é”å®é™…ä¸Šæ˜¯ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿé¡¹(æ–‡ä»¶æˆ–ç›®å½•)æ¥å®ç°é”çš„ã€‚æ‰€æœ‰ä½¿ç”¨<code>NSDistributedLock</code>å¯¹è±¡çš„åº”ç”¨ç¨‹åºéƒ½å¿…é¡»å¯ä»¥å†™é”ã€‚è¿™å°±æ„å‘³ç€æŠŠå®ƒæ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œæ‰€æœ‰è¿è¡Œè¯¥åº”ç”¨ç¨‹åºçš„è®¡ç®—æœºéƒ½å¯ä»¥è®¿é—®å®ƒã€‚</p>
<p>ä¸Šé¢ä¹Ÿè¯´è¿‡ï¼Œ<code>NSDistributedLock</code>æ˜¯ä¸éµå¾ª<code>NSLocking</code>åè®®çš„ï¼Œæ‰€ä»¥æ²¡æœ‰é”æ–¹æ³•ã€‚é”æ–¹æ³•å°†é˜»å¡çº¿ç¨‹çš„æ‰§è¡Œï¼Œå¹¶è¦æ±‚ç³»ç»Ÿä»¥é¢„å®šçš„é€Ÿåº¦è½®è¯¢é”å®šã€‚å½“ç„¶è¿™ä¸ªå†³å®šæƒåœ¨å¼€å‘è€…æ‰‹ä¸­ï¼Œå¯é€šè¿‡<code>tryLock</code>æ–¹æ³•æ¥å†³å®šæ˜¯å¦è½®è¯¢ã€‚<br>å¦‚æœæŒæœ‰é”çš„è¿›ç¨‹åœ¨é‡Šæ”¾å‰æŒ‚æ‰ï¼Œé‚£ä¹ˆé”å°†ä¸€ç›´å¾—ä¸åˆ°é‡Šæ”¾ï¼Œå¯é€šè¿‡<code>breakLock</code>å¼ºè¡Œè·å–é”ã€‚</p>
]]></content>
      <categories>
        <category>ç§»åŠ¨å¼€å‘</category>
        <category>IOSå¼€å‘</category>
      </categories>
      <tags>
        <tag>ObjC</tag>
        <tag>Objective-C</tag>
        <tag>ios</tag>
        <tag>çº¿ç¨‹é”</tag>
        <tag>Lock</tag>
      </tags>
  </entry>
  <entry>
    <title>[IOS.OC]IOSä¸­çš„å¤šçº¿ç¨‹</title>
    <url>/content/436b03b3.html</url>
    <content><![CDATA[<h4 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h4><p>OS Xæˆ–iOSä¸­çš„æ¯ä¸ªè¿›ç¨‹(åº”ç”¨ç¨‹åº)éƒ½ç”±ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç»„æˆï¼Œæ¯ä¸ªçº¿ç¨‹ä»£è¡¨åº”ç”¨ç¨‹åºä»£ç çš„å•ä¸€æ‰§è¡Œè·¯å¾„ã€‚æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½ä»ä¸€ä¸ªçº¿ç¨‹å¼€å§‹ï¼Œè¿™ä¸ªçº¿ç¨‹è¿è¡Œåº”ç”¨ç¨‹åºçš„ä¸»è¦åŠŸèƒ½ï¼Œç§°ä¹‹ä¸ºä¸»çº¿ç¨‹ã€‚åº”ç”¨ç¨‹åºå¯ä»¥äº§ç”Ÿé¢å¤–çš„çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œç‰¹å®šå‡½æ•°çš„ä»£ç ã€‚</p>
<p>å…³äºçº¿ç¨‹ç­‰æ¦‚å¿µçš„ä»‹ç»ï¼Œå¯ä»¥çœ‹ <a href="http://www.mwpush.com/content/edab7fec.html">å…³äºä¸²è¡Œã€å¹¶å‘ã€å¹¶è¡Œç­‰çš„è¯´æ˜</a></p>
<p>å®ç°å¤šçº¿ç¨‹çš„æ–¹æ³•ä¸»è¦æœ‰ä¸‰ç§ï¼š<code>pthread</code>ã€<code>GCD</code>ã€<code>NSThread</code>ã€<code>NSOperation</code></p>
<a id="more"></a>

<h4 id="äºŒã€çº¿ç¨‹å®ç°"><a href="#äºŒã€çº¿ç¨‹å®ç°" class="headerlink" title="äºŒã€çº¿ç¨‹å®ç°"></a>äºŒã€çº¿ç¨‹å®ç°</h4><h5 id="1-çº¿ç¨‹å¼€é”€"><a href="#1-çº¿ç¨‹å¼€é”€" class="headerlink" title="1.çº¿ç¨‹å¼€é”€"></a>1.çº¿ç¨‹å¼€é”€</h5><p>å†…æ ¸æ•°æ®ç»“æ„ï¼Œæ¯ä¸ªçº¿ç¨‹å¤§çº¦æ¶ˆè€—1KBçš„å†…æ ¸å†…å­˜ç©ºé—´ã€‚è¿™å—å†…å­˜ç”¨äºå­˜å‚¨ä¸çº¿ç¨‹æœ‰å…³çš„æ•°æ®ç»“æ„å’Œå±æ€§ï¼Œè¿™å—å†…å­˜æ˜¯è”åŠ¨å†…å­˜ï¼Œæ— æ³•è¢«åˆ†é¡µã€‚</p>
<p>æ ˆç©ºé—´ï¼Œä¸»çº¿ç¨‹çš„æ ˆç©ºé—´ä¸º1Mï¼Œæ— æ³•ä¿®æ”¹ã€‚å­çº¿ç¨‹é»˜è®¤åˆ†é…512KBçš„æ ˆç©ºé—´ï¼Œä¼šéšæ—¶ä½¿ç”¨è€Œå¢é•¿ã€‚</p>
<p>çº¿ç¨‹å¯åŠ¨å‰ï¼Œå¯ä»¥é€šè¿‡<code>setStackSize</code>è®¾ç½®æ ˆç©ºé—´çš„å¤§å°ã€‚æ ˆç©ºé—´æœ€å°ä¸º16KBï¼Œä¸”å¿…é¡»å¿…é¡»æ˜¯4KBçš„æ•´æ•°å€ã€‚</p>
<p>å¤§é‡å¼€å¯çº¿ç¨‹ä¼šé™ä½ç¨‹åºçš„æ€§èƒ½ï¼Œçº¿ç¨‹è¶Šå¤šï¼ŒCPUè°ƒåº¦çº¿ç¨‹ä¸Šçš„å¼€é”€å°±è¶Šå¤§ã€‚</p>
<h5 id="2-pthread"><a href="#2-pthread" class="headerlink" title="2.pthread"></a>2.<code>pthread</code></h5><p><code>OSIX</code>çº¿ç¨‹(<code>POSIX threads</code>)ï¼Œç®€ç§°<code>Pthreads</code>ï¼Œæ˜¯çº¿ç¨‹çš„POSIXæ ‡å‡†ï¼Œæ˜¯åŸºäºCè¯­è¨€å®ç°çš„è·¨å¹³å°çš„çº¿ç¨‹APIã€‚å¤´æ–‡ä»¶ä¸º ï¼š <code>pthread.h</code>ã€‚ç”±äº<code>pthread</code>åˆ›å»ºçš„çº¿ç¨‹æ˜¯Cè¯­è¨€å®ç°çš„ï¼Œç”Ÿå‘½å‘¨æœŸç”±ç¨‹åºå‘˜ç®¡ç†ï¼Œåœ¨OCä¸­ä½¿ç”¨é¢‘ç‡å¾ˆä½(å‡ ä¹ä¸ç”¨)ã€‚</p>
<p>ç”¨<code>pthread_create</code>åˆ›å»ºï¼Œæœ‰å››ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªä¸º<code>pthread_t</code>çº¿ç¨‹ID(çº¿ç¨‹ç¼–å·çš„åœ°å€)ï¼Œç¬¬äºŒä¸ªä¸º<code>pthread_attr_t</code>çº¿ç¨‹å±æ€§ï¼Œä¼ <code>NULL</code>è¡¨ç¤ºé‡‡ç”¨é»˜è®¤å±æ€§ï¼Œç¬¬ä¸‰ä¸ªä¸º<code>void * (*)(void *)</code>çº¿ç¨‹å®ç°å‡½æ•°ï¼Œç¬¬å››ä¸ª<code>void *restrict</code>å®ç°å‡½æ•°çš„å‚æ•°ã€‚è¿”å›å€¼ä¸º<code>int</code>ç±»å‹ï¼Œè¡¨ç¤ºçº¿ç¨‹åˆ›å»ºæˆåŠŸæˆ–å¤±è´¥ï¼Œ0è¡¨ç¤ºæˆåŠŸï¼Œé0è¡¨ç¤ºå¤±è´¥ï¼Œé0æ—¶è¿”å›é”™è¯¯ç ã€‚</p>
<p>å®ç°æ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;pthread.h&gt;</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> * <span class="title">runPthread</span><span class="params">(<span class="keyword">int</span> *param)</span></span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[])</span> </span>&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">pthread_t</span> pthreadID;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">int</span> a = <span class="number">10</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">int</span> result = pthread_create(&amp;pthreadID, <span class="literal">NULL</span>, (<span class="keyword">void</span> *)runPthread, &amp;a);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">if</span>(!result)&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        NSLog(@<span class="string">"çº¿ç¨‹åˆ›å»ºæˆåŠŸï¼"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;<span class="keyword">else</span> NSLog(@<span class="string">"çº¿ç¨‹åˆ›å»ºå¤±è´¥:%d"</span>, result);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> * <span class="title">runPthread</span><span class="params">(<span class="keyword">int</span> *param)</span> </span>&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    NSLog(@<span class="string">"%d"</span>, *param);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>ä¼ OCå¯¹è±¡å‚æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;pthread.h&gt;</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> * runPthread(<span class="keyword">void</span> *param);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[]) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    pthread_t pthreadID;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSString</span> * param = <span class="string">@"æˆ‘æ˜¯å‚æ•°"</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">int</span> result = pthread_create(&amp;pthreadID, <span class="literal">NULL</span>, (<span class="keyword">void</span> *)runPthread, (__bridge <span class="keyword">void</span> *)param);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">if</span>(!result)&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹åˆ›å»ºæˆåŠŸï¼"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;<span class="keyword">else</span> <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹åˆ›å»ºå¤±è´¥:%d"</span>, result);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> * runPthread(<span class="keyword">void</span> *param) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, (__bridge <span class="built_in">NSString</span> *)param);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>



<h5 id="3-NSThread"><a href="#3-NSThread" class="headerlink" title="3.NSThread"></a>3.<code>NSThread</code></h5><p>ä¸€ä¸ª<code>NSThread</code>å¯¹è±¡ä»£è¡¨ä¸€æ¡çº¿ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨ç±»æ–¹æ³•æˆ–å®ä¾‹æ–¹æ³•åˆ›å»ºã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨ç±»æ–¹æ³•åˆ›å»º</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span></pre></td></tr><tr><td class="code"><pre><span class="line">   </span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="built_in">NSThread</span> detachNewThreadSelector:<span class="keyword">@selector</span>(newThreadMethod) toTarget:<span class="keyword">self</span> withObject:<span class="literal">nil</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">  </span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//  	ä½¿ç”¨blockæ–¹å¼åˆ›å»º</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//    [NSThread detachNewThreadWithBlock:^&#123; /* çº¿ç¨‹éœ€è¦æ‰§è¡Œçš„å†…å®¹ */ &#125;];</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)newThreadMethod &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹:%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">çº¿ç¨‹:&lt;NSThread: <span class="number">0</span>x60000297b340&gt;&#123;number = <span class="number">6</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr></table></figure>

<p>ä½¿ç”¨ç±»æ–¹æ³•åˆ›å»ºï¼Œç±»æ–¹æ³•æ— è¿”å›å€¼ï¼Œæ‰€ä»¥ä¸èƒ½å¯¹çº¿ç¨‹åšåšæ“ã€‚åˆ›å»ºåä¼šç›´æ¥å¯åŠ¨çº¿ç¨‹æ‰§è¡Œã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å®ä¾‹æ–¹æ³•åˆ›å»º</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span></pre></td></tr><tr><td class="code"><pre><span class="line">   </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSThread</span> * thread = [[<span class="built_in">NSThread</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(newThreadMethod:) object:<span class="string">@"åˆ›å»ºæ–°çº¿ç¨‹"</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [thread start];</span></pre></td></tr><tr><td class="code"><pre><span class="line">  </span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//  	ä½¿ç”¨blockæ–¹å¼åˆ›å»º    </span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//    NSThread * thread = [[NSThread alloc] initWithBlock:^&#123; /* çº¿ç¨‹éœ€è¦æ‰§è¡Œçš„å†…å®¹ */&#125;];</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)newThreadMethod:(<span class="built_in">NSString</span> *)str &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, str);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹:%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">åˆ›å»ºæ–°çº¿ç¨‹</span></pre></td></tr><tr><td class="code"><pre><span class="line">çº¿ç¨‹:&lt;NSThread: <span class="number">0</span>x6000038a3000&gt;&#123;number = <span class="number">7</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr></table></figure>

<p>ä½¿ç”¨å®ä¾‹æ–¹æ³•åˆ›å»ºçº¿ç¨‹ï¼Œè¿”å›çº¿ç¨‹çš„å®ä¾‹ï¼Œå¯ä»¥è®¾ç½®ä¸€äº›å±æ€§ã€‚çº¿ç¨‹åˆ›å»ºåï¼Œéœ€æ‰‹åŠ¨å¼€å¯æ‰§è¡Œã€‚</p>
<p>å±æ€§è®¾ç½®</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span></pre></td></tr><tr><td class="code"><pre><span class="line">   </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSThread</span> * thread = [[<span class="built_in">NSThread</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(newThreadMethod) object:<span class="literal">nil</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">//è®¾ç½®çº¿ç¨‹åç§°ï¼Œæ–¹ä¾¿debug</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    thread.name = <span class="string">@"new thread"</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">//æœåŠ¡è´¨é‡(ä¼˜å…ˆçº§)</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    thread.qualityOfService = <span class="built_in">NSQualityOfServiceDefault</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">//è®¾ç½®çº¿ç¨‹åˆ†é…lç©ºé—´ï¼Œå•ä½å­—èŠ‚ï¼Œä¸è®¾ç½®ä¼šä½¿ç”¨é»˜è®¤å€¼ï¼Œä¸º512*1024,512KBï¼Œè¿™é‡Œæˆ‘ä»¬è®¾ç½®ä¸º1024KB</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    [thread setStackSize:<span class="number">1024</span>*<span class="number">1024</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [thread start];</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)newThreadMethod &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">//è¿”å›å½“å‰çº¿ç¨‹å¯¹è±¡</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSThread</span> * currentThread = [<span class="built_in">NSThread</span> currentThread];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">//è¿”å›æ ˆç©ºé—´å¤§å°ï¼Œå•ä½ä¸ºå­—èŠ‚</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSUInteger</span> stackSize = [currentThread stackSize];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">//åˆ¤æ–­currentThreadæ˜¯å¦æ˜¯ä¸»çº¿ç¨‹</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">BOOL</span> isMainThread = [currentThread isMainThread];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">//çº¿ç¨‹æ˜¯å¦å¤„äºæ‰§è¡ŒçŠ¶æ€</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">BOOL</span> isExecuting = [currentThread isExecuting];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">//è¿”å›currentThreadçš„ä¼˜å…ˆçº§</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">double</span> priority = [currentThread threadPriority];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">//çº¿ç¨‹æ˜¯å¦è¢«å–æ¶ˆ</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">BOOL</span> isCancelled = [currentThread isCancelled];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">//çº¿ç¨‹æ˜¯å¦æ‰§è¡Œå®Œæ¯•</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">BOOL</span> isFinished = [currentThread isFinished];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">//è¾“å‡ºçº¿ç¨‹å­—å…¸</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"dic:%@"</span>, currentThread.threadDictionary);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"æ ˆç©ºé—´:%luKB"</span>, stackSize/<span class="number">1024</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"æ˜¯å¦æ˜¯ä¸»çº¿ç¨‹:%@"</span>, isMainThread ? <span class="string">@"æ˜¯"</span> : <span class="string">@"ä¸æ˜¯"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"æ˜¯å¦å¤„äºæ‰§è¡ŒçŠ¶æ€:%@"</span>, isExecuting ? <span class="string">@"æ˜¯"</span> : <span class="string">@"ä¸æ˜¯"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä¼˜å…ˆçº§:%f"</span>, priority);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹æ˜¯å¦è¢«å–æ¶ˆ:%@"</span>, isCancelled ? <span class="string">@"æ˜¯"</span> : <span class="string">@"å¦"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹æ˜¯å¦æ‰§è¡Œå®Œæ¯•:%@"</span>, isFinished ? <span class="string">@"æ˜¯"</span> : <span class="string">@"å¦"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">if</span>(!isCancelled)&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="comment">//å–æ¶ˆçº¿ç¨‹</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">        [currentThread cancel];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">//å†æ¬¡åˆ¤æ–­çº¿ç¨‹æ˜¯å¦è¢«å–æ¶ˆ</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">if</span>([currentThread isCancelled])&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹è¢«å–æ¶ˆ"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;<span class="keyword">else</span> <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹æ²¡è¢«å–æ¶ˆ"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">//å†æ¬¡åˆ¤æ–­çº¿ç¨‹æ˜¯å¦æ‰§è¡Œå®Œæ¯•</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">if</span>([currentThread isFinished])&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"æ‰§è¡Œå®Œæ¯•"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;<span class="keyword">else</span> <span class="built_in">NSLog</span>(<span class="string">@"æœªæ‰§è¡Œå®Œæ¯•"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">dic:&#123;&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">æ ˆç©ºé—´:<span class="number">1024</span>KB</span></pre></td></tr><tr><td class="code"><pre><span class="line">æ˜¯å¦æ˜¯ä¸»çº¿ç¨‹:ä¸æ˜¯</span></pre></td></tr><tr><td class="code"><pre><span class="line">æ˜¯å¦å¤„äºæ‰§è¡ŒçŠ¶æ€:æ˜¯</span></pre></td></tr><tr><td class="code"><pre><span class="line">ä¼˜å…ˆçº§:<span class="number">0</span><span class="variable">.500000</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">çº¿ç¨‹æ˜¯å¦è¢«å–æ¶ˆ:å¦</span></pre></td></tr><tr><td class="code"><pre><span class="line">çº¿ç¨‹æ˜¯å¦æ‰§è¡Œå®Œæ¯•:å¦</span></pre></td></tr><tr><td class="code"><pre><span class="line">çº¿ç¨‹è¢«å–æ¶ˆ</span></pre></td></tr><tr><td class="code"><pre><span class="line">æœªæ‰§è¡Œå®Œæ¯•</span></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œå½“è°ƒç”¨<code>cancel</code>æ–¹æ³•åçº¿æ€§è¢«å–æ¶ˆï¼Œä½†æ˜¯çº¿ç¨‹ä¸­æœªæ‰§è¡Œå®Œçš„ä»£ç ä¼šç»§ç»­æ‰§è¡Œå®Œæ¯•ã€‚çº¿ç¨‹è¿˜æœ‰ä¸€ä¸ª<code>exit</code>ç±»æ–¹æ³•ä¸ºå¼ºåˆ¶é€€å‡ºï¼Œå¼ºåˆ¶é€€å‡ºåˆ™ç›´æ¥é€€å‡ºï¼Œæœªæ‰§è¡Œçš„ä»£ç ä¸å†æ‰§è¡Œã€‚ä¸è¦åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨<code>exit</code>æ–¹æ³•ï¼Œå› ä¸ºè°ƒç”¨åçº¿ç¨‹å°†è¿›å…¥æ­»äº¡çŠ¶æ€ï¼Œæ— æ³•å†æ¬¡å¯åŠ¨ï¼Œç•Œé¢ä¸ä¼šå´©æºƒï¼Œä½†æ— æ³•æ“ä½œã€‚</p>
<p>ä¸€äº›ç±»æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ä¸ºä¸»çº¿ç¨‹</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">[<span class="built_in">NSThread</span> isMainThread];</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//è¿”å›ä¸»çº¿ç¨‹å¯¹è±¡</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">[<span class="built_in">NSThread</span> mainThread];</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//è¿”å›åº”ç”¨æ˜¯å¦ä¸ºå¤šçº¿ç¨‹ç¯å¢ƒ</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">[<span class="built_in">NSThread</span> isMultiThreaded];</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//è¿”å›ä¸€ä¸ªåŒ…å«è°ƒç”¨å †æ ˆè¿”å›åœ°å€çš„æ•°ç»„</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">[<span class="built_in">NSThread</span> callStackReturnAddresses];</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//è¿”å›ä¸€ä¸ªåŒ…å«è°ƒç”¨å †æ ˆç¬¦å·çš„æ•°ç»„</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">[<span class="built_in">NSThread</span> callStackSymbols];</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//ç¡çœ ä¸€ç§’(æ—¶é—´ç§’)</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">[<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">1</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//ç¡çœ ï¼Œé˜»å¡å½“å‰çº¿ç¨‹ç›´åˆ°æŒ‡å®šçš„æ—¶é—´</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">[<span class="built_in">NSThread</span> sleepUntilDate:[<span class="built_in">NSDate</span> dateWithTimeIntervalSinceNow:<span class="number">1</span>]];</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§(é€šå¸¸ä¸ç”¨è®¾ç½®)ï¼Œå€¼èŒƒå›´0.0~1.0ï¼Œé»˜è®¤å€¼ä¸º0.5ï¼Œå€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œä½†å¹¶ä¸ä¿è¯ä¼˜å…ˆçº§é«˜çš„ä»»åŠ¡ä¸€å®šä¼šå…ˆæ‰§è¡Œ</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">[<span class="built_in">NSThread</span> setThreadPriority:<span class="number">1.0</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//è¿”å›å½“å‰çº¿ç¨‹çš„ä¼˜å…ˆçº§</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">[<span class="built_in">NSThread</span> threadPriority];</span></pre></td></tr></table></figure>

<p><code>NSThread</code>ä¸­è¿˜æœ‰ä¸€ä¸ª<code>main</code>æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å­ç±»åŒ–<code>NSThread</code>ï¼Œå¹¶é‡å†™<code>main</code>æ–¹æ³•ï¼Œä»¥è¦†ç›–ä¸»æ–¹æ³•æ¥å®ç°è‡ªå·±çš„çº¿ç¨‹å…¥å£ç‚¹ã€‚å¦‚æœå¤å†™äº†<code>main</code>æ–¹æ³•å°±ä¸è¦è°ƒç”¨<code>super</code>æ¥è°ƒç”¨ç»§æ‰¿è¡Œä¸ºã€‚ ä¸è¦ä¸»åŠ¨è°ƒç”¨<code>main</code>æ–¹æ³•ï¼Œåº”é€šè¿‡<code>start</code>æ–¹æ³•æ¥å¯åŠ¨ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyThread</span> : <span class="title">NSThread</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@end</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ†å‰²çº¿</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"MyThread.h"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MyThread</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)main &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹å¯åŠ¨äº†ï¼š%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@end</span></span></pre></td></tr></table></figure>

<p>ä½¿ç”¨</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span></pre></td></tr><tr><td class="code"><pre><span class="line"> </span></pre></td></tr><tr><td class="code"><pre><span class="line">    MyThread * mythread = [[MyThread alloc] init];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [mythread start];</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">çº¿ç¨‹å¯åŠ¨äº†ï¼š&lt;MyThread: <span class="number">0</span>x60000019bd80&gt;&#123;number = <span class="number">6</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr></table></figure>

<p>åœ¨<code>NSThread</code>çš„å¤´æ–‡ä»¶ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ª<code>NSObject</code>çš„åˆ†ç±»<code>NSObject (NSThreadPerformAdditions)</code>ï¼Œé‡Œé¢æä¾›äº†ä¸€äº›å®ä¾‹æ–¹æ³•ï¼Œéƒ½æ˜¯è·Ÿçº¿ç¨‹ç›¸å…³çš„ï¼Œè¿™æ˜¯<code>NSObject</code>æä¾›çš„å¤šçº¿ç¨‹æ–¹æ³•ï¼Œä¸»è¦ç”¨æ¥å®ç°çº¿ç¨‹é—´çš„é€šä¿¡ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* </span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">æ–¹æ³•1ï¼šä½¿ç”¨æŒ‡å®šæ¨¡å¼è°ƒç”¨åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œçš„æŒ‡å®šæ–¹æ³•</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">ç¬¬ä¸€ä¸ªä¸ºæ–¹æ³•é€‰æ‹©å™¨ï¼Œç¬¬äºŒä¸ªä¸ºå‚æ•°ï¼Œç¬¬ä¸‰ä¸ªä¸ºåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡ŒæŒ‡å®šæ–¹æ³•åï¼Œæ˜¯å¦é˜»å¡å½“å‰çº¿ç¨‹ï¼ŒYES æ˜¯ NO å¦ï¼Œ</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">å¦‚æœå½“å‰çº¿ç¨‹ä¸ºä¸»çº¿ç¨‹ï¼Œåˆ™ä¸ä¼šé˜»å¡ï¼Œè®¾ç½®ä¸ºYESæ—¶ï¼Œæ¶ˆæ¯(æ–¹æ³•)å°†è¢«ç«‹å³æ‰§è¡Œï¼Œå¦åˆ™æ’é˜Ÿç­‰å¾…ä¸‹æ¬¡è¿è¡Œå¾ªç¯æ‰§è¡Œã€‚</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">ç¬¬å››ä¸ªä¸ºæ¨¡å¼æ•°ç»„ï¼Œä¸èƒ½ä¸ºç©ºï¼Œå¦åˆ™å°†ä¸æ‰§è¡Œè°ƒç”¨æ–¹æ³•</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">*/</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">[<span class="keyword">self</span> performSelectorOnMainThread:<span class="keyword">@selector</span>(callThreadMethod) withObject:<span class="literal">nil</span> waitUntilDone:<span class="literal">NO</span> modes:@[<span class="built_in">NSRunLoopCommonModes</span>]];</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">æ–¹æ³•2ï¼šåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡ŒæŒ‡å®šçš„æ–¹æ³•</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">ç¬¬ä¸€ä¸ªä¸ºæ–¹æ³•é€‰æ‹©å™¨ï¼Œç¬¬äºŒä¸ªä¸ºå‚æ•°ï¼Œç¬¬ä¸‰ä¸ªä¸ºåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡ŒæŒ‡å®šæ–¹æ³•åï¼Œæ˜¯å¦é˜»å¡å½“å‰çº¿ç¨‹ï¼ŒYES æ˜¯ NO å¦</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">å¦‚æœå½“å‰çº¿ç¨‹ä¸ºä¸»çº¿ç¨‹ï¼Œåˆ™ä¸ä¼šé˜»å¡ï¼Œè®¾ç½®ä¸ºYESæ—¶ï¼Œæ¶ˆæ¯(æ–¹æ³•)å°†è¢«ç«‹å³ä¼ é€å’Œå¤„ç†ã€‚å½“æ–¹æ³•1æ¨¡å¼ä¸º</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">NSRunLoopCommonModesæ—¶ï¼ŒåŠŸèƒ½åŒæ­¤æ–¹æ³•</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">*/</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">[<span class="keyword">self</span> performSelectorOnMainThread:<span class="keyword">@selector</span>(callThreadMethod) withObject:<span class="literal">nil</span> waitUntilDone:<span class="literal">NO</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">æ–¹æ³•3ï¼šä½¿ç”¨æŒ‡å®šæ¨¡å¼è°ƒç”¨åœ¨æŒ‡å®šçº¿ç¨‹ä¸­æ‰§è¡Œçš„æŒ‡å®šæ–¹æ³•</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">ç¬¬ä¸€ä¸ªä¸ºæ–¹æ³•é€‰æ‹©å™¨ï¼Œç¬¬äºŒä¸ªä¸ºè¦æ‰§è¡Œæ–¹æ³•çš„çº¿ç¨‹ï¼Œç¬¬ä¸‰ä¸ªä¸ºå‚æ•°ï¼Œç¬¬å››ä¸ªä¸ºåœ¨æŒ‡å®šçº¿ç¨‹ä¸­æ‰§è¡ŒæŒ‡å®šæ–¹æ³•åï¼Œæ˜¯å¦é˜»</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">å¡å½“å‰çº¿ç¨‹ï¼ŒYES æ˜¯ NO å¦ã€‚å¦‚æœå½“å‰çº¿ç¨‹å’Œç›®æ ‡çº¿ç¨‹ä¸ºåŒä¸€çº¿ç¨‹ï¼Œåˆ™ä¸ä¼šé˜»å¡ï¼Œè®¾ç½®ä¸ºYESæ—¶ï¼Œæ¶ˆæ¯(æ–¹æ³•)å°†è¢«ç«‹</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">å³æ‰§è¡Œï¼Œå¦åˆ™å°†æ’é˜Ÿæ‰§è¡Œã€‚</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">ç¬¬äº”ä¸ªå‚æ•°ä¸ºæ¨¡å¼æ•°ç»„ï¼Œä¸èƒ½ä¸ºç©ºï¼Œå¦åˆ™å°†ä¸æ‰§è¡Œè°ƒç”¨æ–¹æ³•</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">*/</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">[<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(callThreadMethod) onThread:thread withObject:<span class="literal">nil</span> waitUntilDone:<span class="literal">NO</span> modes:@[<span class="built_in">NSRunLoopCommonModes</span>]];</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">æ–¹æ³•4ï¼šåœ¨æŒ‡å®šçº¿ç¨‹ä¸­æ‰§è¡ŒæŒ‡å®šæ–¹æ³•</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">ç¬¬ä¸€ä¸ªä¸ºæ–¹æ³•é€‰æ‹©å™¨ï¼Œç¬¬äºŒä¸ªä¸ºè¦æ‰§è¡Œæ–¹æ³•çš„çº¿ç¨‹ï¼Œç¬¬ä¸‰ä¸ªä¸ºä»å‚æ•°ï¼Œç¬¬å››ä¸ªä¸ºåœ¨æŒ‡å®šçº¿ç¨‹ä¸­æ‰§è¡ŒæŒ‡å®šæ–¹æ³•åï¼Œæ˜¯å¦é˜»å¡</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">å½“å‰çº¿ç¨‹ï¼ŒYES æ˜¯ NO å¦ã€‚å¦‚æœå½“å‰çº¿ç¨‹å’Œç›®æ ‡çº¿ç¨‹ä¸ºåŒä¸€çº¿ç¨‹ï¼Œåˆ™ä¸ä¼šé˜»å¡ï¼Œè®¾ç½®ä¸ºYESæ—¶ï¼Œæ¶ˆæ¯(æ–¹æ³•)å°†è¢«ç«‹å³æ‰§</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">è¡Œï¼Œå¦åˆ™å°†æ’é˜Ÿæ‰§è¡Œã€‚</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">æ³¨æ„ï¼šæ­¤æ–¹æ³•æ·»åŠ çš„æ–¹æ³•æ˜¯åœ¨ç›®æ ‡çº¿ç¨‹çš„è¿è¡Œå¾ªç¯ä¸Šæ’é˜Ÿæ‰§è¡Œï¼Œå¦‚æœç›®æ ‡é˜Ÿåˆ—æ²¡æœ‰å¼€å¯è¿è¡Œå¾ªç¯(RunLoop)åˆ™åˆ™ä¸ä¼šæ‰§è¡Œã€‚</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">*/</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">[<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(callMainThreadMethod) onThread:thread withObject:<span class="literal">nil</span> waitUntilDone:<span class="literal">NO</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">æ–¹æ³•5ï¼šåœ¨åå°(å­çº¿ç¨‹)æ‰§è¡ŒæŒ‡å®šæ–¹æ³•</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">ç¬¬ä¸€ä¸ªä¸ºæ–¹æ³•é€‰æ‹©å™¨ï¼Œç¬¬äºŒä¸ªä¸ºå‚æ•°</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">*/</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">[<span class="keyword">self</span> performSelectorInBackground:<span class="keyword">@selector</span>(callThreadMethod) withObject:<span class="literal">nil</span>];</span></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šä»¥ä¸Šæ–¹æ³•æ·»åŠ çš„æ–¹æ³•éƒ½æ˜¯åœ¨ç›®æ ‡çº¿ç¨‹çš„è¿è¡Œå¾ªç¯ä¸Šæ’é˜Ÿæ‰§è¡Œï¼Œå¦‚æœç›®æ ‡é˜Ÿåˆ—æ²¡æœ‰å¼€å¯è¿è¡Œå¾ªç¯(RunLoop)åˆ™åˆ™ä¸ä¼šæ‰§è¡Œã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span></pre></td></tr><tr><td class="code"><pre><span class="line"> </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSThread</span> * thread = [[<span class="built_in">NSThread</span> alloc] initWithBlock:^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"åˆ›å»ºçš„çº¿ç¨‹ï¼š%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [thread start];</span></pre></td></tr><tr><td class="code"><pre><span class="line">  </span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(callThreadMethod) onThread:thread withObject:<span class="literal">nil</span> waitUntilDone:<span class="literal">NO</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)callThreadMethod &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"æ·»åŠ çš„æ‰§è¡Œæ–¹æ³•:%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">åˆ›å»ºçš„çº¿ç¨‹ï¼š&lt;NSThread: <span class="number">0</span>x600003e4f680&gt;&#123;number = <span class="number">7</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr></table></figure>

<p>å‘ç°ï¼Œé€šè¿‡<code>performSelector</code>æ·»åŠ åˆ°<code>thread</code>çš„æ–¹æ³•<code>callThreadMethod</code>å¹¶æ²¡æœ‰æ‰§è¡Œã€‚å› ä¸ºç›®æ ‡é˜Ÿåˆ—æ²¡æœ‰å¯åŠ¨è¿è¡Œå¾ªç¯ï¼Œè‡³äºæ–¹æ³•1å’Œæ–¹æ³•2ï¼Œå› ä¸ºæ˜¯è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸Šï¼Œä¸»çº¿ç¨‹é»˜è®¤æ˜¯å¼€å¯äº†è¿è¡Œå¾ªç¯çš„ï¼Œå¯ä»¥æ‰§è¡Œï¼Œè€Œæˆ‘ä»¬åˆ›å»ºçš„çº¿ç¨‹é»˜è®¤æ˜¯æ²¡æœ‰åˆ›å»ºè¿è¡Œå¾ªç¯çš„ï¼Œå®ƒç›´åˆ°æˆ‘ä»¬è·å–æ‰ä¼šåˆ›å»ºã€‚æ‰€ä»¥åšå¦‚ä¸‹æ›´æ”¹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span></pre></td></tr><tr><td class="code"><pre><span class="line"> </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSThread</span> * thread = [[<span class="built_in">NSThread</span> alloc] initWithBlock:^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"åˆ›å»ºçš„çº¿ç¨‹ï¼š%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        [[<span class="built_in">NSRunLoop</span> currentRunLoop] run];</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="comment">//æ­¤å¤„ä»£ç æ°¸è¿œä¸ä¼šæ‰§è¡Œ</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [thread start];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(callThreadMethod) onThread:thread withObject:<span class="literal">nil</span> waitUntilDone:<span class="literal">NO</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)callThreadMethod &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"æ·»åŠ çš„æ‰§è¡Œæ–¹æ³•:%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">åˆ›å»ºçš„çº¿ç¨‹ï¼š&lt;NSThread: <span class="number">0</span>x600000506880&gt;&#123;number = <span class="number">6</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">æ·»åŠ çš„æ‰§è¡Œæ–¹æ³•:&lt;NSThread: <span class="number">0</span>x600000506880&gt;&#123;number = <span class="number">6</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr></table></figure>

<p>å› ä¸ºè¿è¡Œå¾ªç¯æ˜¯ä¸€ä¸ªæ­»å¾ªç¯ï¼Œæ‰€ä»¥ä¸Šé¢ä»£ç æ³¨é‡Šçš„åœ°æ–¹æ°¸è¿œä¸ä¼šè®¿é—®åˆ°ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„æ–¹å¼æ”¹å–„ä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">self</span>.isFinished = <span class="literal">NO</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSThread</span> * thread = [[<span class="built_in">NSThread</span> alloc] initWithBlock:^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"åˆ›å»ºçš„çº¿ç¨‹ï¼š%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        [[<span class="built_in">NSRunLoop</span> currentRunLoop] runUntilDate:[<span class="built_in">NSDate</span> date]];</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"åé¢æ‰§è¡Œçš„ä»»åŠ¡"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        </span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [thread start];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(callThreadMethod) onThread:thread withObject:<span class="literal">nil</span> waitUntilDone:<span class="literal">NO</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)callThreadMethod &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"æ·»åŠ çš„æ‰§è¡Œæ–¹æ³•:%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">åˆ›å»ºçš„çº¿ç¨‹ï¼š&lt;NSThread: <span class="number">0</span>x600001812900&gt;&#123;number = <span class="number">6</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">æ·»åŠ çš„æ‰§è¡Œæ–¹æ³•:&lt;NSThread: <span class="number">0</span>x600001812900&gt;&#123;number = <span class="number">6</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">åé¢æ‰§è¡Œçš„ä»»åŠ¡</span></pre></td></tr></table></figure>

<p><code>runUntilDate</code>å‚æ•°ä¼ å…¥å½“å‰æ—¥æœŸå³å¯ï¼Œå®ƒä¼šç»™ä½ è¶³å¤Ÿçš„æ—¶é—´æ‰§è¡Œæ‰€éœ€çš„ä»»åŠ¡ã€‚å¦‚æœä¼ å…¥å°†æ¥çš„æ—¶é—´ï¼Œåˆ™ä¼šå µå¡å½“å‰çº¿ç¨‹ã€‚å½“ç„¶è¿˜æœ‰åˆ«çš„æ–¹å¼ï¼Œåç»­çš„<code>RunLoop</code>æ€»ç»“ä¸­ä¼šåšè¯´æ˜ã€‚</p>
<h5 id="4-NSOperationä¸NSOperationQueue"><a href="#4-NSOperationä¸NSOperationQueue" class="headerlink" title="4.NSOperationä¸NSOperationQueue"></a>4.<code>NSOperation</code>ä¸<code>NSOperationQueue</code></h5><p><code>NSOperation</code>æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç³»ç»Ÿå®šä¹‰å¥½çš„å®ƒçš„å­ç±»<code>NSInvocationOperation</code>å’Œ<code>NSBlockOperation</code>ï¼Œæˆ–è‡ªå®šä¹‰<code>NSOperation</code>çš„æ´¾ç”Ÿç±»ã€‚</p>
<p><code>NSInvocationOperation</code>å¯ä»¥åˆ›å»ºä¸€ä¸ªéå¹¶å‘æ“ä½œã€‚å®ƒæœ¬èº«ä¸ä¼šå¼€è¾Ÿçº¿ç¨‹ï¼Œä¼šåœ¨åˆ›å»ºçš„çº¿ç¨‹ä¸­æ‰§è¡Œã€‚åˆ›å»ºåéœ€è¦è°ƒç”¨<code>start</code>æ–¹æ³•å¯åŠ¨ã€‚</p>
<p>åˆ›å»ºæ–¹æ³•1ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSThread</span> * thread = [[<span class="built_in">NSThread</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(callThreadMethod) object:<span class="literal">nil</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [thread start];</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)callThreadMethod &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡æ‰§è¡Œçº¿ç¨‹ï¼š%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSInvocationOperation</span> * invocationOperation = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(invocationOperationMethod) object:<span class="literal">nil</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [invocationOperation start];</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)invocationOperationMethod &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"invocationOperationçº¿ç¨‹ï¼š%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">ä»»åŠ¡æ‰§è¡Œçº¿ç¨‹ï¼š&lt;NSThread: <span class="number">0</span>x600001008100&gt;&#123;number = <span class="number">7</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">invocationOperationçº¿ç¨‹ï¼š&lt;NSThread: <span class="number">0</span>x600001008100&gt;&#123;number = <span class="number">7</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr></table></figure>

<p>åˆ›å»ºæ–¹æ³•2ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSThread</span> * thread = [[<span class="built_in">NSThread</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(callThreadMethod) object:<span class="literal">nil</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [thread start];</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)callThreadMethod &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡æ‰§è¡Œçº¿ç¨‹ï¼š%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSMethodSignature</span> * signature = [[<span class="keyword">self</span> <span class="keyword">class</span>] instanceMethodSignatureForSelector:<span class="keyword">@selector</span>(invocationOperationMethod)];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSInvocation</span> * invocation = [<span class="built_in">NSInvocation</span> invocationWithMethodSignature:signature];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    invocation.target = <span class="keyword">self</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    invocation.selector = <span class="keyword">@selector</span>(invocationOperationMethod);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSInvocationOperation</span> * invocationOperation = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithInvocation:invocation];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [invocationOperation start];</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)invocationOperationMethod &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"invocationOperationçº¿ç¨‹ï¼š%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>PSï¼š<code>NSInvocation</code>ä¸»è¦ç”¨äºåœ¨å¯¹è±¡åŠåº”ç”¨ä¹‹é—´å­˜å‚¨å’Œè½¬å‘æ¶ˆæ¯ï¼Œ<code>NSInvocation</code>å¯ä»¥è®¾ç½®å¤šä¸ªå‚æ•°ï¼Œä¸è¦ç›´æ¥è°ƒç”¨<code>init</code>æ–¹æ³•åˆå§‹åŒ–ã€‚</p>
<p><code>NSBlockOperation</code>ç®¡ç†ä¸€ä¸ªæˆ–å¤šä¸ªå—çš„å¹¶å‘æ“ä½œã€‚å½“æ‰§è¡Œå¤šä¸ªå—æ“ä½œæ—¶ï¼Œåªæœ‰å½“æ‰€æœ‰å—æ‰§è¡Œå®Œæ¯•åï¼Œæ“ä½œæœ¬èº«æ‰è¢«è§†ä¸ºå®Œæˆã€‚æ·»åŠ åˆ°å—æ“ä½œä¸­çš„ä»»åŠ¡ä¼šè¢«è°ƒåº¦åˆ°é€‚å½“çš„å·¥ä½œé˜Ÿåˆ—ã€‚å—åˆ›å»ºå¥½åï¼Œå¯ä»¥æ‰§è¡Œæ·»åŠ å—ä»»åŠ¡æ“ä½œï¼Œä¹Ÿå¯ä»¥æŸ¥çœ‹å—ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">NSBlockOperation</span> * blockOperation = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"blockOperationä»»åŠ¡1ï¼š%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;];</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">[blockOperation addExecutionBlock:^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"blockOperationè¿½åŠ ä»»åŠ¡1ï¼š%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;];</span></pre></td></tr><tr><td class="code"><pre><span class="line">[blockOperation addExecutionBlock:^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"blockOperationè¿½åŠ ä»»åŠ¡2ï¼š%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;];</span></pre></td></tr><tr><td class="code"><pre><span class="line">[blockOperation start];</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [blockOperation executionBlocks]);</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">blockOperationè¿½åŠ ä»»åŠ¡1ï¼š&lt;NSThread: 0x6000032bfa80&gt;&#123;number &#x3D; 6, name &#x3D; (null)&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">blockOperationä»»åŠ¡1ï¼š&lt;NSThread: 0x6000032f6500&gt;&#123;number &#x3D; 1, name &#x3D; main&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">blockOperationè¿½åŠ ä»»åŠ¡2ï¼š&lt;NSThread: 0x6000032c3180&gt;&#123;number &#x3D; 5, name &#x3D; (null)&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">(</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &quot;&lt;__NSGlobalBlock__: 0x101c9c060&gt;&quot;,</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &quot;&lt;__NSGlobalBlock__: 0x101c9c080&gt;&quot;,</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &quot;&lt;__NSGlobalBlock__: 0x101c9c0a0&gt;&quot;</span></pre></td></tr><tr><td class="code"><pre><span class="line">)</span></pre></td></tr></table></figure>



<p>è‡ªå®šä¹‰<code>NSOperation</code>å­ç±»ï¼Œè‡ªå®šä¹‰å­ç±»éœ€è¦æ ¹æ®éœ€è¦è®¾è®¡å¹¶å‘ä¸éå¹¶å‘ï¼Œéå¹¶å‘åªéœ€è¦é‡å†™<code>main</code>æ–¹æ³•å³å¯ï¼Œå¯ä»¥è‡ªå®šä¹‰åˆå§‹åŒ–è¡Œä¸ºï¼Œ<code>main</code>æ–¹æ³•ä¸­å®ç°å…·ä½“çš„ä»»åŠ¡ä»£ç ã€‚ä½¿ç”¨æ—¶ï¼Œé€šè¿‡<code>start</code>å¯åŠ¨ä»»åŠ¡å³å¯ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"MyOperation.h"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MyOperation</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)main &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">if</span>(!<span class="keyword">self</span>.isCancelled)&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"å…·ä½“ä»»åŠ¡ä»£ç "</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//        @autoreleasepool &#123;</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//        &#125;</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@end</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ†å‰²çº¿,ä¸‹é¢ä¸ºè°ƒç”¨æ–¹æ³•</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">MyOperation * myOperation = [[MyOperation alloc] init];</span></pre></td></tr><tr><td class="code"><pre><span class="line">[myOperation start];</span></pre></td></tr></table></figure>

<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">å…·ä½“ä»»åŠ¡ä»£ç </span></pre></td></tr></table></figure>

<p>å¦‚æœè®¾è®¡å¹¶å‘æ“ä½œï¼Œåˆ™éœ€è¦è¦†ç›–<code>start</code>ã€<code>asynchronous</code>ã€<code>executing</code>ã€<code>finished</code>ï¼Œ<code>start</code>è´Ÿè´£ä»¥å¼‚æ­¥çš„æ–¹å¼å¯åŠ¨æ“ä½œï¼Œè¿˜åº”è¯¥è´Ÿè´£æ›´æ–°æ‰§è¡ŒçŠ¶æ€ï¼Œå¯é€šè¿‡<code>KVO</code>æ–¹å¼é€šçŸ¥ï¼Œè€Œä¸”è¿˜è¦ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚è¿˜æœ‰è®¸å¤šæ³¨æ„äº‹é¡¹ï¼Œå¯æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚</p>
<p>ä»¥ä¸Šéƒ½æ˜¯é€šè¿‡è‡ªå®šä¹‰<code>NSOperation</code>å­ç±»æˆ–ä½¿ç”¨ç³»ç»Ÿæä¾›çš„å­ç±»æ¥å®ç°æ“ä½œçš„ã€‚åœ¨<code>NSOperation</code>æŠ½è±¡ç±»ä¸­æä¾›äº†å¾ˆå¤šå…³é”®è¡Œä¸ºï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œæˆ‘ä»¬ä»¥<code>NSBlockOperation</code>ä¸ºä¾‹ï¼Œè¿›è¡Œè¯´æ˜ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSBlockOperation</span> * blockOperation;</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@end</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">self</span>.blockOperation = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"blockOperationä»»åŠ¡1ï¼š%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSBlockOperation</span> * operation1 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"è¢«ä¾èµ–çš„æ“ä½œä»»åŠ¡"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    [operation1 addExecutionBlock:^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"è¢«ä¾èµ–çš„æ“ä½œä»»åŠ¡"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">//å¯¹äºæ“ä½œç³»ç»Ÿèµ„æºæ¥è¯´çš„ç›¸å¯¹ä¼˜å…ˆçº§(é‡è¦æ€§)</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">self</span>.blockOperation.qualityOfService = <span class="built_in">NSQualityOfServiceDefault</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">//æ“ä½œé˜Ÿåˆ—ä¸­æ“ä½œçš„æ‰§è¡Œä¼˜å…ˆçº§</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">self</span>.blockOperation.queuePriority = <span class="built_in">NSOperationQueuePriorityNormal</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">self</span>.blockOperation addExecutionBlock:^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"blockOperationè¿½åŠ ä»»åŠ¡1ï¼š%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">self</span>.blockOperation addExecutionBlock:^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"blockOperationè¿½åŠ ä»»åŠ¡2ï¼š%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        sleep(<span class="number">2</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">self</span>.blockOperation setCompletionBlock:^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"å…¶ä»–ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œæ­¤ä»»åŠ¡æœ€åæ‰§è¡Œ"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">self</span>.blockOperation addDependency:operation1];</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//    [self.blockOperation removeDependency:operation1];</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"self.blockOperation.dependencies:%@"</span>, <span class="keyword">self</span>.blockOperation.dependencies);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [operation1 start];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">self</span>.blockOperation start];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">//ç›¸å¯¹å½“å‰çº¿ç¨‹æ˜¯å¦ä¸ºå¼‚æ­¥æ“ä½œ</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">if</span>(<span class="keyword">self</span>.blockOperation.asynchronous)&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"å¼‚æ­¥æ‰§è¡Œ"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;<span class="keyword">else</span> <span class="built_in">NSLog</span>(<span class="string">@"éå¼‚æ­¥æ‰§è¡Œ"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, <span class="keyword">self</span>.blockOperation.completionBlock);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"å…¶ä»–ä»»åŠ¡"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">self</span>.blockOperation cancel];</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">self<span class="variable">.blockOperation</span><span class="variable">.dependencies</span>:(    <span class="string">"&lt;NSBlockOperation: 0x7faaf44069b0&gt;"</span>   )</span></pre></td></tr><tr><td class="code"><pre><span class="line">è¢«ä¾èµ–çš„æ“ä½œä»»åŠ¡</span></pre></td></tr><tr><td class="code"><pre><span class="line">è¢«ä¾èµ–çš„æ“ä½œä»»åŠ¡</span></pre></td></tr><tr><td class="code"><pre><span class="line">blockOperationè¿½åŠ ä»»åŠ¡<span class="number">2</span>ï¼š&lt;NSThread: <span class="number">0</span>x6000000d0080&gt;&#123;number = <span class="number">3</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">blockOperationä»»åŠ¡<span class="number">1</span>ï¼š&lt;NSThread: <span class="number">0</span>x6000000ba0c0&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">blockOperationè¿½åŠ ä»»åŠ¡<span class="number">1</span>ï¼š&lt;NSThread: <span class="number">0</span>x6000000cc000&gt;&#123;number = <span class="number">5</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">å…¶ä»–ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œæ­¤ä»»åŠ¡æœ€åæ‰§è¡Œ</span></pre></td></tr><tr><td class="code"><pre><span class="line">éå¼‚æ­¥æ‰§è¡Œ</span></pre></td></tr><tr><td class="code"><pre><span class="line">(<span class="literal">null</span>)</span></pre></td></tr><tr><td class="code"><pre><span class="line">å…¶ä»–ä»»åŠ¡</span></pre></td></tr></table></figure>

<p>é¦–å…ˆå¯¹äºæ‰€æœ‰æ“ä½œæ¥è¯´ï¼Œæ“ä½œæœ¬èº«ç›¸å¯¹äºå½“å‰çº¿ç¨‹éƒ½æ˜¯ä¸²è¡Œçš„ï¼Œå³ä¾¿æ“ä½œå†…éƒ¨å¯ä»¥æ‰§è¡Œçš„ä»£ç å—ä¹‹é—´å¯ä»¥å¹¶å‘ã€‚</p>
<p>æ‰€ä»¥è¿™æ®µä¾‹å­ä»£ç ä¸­æœ‰å¾ˆå¤šçš„ä»£ç æ˜¯çœ‹ä¸å‡ºæ•ˆæœçš„ã€‚ç‰¹æ­¤è¯´æ˜ä¸€ä¸‹ï¼Œåªæ˜¯è¯´æ˜ç”¨æ³•ã€‚</p>
<p>å¯ä»¥é€šè¿‡<code>addDependency</code>æ·»åŠ ä¾èµ–æ“ä½œï¼Œå¯ä»¥é€šè¿‡<code>removeDependency</code>ç§»é™¤ä¾èµ–ï¼Œå¯ä»¥é€šè¿‡<code>dependencies</code>æŸ¥çœ‹ä¾èµ–çŠ¶æ€ã€‚æœ¬æ®µä»£ç å®šä¹‰çš„ä¸¤ä¸ªæ“ä½œæœ¬èº«å¯¹äºæ‰§è¡Œæµç¨‹æ¥è¯´å°±æ˜¯ä¸²è¡Œçš„ï¼Œå…ˆæ‰§è¡Œçš„ä»»åŠ¡ä¼šå…ˆè¾“å‡ºï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡<code>dependencies</code>æ¥æŸ¥çœ‹ä¾èµ–ã€‚æ·»åŠ ä¾èµ–çš„ç›®çš„åœ¨äºæ·»åŠ ä¾èµ–åï¼Œè¢«ä¾èµ–çš„æ“ä½œè¦å…¨éƒ¨å…ˆæ‰§è¡Œå®Œæ¯•ï¼Œæ‰ä¼šæ‰§è¡Œä¾èµ–å…¶å®ƒæ“ä½œçš„ä»»åŠ¡æœ¬èº«ã€‚æ·»åŠ ä¾èµ–è¦å…ˆå¯åŠ¨ä¾èµ–ä¾ç„¶åœ¨å¯åŠ¨æœ¬ä»»åŠ¡æ‰§è¡Œï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p>
<p>è¿™é‡Œçš„è°ƒç”¨<code>cancel</code> æ–¹æ³•æ˜¯çœ‹ä¸åˆ°æ•ˆæœçš„ã€‚<code>cancel</code>æ–¹æ³•ä¸ä¼šå¼ºåˆ¶åœæ­¢æ“ä½œï¼Œä¼šæ›´æ–°æ“ä½œå¯¹è±¡å†…éƒ¨æ ‡å¿—ä»¥åæ˜ çŠ¶æ€å˜åŒ–ã€‚å¯¹äºå·²å®Œæˆçš„æ‰§è¡Œï¼Œ<code>cancel</code>æ— æ•ˆã€‚å¯ä»¥å–æ¶ˆåœ¨æ“ä½œé˜Ÿåˆ—ä¸­ï¼Œä½†å°šæœªæ‰§è¡Œçš„æ“ä½œï¼Œä¼šæ¯”æ­£å¸¸æ‰§è¡Œçš„æ“ä½œæ›´å¿«çš„ä»é˜Ÿåˆ—ä¸­åˆ é™¤ã€‚</p>
<p><code>completionBlock</code>ä¸ºè¯¥æ“ä½œçš„ä¸»è¦ä»»åŠ¡å®Œæˆåæ‰§è¡Œçš„ä»£ç ï¼Œè¯¥ä»»åŠ¡å—ä¼šåœ¨æ“ä½œè¢«æ ‡è®°ä¸º<code>finsihed</code>çš„æƒ…å†µä¸‹è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨æ“ä½œè¢«å–æ¶ˆçš„æƒ…å†µä¸‹ï¼Œæ“ä½œæœ€åä¹Ÿä¼šè¢«æ ‡è®°ä¸º<code>finished</code>çŠ¶æ€ä¹Ÿä¼šæ‰§è¡Œï¼Œæ‰€ä»¥åœ¨è¯¥ä»»åŠ¡å—å†…ä¸åº”è¯¥æ‰§è¡Œç›¸å½“äºæ“ä½œä»»åŠ¡å—çš„ä»»åŠ¡å†…å®¹ï¼Œè€Œå¯ä»¥æ·»åŠ ä¸€äº›ä¸æ“ä½œç›¸å…³ï¼Œä½†ä¸å±äºè¯¥ä»»åŠ¡çš„å…¶ä»–ä»»åŠ¡ã€‚å½“<code>completionBlock</code>å¼€å§‹æ‰§è¡Œåï¼Œå…¶ä¼šè¢«è®¾ç½®ä¸º<code>nil</code>ã€‚</p>
<p>å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•æŸ¥çœ‹æ“ä½œçŠ¶æ€ï¼š<code>cancelled</code>æ“ä½œæ˜¯å¦å·²å–æ¶ˆï¼›<code>executing</code>æ“ä½œæ˜¯å¦æ­£åœ¨æ‰§è¡Œï¼›<code>finished</code>æ“ä½œæ˜¯å¦å·²ç»ç»“æŸï¼›<code>asynchronous</code>ç›¸å¯¹å½“å‰çº¿ç¨‹æ¥è¯´ï¼Œæ“ä½œæ˜¯å¦ä¸ºå¼‚æ­¥æ“ä½œï¼›<code>ready</code>æ˜¯å¦å¯ä»¥ç«‹å³æ‰§è¡Œè¯¥æ“ä½œã€‚</p>
<p>å•ä¸€çš„æ“ä½œä¸è¦è°ƒç”¨<code>waitUntilFinished</code>æ–¹æ³•ï¼Œå¹¶ä¸”åº”é¿å…åœ¨ä¸å…¶è‡ªèº«æäº¤åˆ°åŒä¸€æ“ä½œé˜Ÿåˆ—çš„ä»»ä½•æ“ä½œä¸Šè°ƒç”¨å®ƒã€‚å®¹æ˜“é€ æˆæ­»é”é—®é¢˜ã€‚æ­¤æ–¹æ³•çš„å…¸å‹ç”¨æ³•æ˜¯ä»æœ€åˆåˆ›å»ºæ“ä½œçš„ä»£ç ä¸­è°ƒç”¨å®ƒã€‚å°†æ“ä½œæäº¤åˆ°é˜Ÿåˆ—åï¼Œæ‚¨å°†è°ƒç”¨æ­¤æ–¹æ³•ä»¥ç­‰å¾…è¯¥æ“ä½œå®Œæˆæ‰§è¡Œã€‚</p>
<p><code>NSOperationQueue</code>æ“ä½œé˜Ÿåˆ—ï¼Œæ˜¯æ ¹æ®æ“ä½œçš„ä¼˜å…ˆçº§å’Œå‡†å¤‡çŠ¶æ€æ¥è¿›è¡Œæ’é˜Ÿçš„ã€‚å°†æ“ä½œæ·»åŠ åˆ°æ“ä½œé˜Ÿåˆ—åï¼Œé˜Ÿåˆ—å°±ä¿ç•™æ“ä½œï¼Œç›´åˆ°æ“ä½œå®Œæˆã€‚æ·»åŠ æ“ä½œåï¼Œæ— æ³•ç›´æ¥åˆ é™¤ã€‚æ“ä½œå¤šåˆ—å°†ä¿ç•™æ“ä½œç›´åˆ°æ‰€æœ‰æ“ä½œå®Œæˆã€‚æŒ‚èµ·æœªå®Œæˆçš„æ“ä½œï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æ³„éœ²ã€‚å¦‚éœ€æŒ‰ç…§ç‰¹å®šçš„é¡ºåºæ‰§è¡Œï¼Œéœ€è¦æ·»åŠ ä¾èµ–æ¥ä¿è¯æ‰§è¡Œé¡ºåºã€‚</p>
<p>å–æ¶ˆæ“ä½œï¼Œä¼šå°†æ“ä½œå¯¹è±¡ä¿ç•™åœ¨é˜Ÿåˆ—ä¸­ï¼Œä¼šé€šçŸ¥è¯¥å¯¹è±¡å°½å¿«åœæ­¢å…¶ä»»åŠ¡ã€‚å¯¹äºæ­£åœ¨æ‰§è¡Œçš„æ“ä½œï¼Œæ„å‘³ç€æ“ä½œå¯¹è±¡çš„å·¥ä½œä»£ç å¿…é¡»æ£€æŸ¥å–æ¶ˆçŠ¶æ€ï¼Œåœæ­¢æ­£åœ¨æ‰§è¡Œçš„æ“ä½œå¹¶å°†å…¶æ ‡è®°ä¸ºå®ŒæˆçŠ¶æ€ã€‚å¯¹äºå·²ç»æ’é˜Ÿä½†æœªæ‰§è¡Œçš„æ“ä½œï¼Œé˜Ÿåˆ—ä»ç„¶ä¼šè°ƒç”¨å…¶<code>start</code>æ–¹æ³•ï¼Œä»¥ä¾¿å®ƒå¯ä»¥å¤„ç†å–æ¶ˆäº‹ä»¶å¹¶å°†è‡ªèº«æ ‡è®°ä¸ºå®ŒæˆçŠ¶æ€ã€‚</p>
<p>æ“ä½œé˜Ÿåˆ—æ—¶çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSOperationQueue</span> * operationQueue = [[<span class="built_in">NSOperationQueue</span> alloc] init];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSInvocationOperation</span> * operation1 = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(task1) object:<span class="literal">nil</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSInvocationOperation</span> * operation2 = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(task2) object:<span class="literal">nil</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSBlockOperation</span> * blockOperation = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"blockOperationä»»åŠ¡1ï¼š%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    [blockOperation addExecutionBlock:^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"blockOperationè¿½åŠ ä»»åŠ¡1ï¼š%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    [operationQueue addOperation:operation1];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [operationQueue addOperation:operation2];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [operationQueue addOperation:blockOperation];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [operationQueue addOperationWithBlock:^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"operationQueueè¿½åŠ çš„æ“ä½œ:%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;];</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)task1 &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"InvocationOperationä»»åŠ¡1:%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)task2 &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"InvocationOperationä»»åŠ¡2:%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">InvocationOperationä»»åŠ¡<span class="number">2</span>:&lt;NSThread: <span class="number">0</span>x600000bba200&gt;&#123;number = <span class="number">5</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">InvocationOperationä»»åŠ¡<span class="number">1</span>:&lt;NSThread: <span class="number">0</span>x600000bbd180&gt;&#123;number = <span class="number">4</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">blockOperationä»»åŠ¡<span class="number">1</span>:&lt;NSThread: <span class="number">0</span>x600000bcbf80&gt;&#123;number = <span class="number">3</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">operationQueueè¿½åŠ çš„æ“ä½œ:&lt;NSThread: <span class="number">0</span>x600000bbd740&gt;&#123;number = <span class="number">6</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">blockOperationè¿½åŠ ä»»åŠ¡<span class="number">1</span>:&lt;NSThread: <span class="number">0</span>x600000b96fc0&gt;&#123;number = <span class="number">7</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr></table></figure>

<p>å› å¹¶å‘æ‰§è¡Œï¼Œé¡ºåºæ˜¯ä¸å®šçš„ï¼Œ<code>NSOperationQueue</code>å¯ä»¥æ·»åŠ é™„åŠ åŠŸèƒ½åŠå±æ€§è®¾ç½®æ¥æ§åˆ¶æ‰§è¡Œï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSOperationQueue</span> * operationQueue;</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@end</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">self</span>.operationQueue = [[<span class="built_in">NSOperationQueue</span> alloc] init];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">self</span>.operationQueue.name = <span class="string">@"OQ"</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">//è®¾ç½®æœåŠ¡è´¨é‡(ç±»ä¼¼ä¼˜å…ˆçº§)</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">self</span>.operationQueue.qualityOfService = <span class="built_in">NSQualityOfServiceDefault</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">"queue"</span>, DISPATCH_QUEUE_CONCURRENT);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"ç©¿æ’çš„æ“ä½œ"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">self</span>.operationQueue setUnderlyingQueue:queue];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">//æ“ä½œé˜Ÿåˆ—çš„æœ€å¤§å¹¶å‘æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸€æ¬¡èƒ½æœ€å¤šæ‰§è¡Œå¤šå°‘ä¸ªä»»åŠ¡ï¼Œå¯ä»¥è‡ªå®šä¹‰ï¼Œå¦‚æœå®šä¹‰ä¸º1ï¼Œåˆ™åŠŸèƒ½æ˜¯ä¸²è¡Œï¼Œ</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">//ä»»åŠ¡ä¼šä¸€ä¸ªæ‰§è¡Œå®Œæ¯•æ‰§è¡Œå¦ä¸€ä¸ªï¼Œå¦‚ä¸è®¾ç½®åˆ™ç³»ç»Ÿä¼šæ ¹æ®ä¸åŒçš„ç¯å¢ƒæœ‰ä¸åŒçš„é»˜è®¤å€¼ã€‚</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//    [operationQueue1 setMaxConcurrentOperationCount:2];</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSInvocationOperation</span> * operation1 = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(task1) object:<span class="literal">nil</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSInvocationOperation</span> * operation2 = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(task2) object:<span class="literal">nil</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSBlockOperation</span> * blockOperation = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"blockOperationä»»åŠ¡1:%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        sleep(<span class="number">2</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    [blockOperation addExecutionBlock:^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"blockOperationè¿½åŠ ä»»åŠ¡1:%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        sleep(<span class="number">2</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">self</span>.operationQueue addOperation:blockOperation];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">self</span>.operationQueue addBarrierBlock:^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"éšœç¢(æ …æ )æ‰§è¡Œ"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">self</span>.operationQueue addOperationWithBlock:^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"operationQueueè¿½åŠ çš„æ“ä½œ:%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        sleep(<span class="number">2</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">//é€šè¿‡ç»„çš„æ–¹å¼æ·»åŠ ä¸Šåˆ°æ“ä½œé˜Ÿåˆ—ï¼ŒwaitUntilFinishedè¡¨ç¤ºæ˜¯å¦é˜»å¡å½“å‰çº¿ç¨‹ç›´åˆ°å¤šåˆ—ä¸­æ‰€æœ‰æ“ä½œå®Œæˆ æ˜¯åˆ™é˜»å¡ç­‰å¾…å®Œæˆï¼Œå¦ä¸é˜»å¡ï¼Œç›´æ¥è¿”å›</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">self</span>.operationQueue addOperations:@[operation1, operation2] waitUntilFinished:<span class="literal">NO</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">//é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆã€‚</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//    [operationQueue1 waitUntilAllOperationsAreFinished];</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//    NSLog(@"count:%lu", (unsigned long)self.operationQueue.operationCount);</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"å…¶ä»–ä»»åŠ¡"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)task1 &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"InvocationOperationä»»åŠ¡1:%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    sleep(<span class="number">2</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)task2 &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"InvocationOperationä»»åŠ¡2:%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    sleep(<span class="number">2</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">self</span>.operationQueue cancelAllOperations];</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//    [self.operationQueue setSuspended:NO];</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">ç©¿æ’çš„æ“ä½œ</span></pre></td></tr><tr><td class="code"><pre><span class="line">mainQueue:&lt;NSOperationQueue: <span class="number">0</span>x7fab75404050&gt;&#123;name = 'NSOperationQueue Main Queue'&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">currentQueue:&lt;NSOperationQueue: <span class="number">0</span>x7fab75404050&gt;&#123;name = 'NSOperationQueue Main Queue'&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">å…¶ä»–ä»»åŠ¡</span></pre></td></tr><tr><td class="code"><pre><span class="line">blockOperationä»»åŠ¡<span class="number">1</span>:&lt;NSThread: <span class="number">0</span>x600003204480&gt;&#123;number = <span class="number">6</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">blockOperationè¿½åŠ ä»»åŠ¡<span class="number">1</span>:&lt;NSThread: <span class="number">0</span>x60000324fc00&gt;&#123;number = <span class="number">4</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">éšœç¢(æ …æ )æ‰§è¡Œ</span></pre></td></tr><tr><td class="code"><pre><span class="line">InvocationOperationä»»åŠ¡<span class="number">2</span>:&lt;NSThread: <span class="number">0</span>x600003204480&gt;&#123;number = <span class="number">6</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">operationQueueè¿½åŠ çš„æ“ä½œ:&lt;NSThread: <span class="number">0</span>x60000324fc00&gt;&#123;number = <span class="number">4</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">InvocationOperationä»»åŠ¡<span class="number">1</span>:&lt;NSThread: <span class="number">0</span>x60000322fd80&gt;&#123;number = <span class="number">5</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr></table></figure>

<p>æ¥å¯¹ä»£ç åšä¸‹è¯´æ˜ï¼š</p>
<p>æ“ä½œé˜Ÿåˆ—åˆ›å»ºåå¯ä»¥è®¾ç½®åå­—ï¼Œæ–¹ä¾¿<code>debug</code>ã€‚<br>å¯ä»¥é€šè¿‡<code>qualityOfService</code>è®¾ç½®æœåŠ¡è´¨é‡ï¼Œå¦‚ä¸è®¾ç½®ï¼Œåˆ™ä¼šé‡‡ç”¨é»˜è®¤æœåŠ¡è´¨é‡<code>NSOperationQualityOfServiceBackground</code>ï¼Œä¸»é˜Ÿåˆ—çš„æœåŠ¡è´¨é‡ä¸º<code>NSOperationQualityOfServiceUserInteractive</code>ä¸”æ— æ³•ä¿®æ”¹ã€‚æœåŠ¡è´¨é‡ä¼šå½±å“æ“ä½œç³»ç»Ÿå¯¹CPUï¼Œç½‘ç»œèµ„æºï¼Œç£ç›˜èµ„æºç­‰çš„è®¿é—®ä¼˜å…ˆçº§ï¼Œå…·æœ‰è¾ƒé«˜æœåŠ¡è´¨é‡çš„æ“ä½œæ¯”ç³»ç»Ÿèµ„æºå…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ï¼Œä¼šæ›´å¿«çš„æ‰§è¡Œå…¶ä»»åŠ¡ï¼Œä½†æ˜¯å¹¶ä¸å»ºè®®ä½¿ç”¨ï¼Œå¦‚éç‰¹æ®Šï¼Œå¯ä»¥é‡‡ç”¨é»˜è®¤ä¼˜å…ˆçº§å³å¯ï¼Œç³»ç»Ÿè‡ªèº«çš„è°ƒåº¦ä¼šæ›´åˆç†é«˜æ•ˆçš„åˆ†é…èµ„æºã€‚<br>å¯ä»¥é€šè¿‡<code>setUnderlyingQueue</code>æ“ä½œå‘é˜Ÿåˆ—ä¸­æ·»åŠ <code>dispatch_queue_t</code>ç±»å‹çš„é˜Ÿåˆ—ã€‚<br><code>addBarrierBlock</code>æ–¹æ³•å¯ä»¥æ·»åŠ éšœç¢(æ …æ )å—ä»»åŠ¡ï¼Œå…³äºæ …æ ä»»åŠ¡çš„æ‰§è¡Œæ–¹å¼ï¼Œå¯ä»¥çœ‹<a href="http://www.mwpush.com/content/aeb8f67e.html">[IOS.OC]GCDçš„ä½¿ç”¨ç²¾è§£(äºŒ)</a>æ–‡ç« ä¸­å¯¹<code>dispatch_barrier_async</code>çš„è¯´æ˜ï¼Œå·¥ä½œåŸç†æ˜¯ä¸€æ ·çš„ã€‚<br>ä½¿ç”¨<code>waitUntilAllOperationsAreFinished</code>æ–¹æ³•æ—¶ï¼Œè¦å°†æ­¤æ–¹æ³•çš„è°ƒç”¨æ”¾åœ¨æœ€åé¢ï¼Œå¦åˆ™æ²¡æ•ˆæœã€‚<br><code>cancelAllOperations</code>å–æ¶ˆæ‰€æœ‰æ“ä½œï¼Œå°±æ˜¯è®©æ“ä½œé˜Ÿåˆ—ä¸­çš„æ‰€æœ‰æ“ä½œéƒ½è°ƒç”¨å„è‡ªçš„<code>cancel</code>æ–¹æ³•ã€‚</p>
<p>å¯ä»¥é€šè¿‡<code>suspended</code>æ–¹æ³•æŒ‚èµ·æˆ–ç»§ç»­æ‰§è¡Œæ“ä½œå¤šåˆ—ã€‚</p>
<h5 id="5-GCD"><a href="#5-GCD" class="headerlink" title="5.GCD"></a>5.GCD</h5><p>å…³äº<code>GCD</code>çš„ä»‹ç»å¯ä»¥çœ‹ä¸‹åˆ—æ–‡ç« ï¼š</p>
<p><a href="http://www.mwpush.com/content/d771b58d.html">[IOS.OC]GCDçš„ä½¿ç”¨ç²¾è§£(-)</a></p>
<p><a href="http://www.mwpush.com/content/aeb8f67e.html">[IOS.OC]GCDçš„ä½¿ç”¨ç²¾è§£(äºŒ)</a></p>
<p><a href="http://www.mwpush.com/content/d04bd655.html">[IOS.OC]GCDçš„ä½¿ç”¨ç²¾è§£(ä¸‰)</a></p>
]]></content>
      <categories>
        <category>ç§»åŠ¨å¼€å‘</category>
        <category>IOSå¼€å‘</category>
      </categories>
      <tags>
        <tag>ObjC</tag>
        <tag>Objective-C</tag>
        <tag>ios</tag>
        <tag>å¤šçº¿ç¨‹</tag>
        <tag>multithreading</tag>
      </tags>
  </entry>
  <entry>
    <title>[IOS.OC]GCDçš„ä½¿ç”¨ç²¾è§£(ä¸‰)</title>
    <url>/content/d04bd655.html</url>
    <content><![CDATA[<h4 id="ä¸€ã€Dispatch-Semaphore"><a href="#ä¸€ã€Dispatch-Semaphore" class="headerlink" title="ä¸€ã€Dispatch Semaphore"></a>ä¸€ã€<code>Dispatch Semaphore</code></h4><p>ä½¿ç”¨ä¿¡å·é‡å¯ä»¥è¾¾åˆ°æ§åˆ¶å¹¶å‘æ•°å’Œçº¿ç¨‹é”çš„ç›®çš„ã€‚å®ƒé€šè¿‡æŒæœ‰è®¡æ•°çš„ä¿¡å·çš„å¢å‡æ¥æ§åˆ¶è®¿é—®ã€‚å½“è®¡æ•°ä¸º0æ—¶ç­‰å¾…ï¼Œè®¡æ•°å¤§äºç­‰äº1æ—¶ï¼Œå‡1ç»§ç»­æ‰§è¡Œã€‚</p>
<p><code>dispatch_semaphore_create</code>é€šè¿‡åˆå§‹å€¼åˆ›å»ºä¸€ä¸ªä¿¡å·é‡ï¼Œæœ‰ä¸€ä¸ªå‚æ•°ï¼Œä¸º<code>long</code>ç±»å‹ï¼Œå³åˆå§‹å€¼ï¼Œåº”å¤§äºç­‰äº0ï¼Œè¿”å›å€¼ä¸º<code>dispatch_semaphore_t</code>ç±»å‹ä¿¡å·é‡ï¼›</p>
<a id="more"></a>
<p><code>dispatch_semaphore_signal</code>å‘ä¿¡å·ï¼Œå³ä¿¡å·é‡å€¼å¢åŠ ã€‚æœ‰ä¸€ä¸ªå‚æ•°ï¼Œä¸º<code>dispatch_semaphore_t</code>ç±»å‹ä¿¡å·é‡ã€‚</p>
<p><code>dispatch_semaphore_wait</code>ç­‰å¾…ä¿¡å·é‡ï¼Œå³ä¿¡å·é‡å‡å°‘ã€‚æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªä¸º<code>dispatch_semaphore_t</code>ç±»å‹ä¿¡å·é‡ï¼Œç¬¬äºŒä¸ªä¸º<code>dispatch_time_t</code>ç±»å‹è¶…æ—¶æ—¶é—´ã€‚è¿”å›å€¼ä¸º<code>long</code>ç±»å‹ï¼Œè¿”å›å€¼ä¸º0åˆ™ç­‰å¾…æ—¶é—´æœªè¶…æ—¶ï¼Œä¸ä¸º0åˆ™è¶…æ—¶ã€‚</p>
<p><code>dispatch_semaphore_signal</code>ä¸<code>dispatch_semaphore_wait</code>çš„è°ƒç”¨è¦ä¿æŒå¹³è¡¡ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> c_queue = dispatch_queue_create(<span class="string">"com.mwpush"</span>, DISPATCH_QUEUE_CONCURRENT);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">dispatch_async</span>(c_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"ç¬¬%dæ¬¡æ‰§è¡Œ"</span>, i);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç ä¸ºå¼‚æ­¥å¹¶å‘é˜Ÿåˆ—ï¼Œæ­¤æ—¶è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">ç¬¬<span class="number">0</span>æ¬¡æ‰§è¡Œ</span></pre></td></tr><tr><td class="code"><pre><span class="line">ç¬¬<span class="number">1</span>æ¬¡æ‰§è¡Œ</span></pre></td></tr><tr><td class="code"><pre><span class="line">ç¬¬<span class="number">4</span>æ¬¡æ‰§è¡Œ</span></pre></td></tr><tr><td class="code"><pre><span class="line">ç¬¬<span class="number">2</span>æ¬¡æ‰§è¡Œ</span></pre></td></tr><tr><td class="code"><pre><span class="line">ç¬¬<span class="number">5</span>æ¬¡æ‰§è¡Œ</span></pre></td></tr><tr><td class="code"><pre><span class="line">ç¬¬<span class="number">3</span>æ¬¡æ‰§è¡Œ</span></pre></td></tr><tr><td class="code"><pre><span class="line">ç¬¬<span class="number">6</span>æ¬¡æ‰§è¡Œ</span></pre></td></tr><tr><td class="code"><pre><span class="line">ç¬¬<span class="number">7</span>æ¬¡æ‰§è¡Œ</span></pre></td></tr><tr><td class="code"><pre><span class="line">ç¬¬<span class="number">9</span>æ¬¡æ‰§è¡Œ</span></pre></td></tr><tr><td class="code"><pre><span class="line">ç¬¬<span class="number">8</span>æ¬¡æ‰§è¡Œ</span></pre></td></tr></table></figure>

<p>ä¸ºæ— åºè¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸²è¡Œé˜Ÿåˆ—è¾¾åˆ°ä¾æ¬¡è¾“å‡ºçš„ç›®çš„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¿¡å·é‡æ¥æ§åˆ¶ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">dispatch_semaphore_t semaphore = dispatch_semaphore_create(<span class="number">1</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> c_queue = dispatch_queue_create(<span class="string">"com.mwpush"</span>, DISPATCH_QUEUE_CONCURRENT);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">dispatch_async</span>(c_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"ç¬¬%dæ¬¡æ‰§è¡Œ"</span>, i);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        dispatch_semaphore_signal(semaphore);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">ç¬¬<span class="number">0</span>æ¬¡æ‰§è¡Œ</span></pre></td></tr><tr><td class="code"><pre><span class="line">ç¬¬<span class="number">1</span>æ¬¡æ‰§è¡Œ</span></pre></td></tr><tr><td class="code"><pre><span class="line">ç¬¬<span class="number">2</span>æ¬¡æ‰§è¡Œ</span></pre></td></tr><tr><td class="code"><pre><span class="line">ç¬¬<span class="number">3</span>æ¬¡æ‰§è¡Œ</span></pre></td></tr><tr><td class="code"><pre><span class="line">ç¬¬<span class="number">4</span>æ¬¡æ‰§è¡Œ</span></pre></td></tr><tr><td class="code"><pre><span class="line">ç¬¬<span class="number">5</span>æ¬¡æ‰§è¡Œ</span></pre></td></tr><tr><td class="code"><pre><span class="line">ç¬¬<span class="number">7</span>æ¬¡æ‰§è¡Œ</span></pre></td></tr><tr><td class="code"><pre><span class="line">ç¬¬<span class="number">6</span>æ¬¡æ‰§è¡Œ</span></pre></td></tr><tr><td class="code"><pre><span class="line">ç¬¬<span class="number">8</span>æ¬¡æ‰§è¡Œ</span></pre></td></tr><tr><td class="code"><pre><span class="line">ç¬¬<span class="number">9</span>æ¬¡æ‰§è¡Œ</span></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åˆ›å»ºçš„ä¿¡å·é‡åˆå§‹å€¼ä¸º1ï¼Œå½“æ‰§è¡Œ<code>dispatch_semaphore_wait</code>æ–¹æ³•æ—¶ä¿¡å·è®¡æ•°å‡1ä¸º0ï¼Œæ‰€ä»¥æ­¤æ—¶å¦‚æœæœ‰å…¶ä»–çº¿ç¨‹è¦æ‰§è¡ŒåŒæ ·çš„æ–¹æ³•ï¼Œå› ä¸ºä¿¡å·è®¡æ•°ä¸º0éœ€ç­‰å¾…ï¼Œæ— æ³•ç»§ç»­æ‰§è¡Œã€‚å½“æ‰§è¡Œ<code>dispatch_semaphore_signal</code>æ–¹æ³•æ—¶ï¼Œä¿¡å·è®¡æ•°åŠ 1ï¼Œåˆ™<code>dispatch_semaphore_wait</code>æ–¹æ³•å°†ä¿¡å·è®¡æ•°å‡1å¹¶ç»§ç»­æ‰§è¡Œï¼Œä¾æ¬¡å¾€å¤ã€‚</p>
<p>å¯è§ï¼Œä¿¡å·é‡å¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹é—´é€šè¿‡ä¿¡å·è®¡æ•°æ¥åè°ƒæ§åˆ¶è®¿é—®å¤„ç†ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿¡å·è®¡æ•°çš„å€¼çš„æ§åˆ¶æ¥æ§åˆ¶æœ€å¤§å¹¶å‘æ•°ï¼Œåªè¦ä¿¡å·è®¡æ•°å¤§äº0å°±å¯ä»¥ä¸ç”¨ç­‰å¾…å¹¶å‘æ‰§è¡Œã€‚</p>
<h4 id="äºŒã€Dispatch-Source"><a href="#äºŒã€Dispatch-Source" class="headerlink" title="äºŒã€Dispatch Source"></a>äºŒã€<code>Dispatch Source</code></h4><p>è°ƒåº¦æºï¼Œæ˜¯ç”¨æ¥ç›‘è§†ä½çº§ç³»ç»Ÿäº‹ä»¶çš„å¯¹è±¡ï¼Œåœ¨äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œè‡ªåŠ¨åœ¨æŒ‡å®šçš„<code>Dispatch Queue</code>ä¸­æ‰§è¡ŒæŒ‡å®šçš„å¤„ç†äº‹ä»¶ã€‚</p>
<h5 id="1-è‡ªå®šä¹‰è°ƒåº¦æº"><a href="#1-è‡ªå®šä¹‰è°ƒåº¦æº" class="headerlink" title="1.è‡ªå®šä¹‰è°ƒåº¦æº"></a>1.è‡ªå®šä¹‰è°ƒåº¦æº</h5><p><code>dispatch_source_create</code>åˆ›å»ºä¸€ä¸ªè°ƒåº¦æºæ¥ç›‘è§†ä½çº§ç³»ç»Ÿäº‹ä»¶ã€‚æœ‰4ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªä¸º<code>dispatch_source_type_t</code>ç±»å‹ï¼Œæ˜¯ä¸€ä¸ªç»“æ„ä½“å¸¸é‡æŒ‡é’ˆï¼Œç”¨æ¥å®šä¹‰è°ƒåº¦æºçš„ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è°ƒåº¦æºç›‘è§†çš„ä½çº§ç³»ç»Ÿå¯¹è±¡ç±»å‹çš„æ ‡è¯†ç¬¦ï¼Œéœ€è¦æ ¹æ®è¿™ä¸ªå‚æ•°æ¥ç¡®å®šç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå‚æ•°çš„è§£é‡Šæ–¹å¼ã€‚ç¬¬äºŒä¸ªå‚æ•°ä¸º<code>uintptr_t</code>å³<code>unsigned long</code>ç±»å‹çš„è¦ç›‘è§†çš„åº•å±‚ç³»ç»Ÿå¥æŸ„ï¼Œè¿™ä¸ªå€¼çš„è®¾å®šæ˜¯æ ¹æ®ç¬¬ä¸€ä¸ªå‚æ•°æ¥ç¡®å®šçš„ï¼Œé€šè¿‡ä¸€ä¸ªå‚æ•°æ¥ç¡®å®šè¿™ä¸ªå‚æ•°æ˜¯ä½œä¸ºæ–‡ä»¶æè¿°ç¬¦ã€machç«¯å£ã€ä¿¡å·æ•°ï¼Œè¿˜æ˜¯è¿›ç¨‹æ ‡è¯†ç¬¦ç­‰ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸º<code>unsigned long</code>ç±»å‹çš„äº‹ä»¶æ‰€éœ€çš„æ ‡å¿—æ©ç ï¼Œè¿™ä¸ªå€¼çš„è®¾å®šä¹Ÿæ˜¯æ ¹æ®ç¬¬ä¸€ä¸ªå‚æ•°æ¥ç¡®å®šçš„ï¼Œç³»ç»Ÿæä¾›äº†è¿™ä¸ªå€¼çš„å›ºå®šå‚æ•°ï¼Œç¬¬å››ä¸ªå‚æ•°ä¸ºç›‘å¬åˆ°æŒ‡å®šäº‹ä»¶æ—¶è°ƒç”¨çš„å¤„ç†äº‹ä»¶æ‰€è¦æäº¤åˆ°çš„é˜Ÿåˆ—ã€‚è¿”å›å€¼ä¸º<code>dispatch_source_t</code>ç±»å‹çš„è°ƒåº¦æºã€‚è°ƒåº¦æºæ˜¯åœ¨éæ´»åŠ¨çŠ¶æ€ä¸‹åˆ›å»ºçš„ã€‚ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬ä»‹ç»åˆ°<code>dispatch_resume</code>ä¸<code>dispatch_suspend</code>åº”è¯¥åŒ¹é…ä½¿ç”¨ï¼Œæˆå¯¹å‡ºç°ï¼Œå¦åˆ™ä¼šå¼•å‘å´©æºƒï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªä¾‹å¤–ï¼Œå°±æ˜¯è¿™é‡Œçš„è°ƒåº¦æºï¼Œåœ¨å®˜æ–¹å¯¹<code>dispatch_resume</code>çš„ä»‹ç»ä¸­ï¼Œè¯´åˆ°æ–°åˆ›å»ºçš„è°ƒåº¦æºæŒ‚èµ·è®¡æ•°ä¸º1ï¼Œå¿…é¡»è¦åœ¨äº‹ä»¶ä¼ é€’å‰å°†å…¶æ¢å¤ã€‚è€Œåœ¨å®˜æ–¹å¯¹<code>dispatch_source_create</code>çš„è¯´æ˜ä¸­è¯´åˆ°ï¼Œå‡ºäºå‘åå…¼å®¹çš„åŸå› ï¼Œ<code>dispatch_resume</code>åœ¨ä¸€ä¸ªéæ´»åŠ¨çš„ã€è€Œä¸æ˜¯æŒ‚èµ·çš„æºä¸Šï¼Œä¸<code>dispatch_activate</code>çš„ä½œç”¨ç›¸åŒã€‚æ‰€ä»¥æˆ‘ä»¬ä¹Ÿå§‘ä¸”ç§°ä¹‹ä¸ºâ€œéæ´»åŠ¨çŠ¶æ€â€ã€‚å®˜æ–¹å»ºè®®åœ¨è°ƒåº¦æºä¸­ä½¿ç”¨<code>dispatch_activate</code>æ¥æ¿€æ´»è°ƒåº¦æºã€‚</p>
<p><img src="/content/d04bd655/20191224_01.png" alt></p>
<p>2.<code>dispatch_source_merge_data</code>å°†æ•°æ®åˆå¹¶åˆ°<code>DISPATCH_SOURCE_TYPE_DATA_ADD</code>æˆ–<code>DISPATCH_SOURCE_TYPE_DATA_OR</code>ç±»å‹çš„è°ƒåº¦æºä¸­ï¼Œå¹¶å°†å…¶äº‹ä»¶å¤„ç†ç¨‹åºæäº¤åˆ°ç›®æ ‡é˜Ÿåˆ—ã€‚ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªä¸ºè°ƒåº¦æºï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸º<code>unsigned long</code>ç±»å‹ï¼Œæ˜¯è¦æäº¤çš„æ•°æ®ï¼Œä¸èƒ½ä¸º0ï¼Œä¸º0ä¸ä¼šå‡ºå‘æäº¤äº‹ä»¶å¤„ç†ç¨‹åºå—ï¼Œä¹Ÿä¸èƒ½ä¸ºè´Ÿæ•°ã€‚</p>
<p><code>dispatch_source_set_event_handler</code>ä¸ºç»™å®šçš„è°ƒåº¦æºè®¾ç½®äº‹ä»¶å¤„ç†ç¨‹åºå—ã€‚æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªä¸ºç›®æ ‡è°ƒåº¦æºï¼Œç¬¬äºŒä¸ªä¸ºè¦æ‰§è¡Œçš„ç¨‹åºå—ã€‚æ­¤æ–¹æ³•æ˜¯è®¾ç½®è¦æäº¤åˆ°ç›®æ ‡è°ƒåº¦æºä¸­æŒ‡å®šçš„é˜Ÿåˆ—çš„ç¨‹åºå—ã€‚åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªä»»åŠ¡å—è¢«æ‰§è¡Œï¼Œå¦‚æœå½“å¦ä¸€æ¬¡æäº¤äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå½“å‰ç¨‹åºå—è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œåˆ™ä¼šä»¥æŒ‡å®šçš„æ–¹å¼(åˆ›å»ºè°ƒåº¦æºæ—¶æŒ‡å®šçš„<code>ADD</code>æˆ–<code>OR</code>)è¿›è¡Œç§¯ç´¯åˆå¹¶ï¼Œæœ‰æ•ˆè§£å†³äº†é¢‘ç¹æäº¤å¸¦æ¥çš„å¤„ç†äº‹ä»¶çš„å‹åŠ›ã€‚</p>
<p><code>dispatch_source_get_data</code>è¿”å›è°ƒåº¦æºçš„å¾…å¤„ç†æ•°æ®ï¼Œæœ‰ä¸€ä¸ªå‚æ•°ä¸ºè°ƒåº¦æºã€‚æ­¤æ–¹æ³•åº”åœ¨äº‹ä»¶å¤„ç†ç¨‹åºå—ä¸­è°ƒç”¨(ä¹Ÿå°±æ˜¯<code>dispatch_source_set_event_handler</code>ä¸­)ï¼Œåœ¨äº‹ä»¶å¤„ç†ç¨‹åºå›è°ƒä¹‹å¤–è°ƒç”¨æ­¤å‡½æ•°ç»“æœæ˜¯ä¸ç¡®å®šçš„ã€‚é€šè¿‡æ­¤æ–¹æ³•å¯ä»¥è·å–è°ƒåº¦æºä¸­çš„å½“å‰å€¼ï¼Œå¹¶å°†æ•°æ®æ¸…é›¶ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> c_queue = dispatch_queue_create(<span class="string">"com.mwpush"</span>, DISPATCH_QUEUE_CONCURRENT);</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_source_t source = dispatch_source_create(DISPATCH_SOURCE_TYPE_DATA_ADD, <span class="number">0</span>, <span class="number">0</span>, c_queue);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_source_set_event_handler(source, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%ld"</span>, dispatch_source_get_data(source));</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_activate(source);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_apply(<span class="number">5</span>, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^(size_t index) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    dispatch_source_merge_data(source, <span class="number">1</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line"><span class="number">5</span></span></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç ï¼Œè‡ªå®šä¹‰ä¸€ä¸ªå¹¶å‘é˜Ÿåˆ—<code>c_queue</code>ï¼Œä½œä¸ºå®šä¹‰è°ƒåº¦æºçš„ä½¿ç”¨é˜Ÿåˆ—ï¼Œé€šè¿‡<code>dispatch_source_set_event_handler</code>è®¾ç½®å¤„ç†äº‹ä»¶çš„ç¨‹åºå—ï¼Œç„¶åæ¿€æ´»è°ƒåº¦æºã€‚ç„¶åé€šè¿‡5æ¬¡è¿­ä»£å°†æ•°æ®<code>1</code>æäº¤åˆ°è°ƒåº¦æºï¼Œå› ä¸ºäº‹ä»¶æäº¤æ˜¯è¿ç»­å‘ç”Ÿçš„ï¼Œç¨‹åºå—è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œä¼šä»¥<code>ADD</code>çš„æ–¹å¼å¯¹æ•°æ®è¿›è¡Œåˆå¹¶ï¼Œæœ€åè¾“å‡ºã€‚å¦‚æœå½“æäº¤åˆå¹¶æ—¶ï¼Œç¨‹åºå—å·²æ‰§è¡Œå®Œæ¯•ï¼Œåˆ™ä¸ä¼šä»¥<code>ADD</code>æ–¹å¼è¿›è¡Œåˆå¹¶ã€‚</p>
<p>ä»¥ä¸‹éªŒè¯ä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) dispatch_source_t source;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@end</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">dispatch_queue_t</span> c_queue = dispatch_queue_create(<span class="string">"com.mwpush"</span>, DISPATCH_QUEUE_CONCURRENT);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">self</span>.source = dispatch_source_create(DISPATCH_SOURCE_TYPE_DATA_ADD, <span class="number">0</span>, <span class="number">0</span>, c_queue);</span></pre></td></tr><tr><td class="code"><pre><span class="line"> </span></pre></td></tr><tr><td class="code"><pre><span class="line">    dispatch_source_set_event_handler(<span class="keyword">self</span>.source, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%ld"</span>, dispatch_source_get_data(<span class="keyword">self</span>.source));</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    dispatch_activate(<span class="keyword">self</span>.source);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  </span></pre></td></tr><tr><td class="code"><pre><span class="line">    dispatch_source_merge_data(<span class="keyword">self</span>.source, <span class="number">1</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@end</span></span></pre></td></tr></table></figure>

<p>æ­¤æ—¶æˆ‘ä»¬ç‚¹å‡»å±å¹•ï¼Œå¯ä»¥è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span></span></pre></td></tr></table></figure>

<p>å†æ¬¡éªŒè¯ï¼Œæœªæ‰§è¡Œå®Œæ¯•ï¼Œè¿›è¡Œåˆå¹¶ï¼Œä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">dispatch_source_set_event_handler(<span class="keyword">self</span>.source, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    sleep(<span class="number">2</span>); <span class="comment">//æ·»åŠ ç¡çœ ï¼Œæ¨¡æ‹Ÿè€—æ—¶</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%ld"</span>, dispatch_source_get_data(<span class="keyword">self</span>.source));</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr></table></figure>

<p>æ­¤æ—¶æˆ‘ä»¬è¿ç»­ç‚¹å‡»å±å¹•5æ¬¡ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">4</span></span></pre></td></tr></table></figure>

<p>å› ä¸ºç¬¬ä¸€æ¬¡ç‚¹å‡»è¦è€—æ—¶2ç§’åæ‰§è¡Œå®Œæ¯•ï¼Œè€Œç‚¹å‡»æ˜¯åœ¨çŸ­æ—¶é—´å†…å®Œæˆçš„ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡äº‹ä»¶æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œåé¢ç‚¹å‡»ä¼šè¢«ç³»ç»Ÿä¼˜åŒ–åˆå¹¶ã€‚</p>
<h5 id="2-å®šæ—¶å™¨æº"><a href="#2-å®šæ—¶å™¨æº" class="headerlink" title="2.å®šæ—¶å™¨æº"></a>2.å®šæ—¶å™¨æº</h5><p><code>dispatch_source_set_timer</code>è®¾ç½®è®¡æ—¶å™¨æºçš„å¼€å§‹æ—¶é—´ï¼Œé—´éš”å’Œå›ç¨‹å€¼ã€‚4ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªä¸ºè°ƒåº¦æºï¼Œç¬¬äºŒä¸ªä¸º<code>dispatch_time_t</code>ç±»å‹çš„å¼€å§‹æ—¶é—´ï¼Œç¬¬ä¸‰ä¸ªä¸ºæ—¶é—´é—´éš”ï¼Œå•ä½ä¸ºçº³ç§’ï¼Œç¬¬å››ä¸ªä¸ºè®¾ç½®è®¡æ—¶ç²¾åº¦ï¼Œå•ä½ä¸ºçº³ç§’ï¼Œå¦‚æœå¸Œæœ›å¾ˆç²¾ç¡®(ç›¸å¯¹æ¥è¯´ï¼Œæ²¡æœ‰ç»å¯¹çš„ç²¾ç¡®)ï¼Œåˆ™è®¾ç½®ä¸º0ï¼Œå³ä½¿è®¾ä¸º0ï¼Œè®¡æ—¶å™¨ä¹Ÿä¼šæœ‰ä¸€å®šçš„ç­‰å¾…æ—¶é—´ï¼Œå¦‚æœå¯¹ç²¾ç¡®åº¦è¦æ±‚ä¸é«˜ï¼Œå¯ä»¥è®¾ç½®ä¸ºèƒ½æ¥å—çš„å»¶è¿Ÿæ—¶é—´ã€‚ç²¾ç¡®åº¦è¶Šä½å¯¹ç³»ç»Ÿçš„æ‰§è¡Œçµæ´»æ€§è¶Šé«˜(å³ç³»ç»Ÿå¯ä»¥æ ¹æ®å»¶è¿Ÿæ—¶é—´æ¥é…åˆç³»ç»Ÿäº‹ä»¶æ‰§è¡Œï¼Œå»¶è¿Ÿæ—¶é—´å…è®¸çš„æƒ…å†µä¼šä¸å…¶ä»–éœ€è¦æ‰§è¡Œçš„äº‹ä»¶ä¸€èµ·å”¤é†’æ‰§è¡Œï¼Œè€Œéå•å•ä¸ºäº†è®¡æ—¶å™¨å•ç‹¬æ‰§è¡Œ)ã€‚</p>
<p>å®šæ—¶å™¨æºæ˜¯æœ‰ä¸€ä¸ªæ©ç å€¼çš„ï¼Œä¸º<code>DISPATCH_TIMER_STRICT</code>ï¼Œä½†æ˜¯ä¸å»ºè®®ä½¿ç”¨ï¼Œä¸€èˆ¬æ—¶å€™ä½¿ç”¨0å°±å¯ä»¥ï¼Œé™¤éå¯¹æ—¶é—´çš„ç²¾ç¡®åº¦éå¸¸é«˜ã€‚è¿™ä¸ªæ©ç æŒ‡å®š<code>dispatch_source_set_timer</code>çš„å»¶è¿Ÿå‚æ•°(leeway)å°½æœ€å¤§åŠªåŠ›éµå®ˆè®¾ç½®çš„å€¼ï¼Œè®¾ç½®æ­¤æ ‡è®°å¥½ï¼Œç³»ç»Ÿä¼šå°†ä¼šåº”ç”¨æœ€å°çš„å»¶è¿Ÿï¼Œä¹Ÿä¼šå¸¦æ¥è´Ÿé¢å½±å“ï¼Œæ¯”å¦‚è€—ç”µé‡å¤§ï¼Œå½±å“çœç”µæŠ€æœ¯ï¼Œåº”è°¨æ…ä½¿ç”¨ï¼Œåªæœ‰åœ¨ç»å¯¹å¿…è¦æ—¶è®¾ç½®æ­¤å€¼ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> c_queue = dispatch_queue_create(<span class="string">"com.mwpush"</span>, DISPATCH_QUEUE_CONCURRENT);</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_source_t source = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, <span class="number">0</span>, <span class="number">0</span>, c_queue);</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_time_t time_t = dispatch_time(DISPATCH_TIME_NOW, <span class="number">2</span>ull*<span class="built_in">NSEC_PER_SEC</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">uint64_t interval = <span class="number">1</span>ull*<span class="built_in">NSEC_PER_SEC</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_source_set_timer(source, time_t, interval, <span class="number">0</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_source_set_event_handler(source, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%ld"</span>, dispatch_source_get_data(source));</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_activate(source); <span class="comment">//dispatch_resume(source);</span></span></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç å®ç°äº†ä¸€ä¸ªå»¶è¿Ÿ2ç§’æ‰§è¡Œï¼Œå¹¶æ¯éš”ä¸€ç§’è°ƒç”¨ä¸€æ¬¡ç¨‹åºå—çš„åŠŸèƒ½ï¼Œå¦‚ä¸éœ€è¦é‡å¤è°ƒç”¨ï¼Œå°†æ—¶é—´é—´éš”è®¾ç½®ä¸º<code>DISPATCH_TIME_FOREVER</code>å³å¯ã€‚å¯¹äºæ‰€æäº¤çš„é˜Ÿåˆ—å¤§å®¶å¯è‡ªè¡Œé€‰æ‹©ï¼Œè¿™é‡Œåªæ˜¯æ¼”ç¤ºçš„ä¾‹å­ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>dispatch_suspend</code>æ¥æš‚åœå®šæ—¶å™¨ï¼Œè¦å¯¹åº”æœ‰å¯åŠ¨/ç»§ç»­å®šæ—¶å™¨çš„<code>dispatch_resume</code>ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•å–æ¶ˆå®šæ—¶å™¨ã€‚</p>
<p><code>dispatch_source_cancel</code>å¼‚æ­¥å–æ¶ˆè°ƒåº¦æºï¼Œä»¥é˜²æ­¢è¿›ä¸€æ­¥è°ƒç”¨å…¶äº‹ä»¶å¤„ç†ç¨‹åºå—ã€‚ä¸€ä¸ªå‚æ•°ä¸ºè°ƒåº¦æºã€‚æ³¨æ„åªèƒ½å–æ¶ˆæœªè¢«æ‰§è¡Œçš„ç¨‹åºå—ï¼Œå·²ç»æ‰§è¡Œçš„å°†ç»§ç»­æ‰§è¡Œå®Œæ¯•(æäº¤çš„ç¨‹åºå—ä¹Ÿæœ‰å¯èƒ½æœªæ¥å¾—åŠæ‰§è¡Œ)ã€‚</p>
<p><code>dispatch_source_set_cancel_handler</code>è®¾ç½®ç›®æ ‡è°ƒåº¦æºçš„å–æ¶ˆå¤„ç†ç¨‹åºå—ï¼Œä¸€ä¸ªå‚æ•°ä¸ºç›®æ ‡è°ƒåº¦æºã€‚æ­¤æ–¹æ³•åœ¨æ‰§è¡Œ<code>dispatch_source_cancel</code>ï¼Œä¸”ç³»ç»Ÿé‡Šæ”¾å¯¹æºåŸºç¡€å¥æŸ„çš„æ‰€æœ‰å¼•ç”¨ä¸”æ‰€æœ‰å·²å¤„ç†ç¨‹åºå—æ‰§è¡Œå®Œæ¯•åè¢«è°ƒç”¨ã€‚</p>
<h5 id="3ã€å…¶ä»–æ–¹æ³•"><a href="#3ã€å…¶ä»–æ–¹æ³•" class="headerlink" title="3ã€å…¶ä»–æ–¹æ³•"></a>3ã€å…¶ä»–æ–¹æ³•</h5><p><code>dispatch_source_get_mask</code> è¿”å›è°ƒåº¦æºç›‘è§†çš„äº‹ä»¶æ©ç ã€‚</p>
<p><code>dispatch_source_testcancel</code>æµ‹è¯•ç›®æ ‡è°ƒåº¦æºæ˜¯å¦å·²å–æ¶ˆã€‚</p>
<p><code>dispatch_source_get_handle</code>è¿”å›ä¸æŒ‡å®šè°ƒåº¦æºç›¸å…³è”çš„åŸºç¡€ç³»ç»Ÿå¥æŸ„ã€‚</p>
<p><code>dispatch_source_set_registration_handler</code>è®¾ç½®ç»™å®šè°ƒåº¦æºçš„æ³¨å†Œå¤„ç†ç¨‹åºå—ã€‚</p>
<p><code>Dispatch Source</code>å®˜æ–¹åœ°å€ï¼š<a href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/GCDWorkQueues/GCDWorkQueues.html#//apple_ref/doc/uid/TP40008091-CH103-SW13" target="_blank" rel="noopener">https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/GCDWorkQueues/GCDWorkQueues.html#//apple_ref/doc/uid/TP40008091-CH103-SW13</a></p>
<h4 id="ä¸‰ã€Dispatch-I-Oä¸Dispatch-Dataä»‹ç»"><a href="#ä¸‰ã€Dispatch-I-Oä¸Dispatch-Dataä»‹ç»" class="headerlink" title="ä¸‰ã€Dispatch I/Oä¸Dispatch Dataä»‹ç»"></a>ä¸‰ã€<code>Dispatch I/O</code>ä¸<code>Dispatch Data</code>ä»‹ç»</h4><p>é€šè¿‡ä½¿ç”¨<code>Dispatch I/O</code>å’Œ<code>Dispatch Data</code>å¯ä»¥å°†å¤§çš„æ–‡ä»¶åˆ†å‰²æˆè‹¥å¹²å°éƒ¨åˆ†è¿›è¡Œè¯»å–åˆå¹¶ã€‚</p>
<p><code>dispatch_io_create</code>åˆ›å»ºä¸€ä¸ªI/Oé€šé“ï¼Œå¹¶å°†å…¶ä¸æŒ‡å®šçš„æ–‡ä»¶æè¿°ç›¸å…³è”ã€‚</p>
<p><code>dispatch_io_create_with_path</code>åˆ›å»ºå…·æœ‰å…³è”è·¯å¾„çš„è°ƒåº¦I/Oé€šé“ã€‚</p>
<p><code>dispatch_io_read</code>åœ¨æŒ‡å®šçš„é€šé“ä¸Šè°ƒç”¨å¼‚æ­¥è¯»å–æ“ä½œã€‚</p>
<p><code>dispatch_io_write</code>åœ¨æŒ‡å®šçš„é€šé“ä¸Šè°ƒç”¨å¼‚æ­¥å†™æ“ä½œã€‚</p>
<p><code>dispatch_io_close</code>å…³é—­æŒ‡å®šçš„é€šé“ä»¥è¿›è¡Œæ–°çš„è¯»å†™æ“ä½œã€‚</p>
<p><code>dispatch_io_set_high_water</code>è®¾ç½®åœ¨æ’é˜Ÿå¤„ç†ç¨‹åºå—ä¹‹å‰è¦å¤„ç†çš„æœ€å¤§å­—èŠ‚æ•°ã€‚</p>
<p><code>dispatch_io_set_low_water</code>è®¾ç½®å…¥é˜Ÿå¤„ç†ç¨‹åºå—ä¹‹å‰è¦å¤„ç†çš„æœ€å°å­—èŠ‚æ•°ã€‚</p>
<p><code>dispatch_io_set_interval</code>è®¾ç½®é—´éš”ï¼Œå•ä½ä¸ºçº³ç§’ï¼Œåœ¨è¯¥é—´éš”å¤„è°ƒç”¨é€šé“çš„I/Oå¤„ç†ç¨‹åºã€‚</p>
<p><code>dispatch_read</code>  ä½¿ç”¨æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦è°ƒåº¦å¼‚æ­¥è¯»å–æ“ä½œã€‚</p>
<p><code>dispatch_write</code> ä½¿ç”¨æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦è°ƒåº¦å¼‚æ­¥å†™å…¥æ“ä½œã€‚</p>
<p>è°ƒåº¦æ•°æ®å¯¹è±¡æä¾›äº†ä¸€ä¸ªç”¨äºç®¡ç†åŸºäºå†…å­˜çš„æ•°æ®ç¼“å†²åŒºçš„æ¥å£ã€‚å®¢æˆ·ç«¯è®¿é—®æ•°æ®ç¼“å†²åŒºå°†å…¶è§†ä¸ºè¿ç»­çš„å†…å­˜å—ï¼Œä½†æ˜¯åœ¨å†…éƒ¨ç¼“å†²åŒºå¯èƒ½ç”±å¤šä¸ªä¸è¿ç»­çš„å†…å­˜å—ç»„æˆã€‚</p>
<p><code>dispatch_data_create</code>ä½¿ç”¨æŒ‡å®šçš„å†…å­˜ç¼“å†²åŒºåˆ›å»ºä¸€ä¸ªæ–°çš„è°ƒåº¦æ•°æ®å¯¹è±¡ã€‚</p>
<p><code>dispatch_data_get_size</code>è¿”å›ç”±è°ƒåº¦æ•°æ®å¯¹è±¡ç®¡ç†çš„å†…å­˜é€»è¾‘å¤§å°ã€‚</p>
<p><code>dispatch_data_create_map</code>è¿”å›ä¸€ä¸ªæ–°çš„è°ƒåº¦æ•°æ®å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«æŒ‡å®šå¯¹è±¡å†…å­˜çš„è¿ç»­è¡¨ç¤ºå½¢å¼ã€‚</p>
<p><code>dispatch_data_create_concat</code>è¿”å›ä¸€ä¸ªæ–°çš„è°ƒåº¦æ•°æ®å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ç”±æ¥è‡ªå…¶ä»–ä¸¤ä¸ªæ•°æ®å¯¹è±¡çš„ä¸²è”æ•°æ®ç»„æˆã€‚</p>
<p><code>dispatch_data_create_subrange</code>è¿”å›ä¸€ä¸ªæ–°çš„è°ƒåº¦æ•°æ®å¯¹è±¡ï¼Œå…¶å†…å®¹ç”±å¦ä¸€ä¸ªå¯¹è±¡çš„å†…å­˜åŒºåŸŸçš„ä¸€éƒ¨åˆ†ç»„æˆã€‚</p>
<p><code>dispatch_data_apply</code>éå†è°ƒåº¦æ•°æ®å¯¹è±¡çš„å†…å­˜ï¼Œå¹¶åœ¨æ¯ä¸ªåŒºåŸŸä¸Šæ‰§è¡Œè‡ªå®šä¹‰ä»£ç ã€‚</p>
<p><code>dispatch_data_copy_region</code>è¿”å›ä¸€ä¸ªæ•°æ®å¯¹è±¡ï¼Œè¯¥æ•°æ®å¯¹è±¡åŒ…å«å¦ä¸€ä¸ªæ•°æ®å¯¹è±¡ä¸­çš„ä¸€éƒ¨åˆ†æ•°æ®ã€‚</p>
<p>å…³äºå‰©ä¸‹è¿™äº›å†…å®¹ï¼Œæ¥æ—¥å†æ›´æ–°ã€‚ã€‚ã€‚</p>
]]></content>
      <categories>
        <category>ç§»åŠ¨å¼€å‘</category>
        <category>IOSå¼€å‘</category>
      </categories>
      <tags>
        <tag>ObjC</tag>
        <tag>Objective-C</tag>
        <tag>ios</tag>
        <tag>gcd</tag>
        <tag>é˜Ÿåˆ—</tag>
        <tag>concurrent</tag>
      </tags>
  </entry>
  <entry>
    <title>[IOS.OC]GCDçš„ä½¿ç”¨ç²¾è§£(äºŒ)</title>
    <url>/content/aeb8f67e.html</url>
    <content><![CDATA[<h4 id="ä¸€ã€dispatch-after"><a href="#ä¸€ã€dispatch-after" class="headerlink" title="ä¸€ã€dispatch_after"></a>ä¸€ã€<code>dispatch_after</code></h4><p>è¿™ä¸ªæ–¹æ³•æ˜¯æŒ‡å®šä¸€ä¸ªæ—¶é—´ï¼Œç„¶åä¸€ç›´ç­‰å¾…ï¼Œç­‰åˆ°æŒ‡å®šçš„æ—¶é—´åï¼Œå°†å—(<code>block</code>)å¼‚æ­¥æäº¤åˆ°æŒ‡å®šé˜Ÿåˆ—ä¸­ã€‚æ³¨æ„å­—çœ¼ï¼Œæ˜¯æŒ‡å®šæ—¶é—´æäº¤åˆ°é˜Ÿåˆ—ï¼Œè€ŒéæŒ‡å®šæ—¶é—´æ‰§è¡Œï¼Œå…·ä½“æ‰§è¡Œæƒ…å†µä¸é˜Ÿåˆ—çš„è°ƒåº¦ç­‰æœ‰å…³ï¼Œå¦‚é‡åˆ°é˜»å¡ç­‰æƒ…å†µä¼šå»¶æ—¶ã€‚æ‰€ä»¥è¿™ä¸ªæ–¹æ³•æœ€ç†æƒ³ï¼Œä¹Ÿå°±æ˜¯æœ€å¿«çš„æƒ…å†µæ˜¯æäº¤åé©¬ä¸Šæ‰§è¡Œã€‚æ‰€ä»¥å¦‚æœè¦æ±‚ç²¾ç¡®æ—¶é—´æ‰§è¡Œï¼Œæ­¤æ–¹æ³•å¹¶ä¸é€‚ç”¨ï¼Œè€Œæ˜¯é€‚ç”¨äºå¤§è‡´æ—¶é—´æ‰§è¡Œçš„æ—¶å€™ã€‚</p>
<a id="more"></a>

<p>çœ‹ä¸‹å…·ä½“çš„ä½¿ç”¨ä»£ç ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºæ–¹å¼1</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_time_t time = dispatch_time(DISPATCH_TIME_NOW, <span class="number">2</span>ull*<span class="built_in">NSEC_PER_SEC</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> g_queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡1"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_after(time, g_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡2"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºæ–¹å¼2</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡1"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">2</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡2"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr></table></figure>

<p>ä¸¤ç§åˆ›å»ºæ–¹å¼ï¼Œå…¶å®éƒ½æ˜¯ä¸€æ ·çš„ã€‚å…±æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯<code>dispatch_time_t</code>ç±»å‹çš„å»¶è¿Ÿæ—¶é—´ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦æäº¤åˆ°çš„é˜Ÿåˆ—ï¼Œç¬¬ä¸‰ä¸ªæ˜¯è¦æ‰§è¡Œçš„ä»£ç å—ã€‚</p>
<p>æ¯”å¦‚ä¸Šé¢çš„ä»£ç ï¼Œå°±æ˜¯ä»ç°åœ¨(å½“å‰æ—¶é—´)å¼€å§‹ï¼Œå»¶è¿Ÿ2ç§’æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯2ç§’åæ‰§è¡Œ(å°†å—æäº¤åˆ°é˜Ÿåˆ—)ã€‚</p>
<p><code>dispatch_time</code>æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ª<code>dispatch_time_t</code>ç±»å‹çš„æ•°æ®ï¼Œæ˜¯ä¸€ä¸ª<code>unsigned long long</code>ç±»çš„æ•°æ®ã€‚<code>2ull</code>è¡¨ç¤ºçš„å°±æ˜¯<code>unsigned long long</code>ç±»å‹çš„<code>2</code>ï¼Œ<code>uul</code>æ˜¯cè¯­è¨€ä¸­çš„æ•°å€¼å­—é¢é‡ï¼Œæ˜¯æ˜¾ç¤ºè¡¨åç±»å‹æ—¶ä½¿ç”¨çš„å­—ç¬¦ä¸²ã€‚ <code>NSEC_PER_SEC</code>æ˜¯ç³»ç»Ÿæä¾›çš„å¸¸é‡å€¼ï¼Œè¡¨ç¤ºä¸€ç§’çš„çº³ç§’(æ¯«å¾®)æ•°ï¼Œå…·ä½“æ—¶é—´å…³ç³»å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>1ç§’(s) =1000 æ¯«ç§’(ms) = 1,000,000 å¾®ç§’(Î¼s) = 1,000,000,000 çº³ç§’(ns) = 1,000,000,000,000 çš®ç§’(ps)=1,000,000,000,000,000é£ç§’(fs)=1,000,000,000,000,000,000ä»„ç§’(zs) =1,000,000,000,000,,000,000,000å¹ºç§’(ys)1,000,000,000,000,000,000,000,000æ¸ºç§’(as)</p>
</blockquote>
<p>ç³»ç»Ÿæä¾›äº†ä»¥ä¸‹å‡ ä¸ªå¸¸é‡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;ä¸€ç§’ä¸­çš„æ¯«å¾®ç§’æ•°</span></pre></td></tr><tr><td class="code"><pre><span class="line">#define NSEC_PER_SEC 1000000000ull</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;ä¸€ç§’ä¸­çš„æ¯«ç§’æ•°</span></pre></td></tr><tr><td class="code"><pre><span class="line">#define NSEC_PER_MSEC 1000000ull</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;ä¸€ç§’ä¸­çš„å¾®ç§’æ•°</span></pre></td></tr><tr><td class="code"><pre><span class="line">#define USEC_PER_SEC 1000000ull</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;ä¸€å¾®ç§’ä¸­çš„çº³ç§’æ•°ã€‚</span></pre></td></tr><tr><td class="code"><pre><span class="line">#define NSEC_PER_USEC 1000ull</span></pre></td></tr></table></figure>

<p>ä¸Šé¢åˆ›å»ºæ—¶é—´ä½¿ç”¨çš„æ˜¯<code>dispatch_time</code>ï¼Œå®ƒä½¿ç”¨çš„æ˜¯ç›¸å¯¹æ—¶é—´çš„åˆ›å»ºæ–¹å¼ï¼Œè¿˜æœ‰ä¸€ä¸ªä»¥ç»å¯¹æ—¶é—´æ–¹å¼åˆ›å»ºçš„æ–¹æ³•<code>dispatch_walltime</code>ï¼Œå½“<code>dispatch_time</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸º<code>DISPATCH_WALLTIME_NOW</code>æ—¶ï¼Œç­‰ä»·äº<code>dispatch_walltime</code>ç¬¬ä¸€ä¸ªå‚æ•°ä¸º<code>NULL</code>æ—¶åˆ›å»ºçš„æ—¶é—´ã€‚</p>
<p><code>dispatch_walltime</code>æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªä¸º<code>struct timespec</code>çš„ç»“æ„ä½“ï¼Œç¬¬äºŒä¸ªä¸º<code>int64_t</code>ç±»å‹çš„å»¶è¿Ÿæ—¶é—´ã€‚<br><code>timespec</code>ç»“æ„ä½“ä¸­æœ‰ä¸¤ä¸ªå˜é‡ï¼Œä¸€ä¸ªæ˜¯<code>tv_sec</code>ä¸ºæ•´ç§’æ•°ï¼Œä¸€ä¸ªæ˜¯<code>tv_nsec</code>ä¸ºçº³ç§’æ•°ã€‚æ¯”å¦‚æˆ‘ä»¬è¦åœ¨æœªæ¥çš„æŸä¸€æ—¶é—´æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> timespec s_time;</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">double</span> second, decimals;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSDate</span> * date = [[<span class="built_in">NSDate</span> date] dateByAddingTimeInterval:<span class="number">2</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSTimeInterval</span> timeInterval = [date timeIntervalSince1970];;</span></pre></td></tr><tr><td class="code"><pre><span class="line">decimals = modf(timeInterval, &amp;second);</span></pre></td></tr><tr><td class="code"><pre><span class="line">s_time.tv_sec = second;</span></pre></td></tr><tr><td class="code"><pre><span class="line">s_time.tv_nsec = decimals * <span class="built_in">NSEC_PER_SEC</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_time_t time = dispatch_walltime(&amp;s_time, <span class="number">0</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> g_queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡1"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_after(time, g_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡2"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç å®ç°äº†ä»å½“å‰æ—¶é—´å¼€å§‹2ç§’åæ‰§è¡Œï¼Œ<code>double modf(double, double*)</code>å‡½æ•°è¿”å›æµ®ç‚¹æ•°çš„å°æ•°éƒ¨åˆ†ï¼Œæ•´æ•°éƒ¨åˆ†æ”¾åœ¨æŒ‡é’ˆ<code>double *</code>ä¸­ã€‚</p>
<p>ä¸¤ç§æ–¹æ³•çš„æ—¶é—´åŸç†æ˜¯ä¸ä¸€æ ·çš„ï¼Œç¬¬ä¸€ç§æ˜¯ä»ç°åœ¨å¼€å§‹å¤šå°‘ç§’åæ‰§è¡Œï¼Œç¬¬äºŒç§æ˜¯å®šä¹‰äº†æœªæ¥çš„ä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œåˆ°æ—¶é—´æ‰§è¡Œã€‚</p>
<h4 id="äºŒã€dispatch-once"><a href="#äºŒã€dispatch-once" class="headerlink" title="äºŒã€dispatch_once"></a>äºŒã€<code>dispatch_once</code></h4><p>åœ¨åº”ç”¨ç¨‹åºçš„å£°æ˜å‘¨æœŸå†…ï¼Œåªæ‰§è¡Œä¸€æ¬¡å—å¯¹è±¡ã€‚æ­¤æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæŒ‡å‘<code>dispatch_once_t</code>ç±»å‹çš„æŒ‡é’ˆï¼Œç¬¬äºŒä¸ªä¸ºè¦æ‰§è¡Œä¸€æ¬¡çš„ä»£ç å—å¯¹è±¡ã€‚</p>
<p><code>dispatch_once_t</code>æ˜¯ä¸“é—¨ä¸º<code>dispatch_once</code>æ–¹æ³•æä¾›çš„å‚æ•°ç±»å‹ï¼Œä½œä¸ºåªæ‰§è¡Œä¸€æ¬¡çš„æ ‡è®°ä½¿ç”¨ï¼Œæ‰€ä»¥å¿…é¡»å®šä¹‰åœ¨å…¨å±€æˆ–é™æ€ä½œç”¨åŸŸä¸­ã€‚</p>
<p>ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"æ‰§è¡Œæ€§ä¸€æ¬¡çš„ä»£ç "</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr></table></figure>

<p><code>dispatch_once</code>ç»å¸¸åœ¨åˆ›å»ºå•ä¾‹çš„æ—¶å€™ä½¿ç”¨ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨ä»¥ä¸‹æ–¹å¼åˆ›å»ºå•ä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">+ (<span class="keyword">instancetype</span>)shareInstance &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">static</span> SomeClass * shareClass = <span class="literal">nil</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">if</span>(!shareClass)&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        shareClass = [[SomeClass alloc] init];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">return</span> shareClass;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>ä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åŠ é”ï¼Œå¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">+ (<span class="keyword">instancetype</span>)shareInstance &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">static</span> SomeClass * shareClass = <span class="literal">nil</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">@synchronized</span> (<span class="keyword">self</span>) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="keyword">if</span>(!shareClass)&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">            shareClass = [[SomeClass alloc] init];</span></pre></td></tr><tr><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">return</span> shareClass;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¿™æ ·å°±å¢åŠ äº†æ–¹æ³•æ‰§è¡Œçš„å¼€é”€ï¼Œè€Œä½¿ç”¨<code>dispatch_once</code>æ–¹æ³•æ˜¯æä¾›çº¿ç¨‹å®‰å…¨çš„ï¼Œä»å¤šä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨æ—¶ï¼Œæ­¤æ–¹æ³•å°†åŒæ­¥ç­‰å¾…ï¼Œç›´åˆ°ä»£ç å—æ‰§è¡Œå®Œæ¯•ã€‚</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">+ (<span class="keyword">instancetype</span>)shareInstance &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">static</span> SomeClass * shareClass = <span class="literal">nil</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        shareClass = [[SomeClass alloc] init];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">return</span> shareClass;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>ä¸¤ç§åˆ›å»ºå•ä¾‹çš„æ–¹å¼ï¼Œä½¿ç”¨<code>dispatch_once</code>å°†æ›´é«˜æ•ˆï¼Œå®ƒä½¿ç”¨â€œåŸå­è®¿é—®(atomic access)â€æ¥æŸ¥è¯¢æ ‡è®°ï¼Œæ¥åˆ¤æ–­å¯¹åº”çš„ä»£ç å—æ˜¯å¦æ‰§è¡Œè¿‡ã€‚è€Œ<code>@synchronized</code>éšå¼æ·»åŠ é¢å¤–çš„å¼‚å¸¸å¤„ç†ç­‰ï¼Œå¢åŠ äº†å¼€é”€ã€‚ä»£ç ä¸­åº”é¿å…å¤§é‡ä½¿ç”¨<code>@synchronized</code>ã€‚</p>
<h4 id="ä¸‰ã€dispatch-set-target-queue"><a href="#ä¸‰ã€dispatch-set-target-queue" class="headerlink" title="ä¸‰ã€dispatch_set_target_queue"></a>ä¸‰ã€<code>dispatch_set_target_queue</code></h4><p>è®¾ç½®ç»™å®šå¯¹è±¡çš„ç›®æ ‡é˜Ÿåˆ—ã€‚ä¸ºæŒ‡å®šå¯¹è±¡è®¾ç½®ä¸€ä¸ªç›®æ ‡é˜Ÿåˆ—ï¼Œæœ‰ä¸¤ç§ç”¨é€”ï¼Œæ”¹å˜ç»™å®šå¯¹è±¡çš„ä¼˜å…ˆçº§å’Œåˆå¹¶å¤šä¸ªä¸²è¡Œé˜Ÿåˆ—ã€‚<br>ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç»™å®šé˜Ÿåˆ—ï¼Œç¬¬äºŒä¸ªä¸ºç›®æ ‡é˜Ÿåˆ—ã€‚</p>
<h5 id="1-æ”¹å˜é˜Ÿåˆ—ä¼˜å…ˆçº§"><a href="#1-æ”¹å˜é˜Ÿåˆ—ä¼˜å…ˆçº§" class="headerlink" title="1.æ”¹å˜é˜Ÿåˆ—ä¼˜å…ˆçº§"></a>1.æ”¹å˜é˜Ÿåˆ—ä¼˜å…ˆçº§</h5><p><code>dispatch_get_global_queue</code>æ–¹æ³•æ˜¯ç›´æ¥èƒ½è®¾ç½®ä¼˜å…ˆçº§çš„ï¼Œè€Œæˆ‘ä»¬è‡ªå®šä¹‰çš„é˜Ÿåˆ—æ˜¯ä¸èƒ½è®¾ç½®ä¼˜å…ˆçº§çš„ï¼Œå®ƒé»˜è®¤çš„ä¼˜å…ˆçº§å°±æ˜¯<code>dispatch_get_global_queue</code>çš„é»˜è®¤ä¼˜å…ˆçº§ï¼Œå³<code>DISPATCH_QUEUE_PRIORITY_DEFAULT</code>ã€‚æ—¢ç„¶è¦æ”¹å˜ç»™å®šé˜Ÿåˆ—çš„ä¼˜å…ˆçº§ï¼Œå°±å¯ä»¥å°†<code>dispatch_get_global_queue</code>ä½œä¸ºç›®æ ‡é˜Ÿåˆ—ï¼Œé€šè¿‡<code>dispatch_get_global_queue</code>çš„ä¼˜å…ˆçº§è®¾ç½®æ¥æ”¹å˜è‡ªå®šä¹‰é˜Ÿåˆ—çš„ä¼˜å…ˆçº§ã€‚çœ‹å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> s_queue = dispatch_queue_create(<span class="string">"com.mwpush"</span>, DISPATCH_QUEUE_CONCURRENT);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> gh_queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, <span class="number">0</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> gl_queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_LOW, <span class="number">0</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_set_target_queue(s_queue, gh_queue);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(gl_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä½ä¼˜å…ˆçº§1"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(gl_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä½ä¼˜å…ˆçº§2"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(s_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"é«˜ä¼˜å…ˆçº§1"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(gl_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä½ä¼˜å…ˆçº§3"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(s_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"é«˜ä¼˜å…ˆçº§2"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(s_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"é«˜ä¼˜å…ˆçº§3"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">é«˜ä¼˜å…ˆçº§<span class="number">2</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">é«˜ä¼˜å…ˆçº§<span class="number">3</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">é«˜ä¼˜å…ˆçº§<span class="number">1</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä½ä¼˜å…ˆçº§<span class="number">1</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä½ä¼˜å…ˆçº§<span class="number">3</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä½ä¼˜å…ˆçº§<span class="number">2</span></span></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å®šä¹‰çš„æ˜¯å¹¶å‘é˜Ÿåˆ—ï¼Œæ‰€ä»¥è¾“å‡ºçš„é¡ºåºä¸å®šï¼Œä½†æ˜¯é«˜ä¼˜å…ˆçº§çš„è¾“å‡ºä¼šå…ˆè¾“å‡ºã€‚</p>
<p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªä¼˜å…ˆçº§é™¤éç›¸å·®å¾ˆå¤šï¼Œæ¯”å¦‚ä¸€ä¸ªé«˜ä¸€ä¸ªä½æˆ–è€…åå°ï¼Œè¿™æ ·æ•ˆæœä¼šå¾ˆæ˜æ˜¾ï¼Œå¦‚æœç›¸å·®ä¸å¤šï¼Œæ¯”å¦‚<code>DISPATCH_QUEUE_PRIORITY_HIGH</code>å’Œ<code>DISPATCH_QUEUE_PRIORITY_DEFAULT</code>ï¼Œè¾“å‡ºç»“æœå°±ä¼šä¸å®šï¼Œä¹Ÿè®¸é«˜å…ˆè¾“å‡ºï¼Œä¹Ÿè®¸ä½å…ˆè¾“å‡ºï¼Œæ‰€ä»¥è¯´ï¼Œå¯¹äºä¼˜å…ˆçº§çš„è®¾ç½®åªæ˜¯ä¸€ä¸ªè¡¡é‡å€¼ï¼Œåªæ˜¯ä¸€ä¸ªå¤§è‡´çš„åˆ¤æ–­ï¼Œå¹¶ä¸æ˜¯æ¯æ¬¡éƒ½æŒ‰ç…§ä¼˜å…ˆçº§çš„è®¾ç½®æ‰§è¡Œã€‚</p>
<p>é€šè¿‡ä¸Šé¢çš„æ–¹æ³•æˆ‘ä»¬å°†è‡ªå®šä¹‰é˜Ÿåˆ—è®¾ç½®æˆé«˜æˆ–é»˜è®¤ä¼˜å…ˆçº§ï¼Œå½“åŒæ ·å®šä¹‰ä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—(<code>Serial Dispatch Queue</code>) æ—¶ä¸ä¸»é˜Ÿåˆ—åšå¯¹æ¯”å‘ç°ï¼Œå½“è‡ªå®šä¹‰é˜Ÿåˆ—ä¼˜å…ˆçº§è®¾ç½®ä¸º<code>DISPATCH_QUEUE_PRIORITY_HIGH</code>æˆ–<code>DISPATCH_QUEUE_PRIORITY_DEFAULT</code>æ—¶ï¼Œå‡ ä¹æ¯æ¬¡éƒ½æ˜¯æ¯”ä¸»é˜Ÿåˆ—å…ˆè¾“å‡ºï¼Œæ‰€ä»¥å¯ä»¥è¯´ä¸»é˜Ÿåˆ—çš„ä¼˜å…ˆçº§è¿˜æ˜¯æ¯”è¾ƒä½çš„(æµ‹è¯•åˆ¤æ–­ã€çŒœæµ‹)ã€‚</p>
<p>å½“æˆ‘ä»¬è¯•å›¾æ”¹å˜ä¸»é˜Ÿåˆ—ä¼˜å…ˆçº§æ—¶å‘ç°ï¼Œæ— è®ºä¸»é˜Ÿåˆ—ä¼˜å…ˆçº§è®¾ç½®æˆé«˜ä½ï¼Œå¯¹ç»“æœçš„è¾“å‡ºéƒ½æ²¡æœ‰ä»»ä½•å½±å“ï¼Œç»“æœä¾ç„¶éµå¾ªä¸Šä¸€æ¡çš„è§„å¾‹ï¼Œæ‰€ä»¥ä¼¼ä¹å¯ä»¥å¾—å‡ºç»“è®ºï¼Œä¸»é˜Ÿåˆ—çš„ä¼˜å…ˆçº§æ˜¯æ— æ³•æ›´æ”¹çš„ï¼Œè¿™é‡Œçš„ä»£ç æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œä¸å¤šåšè¯´æ˜ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±è¯•è¯•ã€‚</p>
<h5 id="2-åˆå¹¶å¤šä¸ªä¸²è¡Œå¤šåˆ—ä¸ºä¸€ä¸ªé˜Ÿåˆ—"><a href="#2-åˆå¹¶å¤šä¸ªä¸²è¡Œå¤šåˆ—ä¸ºä¸€ä¸ªé˜Ÿåˆ—" class="headerlink" title="2.åˆå¹¶å¤šä¸ªä¸²è¡Œå¤šåˆ—ä¸ºä¸€ä¸ªé˜Ÿåˆ—"></a>2.åˆå¹¶å¤šä¸ªä¸²è¡Œå¤šåˆ—ä¸ºä¸€ä¸ªé˜Ÿåˆ—</h5><p>æˆ‘ä»¬å®ç°å¹¶å‘æœ‰å¤šé‡é€”å¾„ï¼Œä½¿ç”¨å¹¶å‘é˜Ÿåˆ—å¹¶å¼‚æ­¥æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥åˆ›å»ºå¤šä¸ªä¸²è¡Œé˜Ÿåˆ—è¾¾åˆ°å¹¶å‘çš„ç›®çš„ã€‚ä½†æ˜¯åˆ›å»ºå¤šä¸ªä¸²è¡Œé˜Ÿåˆ—ä¼šåˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œå¢åŠ äº†ç³»ç»Ÿçš„å¼€é”€ï¼Œå¦‚æœæƒ³å°†å¤šä¸ªä¸²è¡Œé˜Ÿåˆ—å½’å¹¶ä¸ºä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—å°±å¯ä»¥ç”¨åˆ°<code>dispatch_set_target_queue</code>æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹:</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> s_queue1 = dispatch_queue_create(<span class="string">"com.mwpush1"</span>, <span class="literal">NULL</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> s_queue2 = dispatch_queue_create(<span class="string">"com.mwpush2"</span>, <span class="literal">NULL</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> s_queue3 = dispatch_queue_create(<span class="string">"com.mwpush3"</span>, <span class="literal">NULL</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> t_queue  = dispatch_queue_create(<span class="string">"com.mwpusht"</span>, <span class="literal">NULL</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_set_target_queue(s_queue1, t_queue);</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_set_target_queue(s_queue2, t_queue);</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_set_target_queue(s_queue3, t_queue);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(t_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ç›®æ ‡é˜Ÿåˆ—"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(s_queue1, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä¸²è¡Œé˜Ÿåˆ—1"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(s_queue2, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä¸²è¡Œé˜Ÿåˆ—2"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(s_queue3, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä¸²è¡Œé˜Ÿåˆ—3"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">ç›®æ ‡é˜Ÿåˆ—</span></pre></td></tr><tr><td class="code"><pre><span class="line">ä¸²è¡Œé˜Ÿåˆ—<span class="number">1</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä¸²è¡Œé˜Ÿåˆ—<span class="number">2</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä¸²è¡Œé˜Ÿåˆ—<span class="number">3</span></span></pre></td></tr></table></figure>

<p>å› ä¸ºæ˜¯ä¸²è¡Œé˜Ÿåˆ—ï¼Œè¾“å‡ºé¡ºåºå°±æ˜¯æŒ‰ç…§æ·»åŠ çš„é¡ºåºè¾“å‡ºçš„ï¼Œå…ˆè¿›å…ˆå‡ºï¼Œè¿™é‡Œè¦æ³¨æ„å‚æ•°çš„é¡ºåºï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºç›®æ ‡é˜Ÿåˆ—ï¼Œè®¾ç½®é”™è¯¯ä¹Ÿä¼šæ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯è¾¾ä¸åˆ°æƒ³è¦çš„ç›®çš„ã€‚å¦‚æœæ˜¯å¹¶å‘é˜Ÿåˆ—åˆ™æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œæ·»åŠ åä»ç„¶æ˜¯å¹¶å‘ï¼Œå¹¶æ²¡æœ‰ä»»ä½•å½±å“ã€‚</p>
<p>ä¹Ÿè¦æ³¨æ„ä¸è¦è®²Aè®¾ç½®ä¸ºBçš„ç›®æ ‡é˜Ÿåˆ—ï¼Œè€ŒåˆæŠŠBè®¾ç½®ä¸ºAçš„ç›®æ ‡é˜Ÿåˆ—ï¼Œè¿™æ˜¯é”™è¯¯çš„åšæ³•ï¼Œä¸ä¼šæœ‰ä»»ä½•è¾“å‡ºã€‚</p>
<h4 id="å››ã€dispatch-apply"><a href="#å››ã€dispatch-apply" class="headerlink" title="å››ã€dispatch_apply"></a>å››ã€<code>dispatch_apply</code></h4><p>æ­¤æ–¹æ³•ä¸»è¦ç”¨äºå°†ä¸€ä¸ªå—æäº¤åˆ°è°ƒåº¦é˜Ÿåˆ—è¿›è¡Œå¤šæ¬¡è°ƒç”¨ã€‚ä¸ºåŒæ­¥æ–¹æ³•ï¼Œä¼šç­‰ä»»åŠ¡å—è¿­ä»£æ‰§è¡Œå®Œæ¯•è¿”å›ã€‚å¦‚æœç›®æ ‡é˜Ÿåˆ—ä¸ºä¸²è¡Œé˜Ÿåˆ—ï¼Œåˆ™å—ä»»åŠ¡é¡ºåºæ‰§è¡Œï¼Œå¦‚æœä¸ºå¹¶å‘é˜Ÿåˆ—ï¼Œåˆ™å¹¶å‘æ‰§è¡Œï¼Œé¡ºåºä¸å®šã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸²è¡Œé˜Ÿåˆ—</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">"com.mwpush"</span>, <span class="literal">NULL</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_apply(<span class="number">10</span>, queue, ^(size_t index) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡1-%zu"</span>, index);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡2"</span>);</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span>-<span class="number">0</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span>-<span class="number">1</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span>-<span class="number">2</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span>-<span class="number">3</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span>-<span class="number">4</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span>-<span class="number">5</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span>-<span class="number">6</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span>-<span class="number">7</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span>-<span class="number">8</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span>-<span class="number">9</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">2</span></span></pre></td></tr></table></figure>

<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¹¶å‘é˜Ÿåˆ—</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">"com.mwpush"</span>, DISPATCH_QUEUE_CONCURRENT);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_apply(<span class="number">10</span>, queue, ^(size_t index) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡1-%zu"</span>, index);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡2"</span>);</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span>-<span class="number">0</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span>-<span class="number">3</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span>-<span class="number">4</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span>-<span class="number">2</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span>-<span class="number">1</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span>-<span class="number">5</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span>-<span class="number">7</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span>-<span class="number">6</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span>-<span class="number">8</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span>-<span class="number">9</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">2</span></span></pre></td></tr></table></figure>

<p>å½“é˜Ÿåˆ—ä¸ºå¹¶å‘é˜Ÿåˆ—æ—¶ï¼Œä¼šä¸ºä»»åŠ¡åˆ›å»ºå¤šä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œæ¥æé«˜æ‰§è¡Œæ•ˆç‡ã€‚</p>
<p>ç”±äº<code>dispatch_apply</code>æ–¹æ³•ä¸ºåŒæ­¥æ–¹æ³•ï¼Œä¼šé˜»å¡çº¿ç¨‹ï¼Œæ‰€ä»¥ä½¿ç”¨æ—¶ï¼Œå¦‚éåŒæ­¥è¦æ±‚ï¼Œåº”å°†å…¶æ·»åŠ åˆ°å¼‚æ­¥æ–¹æ³•<code>dispatch_async</code>ä¸­æ‰§è¡Œã€‚</p>
<h4 id="äº”ã€dispatch-suspendä¸dispatch-resume"><a href="#äº”ã€dispatch-suspendä¸dispatch-resume" class="headerlink" title="äº”ã€dispatch_suspendä¸dispatch_resume"></a>äº”ã€<code>dispatch_suspend</code>ä¸<code>dispatch_resume</code></h4><p><code>dispatch_suspend</code>æŒ‚èµ·(æš‚åœ)è°ƒåº¦å¯¹è±¡ä¸Šå—çš„è°ƒç”¨ï¼Œå‚æ•°ä¸ºè¦æŒ‚èµ·çš„è°ƒåº¦é˜Ÿåˆ—æˆ–è°ƒåº¦æºï¼Œä¸èƒ½æŒ‚èµ·å…¶ä»–ç±»å‹çš„è°ƒåº¦å¯¹è±¡ã€‚</p>
<p><code>dispatch_resume</code>æ¢å¤è°ƒåº¦å¯¹è±¡ä¸Šå—çš„è°ƒç”¨ï¼Œå‚æ•°ä¸ºè¦æ¢å¤çš„å¯¹è±¡ã€‚</p>
<p><code>dispatch_suspend</code>å’Œ<code>dispatch_resume</code>ä½¿ç”¨çš„æ˜¯ç±»ä¼¼å¼•ç”¨è®¡æ•°çš„æ–¹å¼ï¼ŒæŒ‚èµ·ä¸€æ¬¡æ„å‘³ç€è®¡æ•°åŠ ä¸€ï¼Œæ¢å¤ä¸€æ¬¡æ„å‘³ç€è®¡æ•°å‡ä¸€ï¼Œå½“è®¡æ•°å¤§äºé›¶æ—¶ï¼Œå¯¹è±¡ä¿æŒæŒ‚èµ·çŠ¶æ€ï¼Œæ‰€ä»¥ä½¿ç”¨æ—¶ï¼Œåº”åŒ¹é…<code>dispatch_suspend</code>ä¸<code>dispatch_resume</code>çš„è°ƒç”¨æ¥è¾¾åˆ°å¹³è¡¡ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> c_queue = dispatch_queue_create(<span class="string">"com.mwpush"</span>, DISPATCH_QUEUE_CONCURRENT);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(c_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡1"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"æŒ‚èµ·é˜Ÿåˆ—"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_suspend(c_queue);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(c_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡2"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(c_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡3"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">[<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"æ¢å¤é˜Ÿåˆ—"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_resume(c_queue);</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">æŒ‚èµ·é˜Ÿåˆ—</span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸‹é¢è¾“å‡ºä¸º2ç§’åé˜Ÿåˆ—æ¢å¤æ‰§è¡Œåè¾“å‡º</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">æ¢å¤é˜Ÿåˆ—</span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">3</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">2</span></span></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼ŒæŒ‚èµ·é˜Ÿåˆ—åªèƒ½æŒ‚èµ·è¿˜æ²¡æœ‰æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå·²ç»æ‰§è¡Œæˆ–æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡æ— æ³•æŒ‚èµ·ã€‚<code>dispatch_suspend</code>ä¸<code>dispatch_resume</code>è¦æˆå¯¹å‡ºç°ï¼Œå¦åˆ™ä¼šå¼•èµ·å´©æºƒã€‚</p>
<p>å…¨å±€å¹¶å‘é˜Ÿåˆ—<code>dispatch_get_global_queue</code>å’Œä¸»é˜Ÿåˆ—<code>dispatch_get_main_queue</code>ä¸­æ˜¯æ— æ³•ä½¿ç”¨<code>dispatch_suspend</code>ã€<code>dispatch_resume</code>çš„(ä½¿ç”¨åä¸èµ·ä»»ä½•æ•ˆæœ)ã€‚</p>
<h4 id="å…­ã€dispatch-queue-set-specificä¸dispatch-get-specific"><a href="#å…­ã€dispatch-queue-set-specificä¸dispatch-get-specific" class="headerlink" title="å…­ã€dispatch_queue_set_specificä¸dispatch_get_specific"></a>å…­ã€<code>dispatch_queue_set_specific</code>ä¸<code>dispatch_get_specific</code></h4><p><code>dispatch_queue_set_specific</code>ç”¨æ¥è®¾ç½®æŒ‡å®šé˜Ÿåˆ—çš„é”®å€¼æ•°æ®ã€‚æœ‰4ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯<code>dispatch_queue_t</code>ç±»å‹å®šä¹‰çš„é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯è¦æ·»åŠ é”®å€¼çš„é˜Ÿåˆ—ï¼Œç¬¬äºŒä¸ªæ˜¯<code>const void *</code>ç±»å‹çš„é”®ï¼Œé€šè¿‡é”®æ¥æŸ¥æ‰¾å€¼æ—¶æ˜¯é€šè¿‡æŒ‡é’ˆçš„å€¼æ¥åšæ¯”è¾ƒçš„ï¼Œå¯ä»¥ä½¿ç”¨é™æ€å˜é‡çš„æŒ‡é’ˆæˆ–å…¶ä»–å¯ä»¥å”¯ä¸€æ ‡è¯†è¯¥å€¼çš„å€¼ã€‚ç¬¬ä¸‰ä¸ªæ˜¯<code>void *</code>ç±»å‹é”®å¯¹åº”çš„å€¼ï¼Œç¬¬å››ä¸ªæ˜¯<code>dispatch_function_t</code>ç±»å‹çš„ææ„å‡½æ•°ï¼Œç”¨æ¥é‡Šæ”¾ä¸Šä¸‹æ–‡æ•°æ®ï¼Œå¯ä¸ºç©º(<code>NULL</code>)ï¼Œå½“é”®å¯¹åº”çš„å€¼ä½¿ç”¨ARCä¸èƒ½ç®¡ç†å†…å­˜æ–¹å¼çš„å‚æ•°æ—¶ï¼Œåœ¨æ­¤é‡Šæ”¾ã€‚</p>
<p><code>dispatch_queue_get_specific</code>è·å–ä¸æŒ‡å®šé˜Ÿåˆ—å…³è”çš„é”®çš„å€¼ã€‚æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯<code>dispatch_queue_t</code>ç±»å‹ï¼Œç¬¬äºŒä¸ªæ˜¯<code>const void *</code>ç±»å‹çš„é”®ã€‚</p>
<p><code>dispatch_get_specific</code>è¿”å›ä¸å½“å‰é˜Ÿåˆ—ç›¸å…³è”çš„é”®çš„å€¼ã€‚æœ‰ä¸€ä¸ªå‚æ•°ï¼Œä¸º<code>const void *</code>ç±»å‹çš„é”®ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> * kQueueAKey = <span class="string">"s_queueA"</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> * kQueueBKey = <span class="string">"s_queueB"</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> s_queueA = dispatch_queue_create(<span class="string">"com.mwpushA"</span>, <span class="literal">NULL</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> s_queueB = dispatch_queue_create(<span class="string">"com.mwpushB"</span>, <span class="literal">NULL</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_queue_set_specific(s_queueA, kQueueAKey, kQueueAKey, <span class="literal">NULL</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_queue_set_specific(s_queueB, kQueueBKey, kQueueBKey, <span class="literal">NULL</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(s_queueA, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    __block <span class="keyword">char</span> * specificAValue = dispatch_get_specific(kQueueAKey);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">char</span> * specificGetAValue = dispatch_queue_get_specific(s_queueA, kQueueAKey);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">char</span> * specificGetBValue = dispatch_queue_get_specific(s_queueB, kQueueBKey);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Aé˜Ÿåˆ—é”®å¯¹åº”çš„å€¼%s"</span>,specificGetAValue);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Bé˜Ÿåˆ—é”®å¯¹åº”çš„å€¼%s"</span>,specificGetBValue);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">if</span>(specificAValue) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"è·å–Aé˜Ÿåˆ—ï¼Œå€¼éç©ºï¼Œè¯æ˜æ˜¯Aé˜Ÿåˆ—"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;<span class="keyword">else</span>&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"è·å–Aé˜Ÿåˆ—ï¼Œå€¼ä¸ºç©ºï¼Œåˆ™ä¸æ˜¯Açš„é˜Ÿåˆ—"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">dispatch_async</span>(s_queueB, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        specificAValue = dispatch_get_specific(kQueueAKey);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        </span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="keyword">if</span>(specificAValue) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"è·å–Aé˜Ÿåˆ—ï¼Œå€¼éç©ºï¼Œè¯æ˜æ˜¯Aé˜Ÿåˆ—"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        &#125;<span class="keyword">else</span>&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">            <span class="keyword">char</span> * specificGetBValue = dispatch_queue_get_specific(s_queueB, kQue</span></pre></td></tr><tr><td class="code"><pre><span class="line">            <span class="keyword">if</span>(specificGetBValue) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@"è·å–Bé˜Ÿåˆ—ï¼Œå€¼éç©ºï¼Œè¯æ˜æ˜¯Bé˜Ÿåˆ—"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">            &#125;<span class="keyword">else</span>&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@"è·å–Bé˜Ÿåˆ—ï¼Œå€¼ä¸ºç©ºï¼Œåˆ™ä¸æ˜¯Bçš„é˜Ÿåˆ—"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">            &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        </span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="keyword">char</span> * specificGetAValue = dispatch_queue_get_specific(s_queueA, kQueueAK</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="keyword">char</span> * specificGetBValue = dispatch_queue_get_specific(s_queueB, kQueueBK</span></pre></td></tr><tr><td class="code"><pre><span class="line">        </span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Aé˜Ÿåˆ—é”®å¯¹åº”çš„å€¼%s"</span>,specificGetAValue);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Bé˜Ÿåˆ—é”®å¯¹åº”çš„å€¼%s"</span>,specificGetBValue);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        </span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">       </span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">Aé˜Ÿåˆ—é”®å¯¹åº”çš„å€¼s_queueA</span></pre></td></tr><tr><td class="code"><pre><span class="line">Bé˜Ÿåˆ—é”®å¯¹åº”çš„å€¼s_queueB</span></pre></td></tr><tr><td class="code"><pre><span class="line">è·å–Aé˜Ÿåˆ—ï¼Œå€¼éç©ºï¼Œè¯æ˜æ˜¯Aé˜Ÿåˆ—</span></pre></td></tr><tr><td class="code"><pre><span class="line">è·å–Bé˜Ÿåˆ—ï¼Œå€¼éç©ºï¼Œè¯æ˜æ˜¯Bé˜Ÿåˆ—</span></pre></td></tr><tr><td class="code"><pre><span class="line">Aé˜Ÿåˆ—é”®å¯¹åº”çš„å€¼s_queueA</span></pre></td></tr><tr><td class="code"><pre><span class="line">Bé˜Ÿåˆ—é”®å¯¹åº”çš„å€¼s_queueB</span></pre></td></tr></table></figure>

<p>æ€»ç»“ï¼š<code>dispatch_queue_get_specific</code>æ˜¯æ ¹æ®é”®æŸ¥æ‰¾æŒ‡å®šé˜Ÿåˆ—çš„å¯¹åº”çš„å€¼ï¼Œåªè¦å®šä¹‰è¿‡ï¼Œåœ¨åç»­æ‰§è¡Œä¸­åœ¨å“ªéƒ½èƒ½è¾“å‡ºï¼Œæ— è®ºæ˜¯å¦åœ¨å½“å‰é˜Ÿåˆ—ã€‚è€Œ<code>dispatch_get_specific</code>åªæœ‰æ‰€åœ¨çš„æ˜¯å½“å‰é˜Ÿåˆ—æ—¶ï¼Œæ‰ä¼šè¾“å‡ºé˜Ÿåˆ—çš„å€¼ï¼Œå¦åˆ™ä¸ºç©ºã€‚</p>
<p>å‚æ•°è®¾ç½®çš„å…¶ä»–æ–¹å¼ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> kQueneKey;</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">CFStringRef</span> value = <span class="built_in">CFSTR</span>(<span class="string">"s_queue"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> s_queue = dispatch_queue_create(<span class="string">"com.mwpush"</span>, <span class="literal">NULL</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_queue_set_specific(s_queue, &amp;kQueneKey, (<span class="keyword">void</span> *)value, (dispatch_function_t)<span class="built_in">CFRelease</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(s_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">CFStringRef</span> specificGetValue = dispatch_queue_get_specific(s_queue, &amp;kQueneKey);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"é˜Ÿåˆ—é”®å¯¹åº”çš„å€¼%@"</span>,specificGetValue);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">CFStringRef</span> specificValue = dispatch_get_specific(&amp;kQueneKey);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">if</span>(specificValue) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"å€¼éç©ºï¼Œè¯æ˜æ˜¯è·å–çš„é˜Ÿåˆ—"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;<span class="keyword">else</span>&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"å€¼ä¸ºç©ºï¼Œåˆ™ä¸æ˜¯æƒ³è·å–çš„é˜Ÿåˆ—"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">       </span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr></table></figure>

<p><code>dispatch_get_current_queue</code>åœ¨ iOS 6.0ä»¥åå·²åºŸå¼ƒï¼Œå®ƒä¼šå¼•å‘ä¸€ç³»åˆ—é—®é¢˜ï¼Œè€Œä¸”è¿”å›çš„å€¼æœ‰æ—¶ä¹Ÿä¸æ˜¯å¾ˆå‡†ï¼Œåªèƒ½ç”¨åœ¨ä»£ç è°ƒè¯•é˜¶æ®µï¼Œä¸èƒ½ç”¨äº<code>Release</code>ç‰ˆæœ¬ã€‚åœ¨<code>Release</code>ç‰ˆæœ¬ä¸­å¯ä»¥ä½¿ç”¨ä¸Šè¿°æ–¹æ³•ã€‚</p>
<h4 id="ä¸ƒã€dispatch-queue-get-label"><a href="#ä¸ƒã€dispatch-queue-get-label" class="headerlink" title="ä¸ƒã€dispatch_queue_get_label"></a>ä¸ƒã€<code>dispatch_queue_get_label</code></h4><p>è¿”å›ç›®æ ‡é˜Ÿåˆ—çš„æ ‡ç­¾ï¼Œå‚æ•°ä¸ºç›®æ ‡é˜Ÿåˆ—ï¼Œè¿”å›å€¼ä¸º<code>const char *</code>ç±»å‹çš„æ ‡ç­¾åå­—ç¬¦ä¸²ã€‚å¦‚æœªè®¾ç½®æ ‡ç­¾åˆ™è¿”å›<code>NULL</code>ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> s_queue = dispatch_queue_create(<span class="string">"com.mwpush"</span>, <span class="literal">NULL</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> * labelName = dispatch_queue_get_label(s_queue);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, labelName);</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">com<span class="variable">.mwpush</span></span></pre></td></tr></table></figure>



<h4 id="å…«ã€dispatch-set-contextä¸dispatch-get-context"><a href="#å…«ã€dispatch-set-contextä¸dispatch-get-context" class="headerlink" title="å…«ã€dispatch_set_contextä¸dispatch_get_context"></a>å…«ã€<code>dispatch_set_context</code>ä¸<code>dispatch_get_context</code></h4><p>å°†è‡ªå®šä¹‰çš„ä¸Šä¸‹æ–‡ä¸ç›®æ ‡å¯¹è±¡å…³è”ï¼Œéœ€æ ¹æ®éœ€è¦åˆ†é…å’Œå–æ¶ˆæ•°æ®åˆ†é…ã€‚æ¯”å¦‚<code>malloc</code>å‡ºæ¥çš„æ•°æ®å°±è¦æœ‰å¯¹åº”çš„<code>free</code>ï¼Œ<code>new</code>å‡ºæ¥çš„å°±å¾—<code>delete</code>ã€‚</p>
<p><code>dispatch_set_context</code>æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸º<code>dispatch_object_t</code>ç±»å‹çš„ç›®æ ‡å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸º<code>const void *</code>ç±»å‹çš„ä¸Šä¸‹æ–‡ã€‚</p>
<p><code>dispatch_get_context</code>è·å–ä¸Šä¸‹æ–‡æ•°æ®ï¼Œä¸€ä¸ªå‚æ•°ï¼Œä¸º<code>dispatch_object_t</code>ç±»å‹å¯¹è±¡ã€‚</p>
<p><code>dispatch_set_finalizer_f</code>ç»ˆç»“å™¨æ–¹æ³•ï¼Œç”¨æ¥è°ƒç”¨åœ¨å¯¹åº”é˜Ÿåˆ—ä¸Šä¸‹æ–‡ä¸­å¼€è¾Ÿçš„å†…å­˜ç­‰çš„æ¸…ç†æ–¹æ³•ã€‚ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªä¸ºç›®æ ‡é˜Ÿåˆ—ï¼Œç¬¬äºŒä¸ªä¸º<code>dispatch_function_t</code>ç±»å‹å‡½æ•°æŒ‡é’ˆã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> s_queue = dispatch_queue_create(<span class="string">"com.mwpush"</span>, <span class="literal">NULL</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_set_context(s_queue, <span class="string">"www.mwpush.com"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(s_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">char</span> * mycontext = dispatch_get_context(s_queue);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, mycontext);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">www<span class="variable">.mwpush</span><span class="variable">.com</span></span></pre></td></tr></table></figure>

<p>ä¸Šé¢æˆ‘ä»¬åªæ˜¯ç®€å•çš„è®¾ç½®äº†ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡ï¼Œæ²¡æœ‰æ¶‰åŠåˆ°åŠ¨æ€å¼€è¾Ÿå†…å­˜çš„é—®é¢˜ï¼Œå¦‚æœæ¶‰åŠåˆ™éœ€è¦æ‰‹åŠ¨å¤„ç†ï¼Œä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> Person &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">char</span> * name;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">int</span> age;</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125; Student;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> cleanData(<span class="keyword">void</span> *context) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  	<span class="built_in">NSLog</span>(<span class="string">@"æ¸…ç†é‡Šæ”¾"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    free(context);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)setContextData &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    Student * student = (Student *)malloc(<span class="keyword">sizeof</span>(Student));</span></pre></td></tr><tr><td class="code"><pre><span class="line">    student-&gt;name = <span class="string">"zhangsan"</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    student-&gt;age = <span class="number">20</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">dispatch_queue_t</span> s_queue = dispatch_queue_create(<span class="string">"com.mwpush"</span>, <span class="literal">NULL</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    dispatch_set_context(s_queue, student);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    dispatch_set_finalizer_f(s_queue, &amp;cleanData);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">dispatch_async</span>(s_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        Student * myStudent = dispatch_get_context(s_queue);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, myStudent-&gt;name);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœä¸ºï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">zhangsan</span></pre></td></tr><tr><td class="code"><pre><span class="line">æ¸…ç†é‡Šæ”¾</span></pre></td></tr></table></figure>

<p>å¦‚æœä¸Šä¸‹æ–‡ä¸º<code>Foundation</code>å¯¹è±¡ï¼Œå› ä¸ºå‚æ•°ä¸º<code>void *</code>ç±»å‹ï¼Œéœ€è¦åšæ¡¥æ¥å¤„ç†ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Personç±»ä»£ç </span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> * name;</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">NSInteger</span> age;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@end</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//å®ç°ä»£ç </span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Person.h"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"è°ƒç”¨äº†dealloc"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@end</span></span></pre></td></tr></table></figure>

<p>è°ƒç”¨å¤„ç†ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> cleanData(<span class="keyword">void</span> *context) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"æ¸…ç†é‡Šæ”¾"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">CFRelease</span>(context);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)setContextData &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    Person *person = [[Person alloc] init];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    person.name = <span class="string">@"zhangsan"</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    person.age = <span class="number">20</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">dispatch_queue_t</span> s_queue = dispatch_queue_create(<span class="string">"com.mwpush"</span>, <span class="literal">NULL</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    dispatch_set_context(s_queue, (__bridge_retained <span class="keyword">void</span> *)person);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    dispatch_set_finalizer_f(s_queue, &amp;cleanData);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">dispatch_async</span>(s_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        Person * myPerson = (__bridge Person *)dispatch_get_context(s_queue);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, myPerson.name);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">zhangsan</span></pre></td></tr><tr><td class="code"><pre><span class="line">æ¸…ç†é‡Šæ”¾</span></pre></td></tr><tr><td class="code"><pre><span class="line">è°ƒç”¨äº†dealloc</span></pre></td></tr></table></figure>



<h4 id="ä¹ã€dispatch-barrier-asyncä¸dispatch-barrier-sync"><a href="#ä¹ã€dispatch-barrier-asyncä¸dispatch-barrier-sync" class="headerlink" title="ä¹ã€dispatch_barrier_asyncä¸dispatch_barrier_sync"></a>ä¹ã€<code>dispatch_barrier_async</code>ä¸<code>dispatch_barrier_sync</code></h4><p><code>dispatch_barrier_async</code>æäº¤ä¸€ä¸ªå¼‚æ­¥æ‰§è¡Œçš„éšœç¢(ä¹Ÿæœ‰å«æ …æ )å—åˆ°ç›®æ ‡é˜Ÿåˆ—ï¼Œå¹¶ç«‹å³è¿”å›ã€‚æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ç›®æ ‡é˜Ÿåˆ—ï¼Œç¬¬äºŒä¸ªæ˜¯è¦æäº¤åˆ°ç›®æ ‡é˜Ÿåˆ—çš„éšœç¢å—ã€‚æ­¤æ–¹æ³•éœ€ä¸è‡ªå®šä¹‰çš„å¹¶å‘é˜Ÿåˆ—ä¸€èµ·ä½¿ç”¨æ‰èƒ½å‘æŒ¥å‡ºå…¶ç‰¹æœ‰çš„æ•ˆæœã€‚ä¸è‡ªå®šä¹‰çš„å¹¶å‘é˜Ÿåˆ—(é€šè¿‡<code>dispatch_queue_create</code>åˆ›å»ºå‡ºçš„<code>Concurrent Dispatch</code>)ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œ<code>barrier</code>æäº¤çš„å—ä¸ä¼šä¸è¯¥é˜Ÿåˆ—ä¸Šçš„å…¶ä»–å—åŒæ—¶è¿è¡Œã€‚å®ƒä¼šç­‰å¾…å®ƒæ’å…¥ä½ç½®ä¹‹å‰çš„å—æ‰§è¡Œå®Œæˆ(å½“å‰æ‰§è¡Œçš„æ‰€æœ‰æ“ä½œ)ï¼Œç„¶åæ‰§è¡Œæäº¤çš„éšœç¢å—å¹¶é˜»å¡é˜Ÿåˆ—ä¸Šçš„å¾…æ‰§è¡Œå†…å®¹ï¼Œç­‰éšœç¢å—æ‰§è¡Œå®Œæ¯•ï¼Œç»§ç»­æ‰§è¡Œåç»­æ“ä½œã€‚å¦‚æœ<code>barrier</code>æäº¤çš„å—ä¸æ˜¯ä¸è‡ªå®šä¹‰çš„å¹¶å‘é˜Ÿåˆ—ä¸€èµ·ä½¿ç”¨ï¼Œåˆ™åŠŸèƒ½ç±»ä¼¼äº<code>dispatch_async</code>ã€‚</p>
<p><code>dispatch_barrier_sync</code>æäº¤ä¸€ä¸ªåŒæ­¥æ‰§è¡Œçš„éšœç¢å—åˆ°ç›®æ ‡é˜Ÿåˆ—ï¼Œå¹¶ç­‰å¾…è¯¥å—æ‰§è¡Œå®Œæ¯•ã€‚æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ç›®æ ‡é˜Ÿåˆ—ï¼Œç¬¬äºŒä¸ªæ˜¯è¦æäº¤åˆ°ç›®æ ‡é˜Ÿåˆ—çš„éšœç¢å—ã€‚æ­¤æ–¹æ³•ä¹ŸåŒæ ·éœ€è¦ä¸è‡ªå®šä¹‰çš„å¹¶å‘é˜Ÿåˆ—ä¸€èµ·ä½¿ç”¨ï¼Œæ­¤æ—¶ä¼šç­‰å¾…å…¶å—ä»»åŠ¡æ’å…¥ä¹‹å‰çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ç„¶åæ‰§è¡Œï¼Œå¹¶é˜»å¡é˜Ÿåˆ—ä¸Šçš„æ‰§è¡Œå†…å®¹ï¼Œä¸”é˜»å¡<code>dispatch_barrier_sync</code>æ–¹æ³•æ‰€åœ¨çš„çº¿ç¨‹ã€‚å¦‚æœä¸<code>dispatch_get_global_queue</code>æˆ–ä¸²è¡Œé˜Ÿåˆ—(åŒ…æ‹¬ä¸»é˜Ÿåˆ—ä¸è‡ªå®šä¹‰ä¸²è¡Œé˜Ÿåˆ—)ä¸€èµ·ä½¿ç”¨ï¼Œåˆ™ç›¸å½“äº<code>dispatch_sync</code>ã€‚æ³¨æ„ï¼Œå› ä¸ºæ˜¯åŒæ­¥æ–¹æ³•ï¼Œæ‰€ä»¥å½“å…¶ç›®æ ‡é˜Ÿåˆ—ä¸å½“å‰æ‰€åœ¨é˜Ÿåˆ—ä¸ºåŒä¸€é˜Ÿåˆ—æ—¶ï¼Œå°†é€ æˆæ­»é”ï¼Œå…³äºè¿™ä¸ªå¯ä»¥çœ‹ <a href="http://www.mwpush.com/content/d771b58d.html">GCDçš„ä½¿ç”¨ç²¾è§£(-)</a> ä¸­å¯¹æ­»é”çš„è¯´æ˜ã€‚</p>
<p>å…³äº<code>dispatch_barrier_sync</code>çš„ä»£ç è¿™é‡Œå°±ä¸åœ¨å†™äº†ï¼Œéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œå½“ä¸<code>dispatch_get_global_queue</code>ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œ<code>barrier</code>æäº¤å—ä»»åŠ¡ä¸èƒ½ä¿è¯å½“å…¶æ‰§è¡Œæ—¶ï¼Œå…¶å‰åºä»»åŠ¡éƒ½å·²æ‰§è¡Œå®Œæ¯•ï¼Œæœ‰å¯èƒ½å…ˆæ‰§è¡Œ<code>barrier</code>æäº¤çš„å—ä»»åŠ¡ã€‚</p>
<p><code>dispatch_barrier_async</code> ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> c_queue = dispatch_queue_create(<span class="string">"com.mwpush"</span>, DISPATCH_QUEUE_CONCURRENT);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(c_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡1"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(c_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡2"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_barrier_async(c_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">   </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"å¾ªç¯ä»»åŠ¡"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(c_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡3"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(c_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡4"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"å…¶ä»–ä»»åŠ¡"</span>);</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">å…¶ä»–ä»»åŠ¡</span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">2</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">å¾ªç¯ä»»åŠ¡</span></pre></td></tr><tr><td class="code"><pre><span class="line">å¾ªç¯ä»»åŠ¡</span></pre></td></tr><tr><td class="code"><pre><span class="line">å¾ªç¯ä»»åŠ¡</span></pre></td></tr><tr><td class="code"><pre><span class="line">å¾ªç¯ä»»åŠ¡</span></pre></td></tr><tr><td class="code"><pre><span class="line">å¾ªç¯ä»»åŠ¡</span></pre></td></tr><tr><td class="code"><pre><span class="line">å¾ªç¯ä»»åŠ¡</span></pre></td></tr><tr><td class="code"><pre><span class="line">å¾ªç¯ä»»åŠ¡</span></pre></td></tr><tr><td class="code"><pre><span class="line">å¾ªç¯ä»»åŠ¡</span></pre></td></tr><tr><td class="code"><pre><span class="line">å¾ªç¯ä»»åŠ¡</span></pre></td></tr><tr><td class="code"><pre><span class="line">å¾ªç¯ä»»åŠ¡</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//ä»¥ä¸‹ä¸ºbarrierå¾ªç¯æ‰§è¡Œå®Œæ¯•åï¼Œå»¶è¿Ÿ2ç§’è¾“å‡º</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">3</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">4</span></span></pre></td></tr></table></figure>

<p>é€šè¿‡è¾“å‡ºå¯ä»¥çœ‹å‡ºï¼Œ<code>dispatch_barrier_async</code>å¹¶ä¸é˜»å¡ä¸»çº¿ç¨‹ä»»åŠ¡çš„æ‰§è¡Œï¼Œåªæ˜¯é˜»å¡ç›®æ ‡é˜Ÿåˆ—çš„åç»­å—ä»»åŠ¡ï¼Œå¾…å…¶æ‰§è¡Œå®Œæ¯•ï¼Œåç»­ä»»åŠ¡æŒ‰åŸå§‹æ‰§è¡Œæ“ä½œç»§ç»­æ‰§è¡Œã€‚</p>
<p>å½“å…¶ä¸<code>dispatch_get_global_queue</code>æˆ–ä¸²è¡Œé˜Ÿåˆ—(åŒ…æ‹¬ä¸»é˜Ÿåˆ—ä¸è‡ªå®šä¹‰ä¸²è¡Œé˜Ÿåˆ—)ä¸€èµ·ä½¿ç”¨æ—¶ï¼ŒåŠŸèƒ½ä¸<code>dispatch_async</code>ç›¸åŒã€‚å…¨å±€å¹¶å‘é˜Ÿåˆ—å±äºå…±äº«èµ„æºï¼Œä¸å…è®¸å•ä¸ªç»„ä»¶å¯¹å…¶è¿›è¡Œé˜»å¡(è¯´çš„æ˜¯é˜Ÿåˆ—é˜»å¡ï¼Œè€Œéçº¿ç¨‹)ã€‚</p>
]]></content>
      <categories>
        <category>ç§»åŠ¨å¼€å‘</category>
        <category>IOSå¼€å‘</category>
      </categories>
      <tags>
        <tag>ObjC</tag>
        <tag>Objective-C</tag>
        <tag>ios</tag>
        <tag>gcd</tag>
        <tag>é˜Ÿåˆ—</tag>
        <tag>concurrent</tag>
      </tags>
  </entry>
  <entry>
    <title>[IOS.OC]GCDçš„ä½¿ç”¨ç²¾è§£(-)</title>
    <url>/content/d771b58d.html</url>
    <content><![CDATA[<h4 id="ä¸€ã€æ¦‚å¿µ"><a href="#ä¸€ã€æ¦‚å¿µ" class="headerlink" title="ä¸€ã€æ¦‚å¿µ"></a>ä¸€ã€æ¦‚å¿µ</h4><p><code>GCD(Grand Central Dispatch)</code>ï¼Œå¤§ä¸­æ¢æ´¾å‘ï¼Œæ˜¯ä¸€å¥—åŸºäºCè¯­è¨€çš„å¤šçº¿ç¨‹å¼€å‘æ¡†æ¶ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªæ˜“ç”¨çš„æŠ½è±¡å±‚ï¼Œä½¿å¼€å‘è€…ä¸éœ€è¦å¤„ç†åº•å±‚çš„çº¿ç¨‹ç®¡ç†å°±å¯ä»¥å……åˆ†åˆ©ç”¨ç³»ç»Ÿçš„å¤šæ ¸ç‰¹æ€§ï¼Œå¯ä»¥è‡ªåŠ¨å¹³è¡¡ç³»ç»Ÿèµ„æºåˆ†é…æ–¹å¼ï¼Œæé«˜ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡ï¼Œæ˜¯å¼‚æ­¥æ‰§è¡Œä»»åŠ¡çš„æŠ€æœ¯ä¹‹ä¸€ã€‚                                                                          </p>
<p><code>GCD API</code>çš„æ ¸å¿ƒæ¦‚å¿µæ˜¯è°ƒåº¦é˜Ÿåˆ—ï¼Œå¯¹çº¿ç¨‹çš„æ“ä½œå®é™…ä¸Šæ˜¯ç”±è°ƒåº¦é˜Ÿåˆ—å®Œæˆçš„ï¼Œå¼€å‘è€…åªéœ€å°†ä»»åŠ¡æ·»åŠ åˆ°è°ƒåº¦é˜Ÿåˆ—å³å¯ï¼Œç³»ç»Ÿè´Ÿè´£çº¿ç¨‹çš„åˆ›å»ºã€ç®¡ç†ï¼Œæäº¤ç»™è°ƒåº¦é˜Ÿåˆ—çš„ä»»åŠ¡ä¼šåœ¨å®Œå…¨å—ç³»ç»Ÿç®¡ç†çš„çº¿ç¨‹æ± ä¸Šæ‰§è¡Œã€‚å› ä¸ºçº¿ç¨‹çš„ç®¡ç†ç”±ç³»ç»Ÿæ‰§è¡Œï¼Œç³»ç»Ÿä¼šæ ¹æ®ç³»ç»Ÿå ç”¨èµ„æºç›¸å¯¹åˆç†åˆ†é…èµ„æºï¼Œæ¯”ä¼ ç»Ÿçš„çº¿ç¨‹æé«˜äº†æ•ˆç‡ã€‚</p>
<a id="more"></a>

<h4 id="äºŒã€Dispatch-Queue-æ´¾å‘é˜Ÿåˆ—"><a href="#äºŒã€Dispatch-Queue-æ´¾å‘é˜Ÿåˆ—" class="headerlink" title="äºŒã€Dispatch Queue æ´¾å‘é˜Ÿåˆ—"></a>äºŒã€<code>Dispatch Queue</code> æ´¾å‘é˜Ÿåˆ—</h4><h5 id="1-ä¸»é˜Ÿåˆ—"><a href="#1-ä¸»é˜Ÿåˆ—" class="headerlink" title="1.ä¸»é˜Ÿåˆ—"></a>1.ä¸»é˜Ÿåˆ—</h5><p>ä¸»é˜Ÿåˆ—ä»»åŠ¡åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œæ˜¯ä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–ï¼Œä»£ç (1-1)ï¼Œ</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">dispatch_queue_main_t m_queue = dispatch_get_main_queue();</span></pre></td></tr></table></figure>
<p>PSï¼šä¸»é˜Ÿåˆ—æ˜¯åœ¨è°ƒç”¨<code>main</code>å‡½æ•°ä¹‹å‰ç”±ç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºçš„ï¼Œå¹¶å°†å…¶ä¸ç¨‹åºçš„ä¸»çº¿ç¨‹ç›¸å…³è”ã€‚ç”±äºä¸»é˜Ÿåˆ—è¿è¡Œåœ¨åº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹ä¸Šï¼Œå› æ­¤é€šå¸¸ç”¨ä½œåº”ç”¨ç¨‹åºçš„å…³é”®åŒæ­¥ç‚¹ã€‚</p>
<h5 id="2-å…¨å±€å¹¶å‘é˜Ÿåˆ—"><a href="#2-å…¨å±€å¹¶å‘é˜Ÿåˆ—" class="headerlink" title="2.å…¨å±€å¹¶å‘é˜Ÿåˆ—"></a>2.å…¨å±€å¹¶å‘é˜Ÿåˆ—</h5><p>å…±äº«å½“å‰è¿›ç¨‹èµ„æºï¼Œæäº¤åˆ°æ­¤é˜Ÿåˆ—çš„ä»»åŠ¡æ˜¯æ— åºçš„å¹¶å‘æ‰§è¡Œã€‚è·å–æ–¹å¼ä»£ç (1-2)ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">dispatch_queue_global_t g_queue = dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>);</span></pre></td></tr></table></figure>

<p>ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ‰§è¡Œçš„ä¼˜å…ˆçº§ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æœ€é«˜ä¼˜å…ˆçº§</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="meta">#define DISPATCH_QUEUE_PRIORITY_HIGH 2</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸­ç­‰ä¼˜å…ˆçº§ï¼Œä¸ºé»˜è®¤ä¼˜å…ˆçº§</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="meta">#define DISPATCH_QUEUE_PRIORITY_DEFAULT 0</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//ä½ä¼˜å…ˆçº§</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="meta">#define DISPATCH_QUEUE_PRIORITY_LOW (-2)</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//åå°ä¼˜å…ˆçº§ï¼Œçº§åˆ«æœ€ä½</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="meta">#define DISPATCH_QUEUE_PRIORITY_BACKGROUND INT16_MIN</span></span></pre></td></tr></table></figure>

<p>ç°åœ¨ä¼˜å…ˆçº§å·²è¢«æœåŠ¡è´¨é‡QOS(quality of service)æ‰€å–ä»£ï¼ŒæœåŠ¡è´¨é‡å¯ç”¨äº<code>GCD</code>å’Œ<code>NSOperation</code>ï¼Œä¸”è‹¹æœå»ºè®®æœ€å¥½ç”¨Qosæ¥ä»£æ›¿å…¨å±€å¹¶å‘ä¼˜å…ˆçº§ã€‚æœåŠ¡è´¨é‡å¯¹åº”ä¼˜å…ˆçº§ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">*  - DISPATCH_QUEUE_PRIORITY_HIGH:         QOS_CLASS_USER_INITIATED</span></pre></td></tr><tr><td class="code"><pre><span class="line">*  - DISPATCH_QUEUE_PRIORITY_DEFAULT:      QOS_CLASS_DEFAULT</span></pre></td></tr><tr><td class="code"><pre><span class="line">*  - DISPATCH_QUEUE_PRIORITY_LOW:          QOS_CLASS_UTILITY</span></pre></td></tr><tr><td class="code"><pre><span class="line">*  - DISPATCH_QUEUE_PRIORITY_BACKGROUND:   QOS_CLASS_BACKGROUND</span></pre></td></tr></table></figure>

<p>PSï¼šè®¾ç½®ä¼˜å…ˆçº§å¹¶ä¸èƒ½ä¿è¯æ‰§è¡Œçš„å®æ—¶æ€§ï¼Œåªæ˜¯å¤§è‡´çš„åˆ¤æ–­ã€‚</p>
<p>ç¬¬äºŒä¸ªä¸ºç³»ç»Ÿä¿ç•™å‚æ•°ï¼Œå¯ä¼ å…¥<code>NULL</code>æˆ–0ã€‚</p>
<h5 id="3-è‡ªå®šä¹‰é˜Ÿåˆ—"><a href="#3-è‡ªå®šä¹‰é˜Ÿåˆ—" class="headerlink" title="3.è‡ªå®šä¹‰é˜Ÿåˆ—"></a>3.è‡ªå®šä¹‰é˜Ÿåˆ—</h5><p>è‡ªå®šä¹‰æ´¾å‘é˜Ÿåˆ—æœ‰ä¸¤ç§ï¼Œ<code>Serial Dispatch Queue</code>ä¸²è¡Œé˜Ÿåˆ—ï¼Œ<code>Concurrent Dispatch Queue</code>å¹¶å‘é˜Ÿåˆ—ã€‚ä¸²è¡Œé˜Ÿåˆ—éœ€è¦ä¸€ä¸ªæ‰§è¡Œç»“æŸï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚</p>
<p>å¹¶å‘é˜Ÿåˆ—åˆ™ä¸éœ€è¦ç­‰å¾…ï¼ŒæŒ‰FIFOå…¥é˜Ÿåæ— éœ€ç­‰å¾…å‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•åœ¨æ‰§è¡Œï¼Œè€Œæ˜¯å…¥é˜Ÿåä¾¿å¼€å§‹æ‰§è¡Œï¼Œå¹¶å‘é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å¯ä»¥åŒæ—¶è¿è¡Œã€‚æ— è®ºä¸²è¡Œè¿˜æœ‰å¹¶å‘é˜Ÿåˆ—ï¼Œéƒ½ä¸¥æ ¼æŒ‰ç…§FIFOé¡ºåºè¿›é˜Ÿå‡ºé˜Ÿã€‚</p>
<p>è‡ªå®šä¹‰é˜Ÿåˆ—çš„åˆ›å»ºæ–¹å¼ä»£ç (1-1)ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸²è¡Œé˜Ÿåˆ—</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> s_queue = dispatch_queue_create(<span class="string">"com.mwpush"</span>, DISPATCH_QUEUE_SERIAL);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//å¹¶å‘é˜Ÿåˆ—</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> c_queue = dispatch_queue_create(<span class="string">"com.mwpush.www"</span>, DISPATCH_QUEUE_CONCURRENT);</span></pre></td></tr></table></figure>
<p>ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºé˜Ÿåˆ—çš„åç§°ï¼Œä¸€èˆ¬å‘½åæ–¹å¼ä¸ºåŸŸåå€’å™ï¼Œä¹Ÿå¯ä»¥ä¸å‘½åï¼Œä¼ å…¥<code>NULL</code>ï¼Œä½†æ˜¯å‘½åå¯¹äºè°ƒå¼æŸ¥æ‰¾éå¸¸æœ‰å¸®åŠ©ã€‚</p>
<p>ç¬¬äºŒä¸ªå‚æ•°ä¸ºé˜Ÿåˆ—å±æ€§ï¼Œå³ä¸²è¡Œæˆ–å¹¶å‘ã€‚å½“ä¸ºä¸²è¡Œæ—¶ï¼Œå¯ç›´æ¥ä¼ å…¥<code>NULL</code>ï¼Œå¹¶å‘æ—¶åˆ™éœ€ä¼ å…¥<code>DISPATCH_QUEUE_CONCURRENT</code>ã€‚</p>
<h4 id="ä¸‰ã€æ´¾å‘ä»»åŠ¡åˆ°é˜Ÿåˆ—å¹¶æ‰§è¡Œ"><a href="#ä¸‰ã€æ´¾å‘ä»»åŠ¡åˆ°é˜Ÿåˆ—å¹¶æ‰§è¡Œ" class="headerlink" title="ä¸‰ã€æ´¾å‘ä»»åŠ¡åˆ°é˜Ÿåˆ—å¹¶æ‰§è¡Œ"></a>ä¸‰ã€æ´¾å‘ä»»åŠ¡åˆ°é˜Ÿåˆ—å¹¶æ‰§è¡Œ</h4><p>ä»»åŠ¡åˆ†ä¸ºä¸¤ç§ï¼Œ<code>dispatch_sync</code>åŒæ­¥æ´¾å‘ä¸<code>dispatch_async</code>å¼‚æ­¥æ´¾å‘ï¼Œè¿™ä¸¤ç§å‡æ˜¯é’ˆå¯¹æ‰€åœ¨çº¿ç¨‹è€Œè¨€ã€‚</p>
<p>åŒæ­¥æ´¾å‘(<code>dispatch_sync</code>)ï¼Œç›´åˆ°ä»»åŠ¡å®Œæˆåæ‰è¿”å›ï¼Œä¼šé˜»å¡å½“å‰çº¿ç¨‹ã€‚å½“åŒæ­¥æ´¾å‘åå¹¶ä¸æ„å‘³ç€ç«‹å³æ‰§è¡Œï¼Œæ‰§è¡Œæ—¶æœºç”±è°ƒåº¦é˜Ÿåˆ—é€‰æ‹©ã€‚ä½¿ç”¨åŒæ­¥æ´¾å‘æ—¶ï¼Œéœ€è°¨æ…ä½¿ç”¨ï¼Œåœ¨ä¸²è¡Œé˜Ÿåˆ—ä¸­æ´¾å‘åŒæ­¥ä»»åŠ¡å®¹æ˜“é€ æˆæ­»é”ã€‚</p>
<p>å¼‚æ­¥æ´¾å‘(<code>dispatch_async</code>)ï¼Œå‡½æ•°ä¼šç«‹å³è¿”å›ï¼Œå‡½æ•°ä»»åŠ¡å°†åœ¨åå°æ‰§è¡Œå¹¶åœ¨æœªæ¥æŸä¸ªæ—¶æœºå®Œæˆã€‚</p>
<h5 id="1-åŒæ­¥ä¸²è¡Œé˜Ÿåˆ—"><a href="#1-åŒæ­¥ä¸²è¡Œé˜Ÿåˆ—" class="headerlink" title="1.åŒæ­¥ä¸²è¡Œé˜Ÿåˆ—"></a>1.åŒæ­¥ä¸²è¡Œé˜Ÿåˆ—</h5><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> queue_t = dispatch_queue_create(<span class="string">"com.queue"</span>, <span class="number">0</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_sync</span>(queue_t, ^&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@"åŒæ­¥ä¸²è¡Œé˜Ÿåˆ—1:%@ æ‰€åœ¨çº¿ç¨‹:%@"</span>,queue_t, [<span class="built_in">NSThread</span> currentThread]);    </span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);      </span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_sync</span>(queue_t, ^&#123;   </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@"åŒæ­¥ä¸²è¡Œé˜Ÿåˆ—2:%@ æ‰€åœ¨çº¿ç¨‹:%@"</span>,queue_t, [<span class="built_in">NSThread</span> currentThread]);  </span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_sync</span>(queue_t, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@"åŒæ­¥ä¸²è¡Œé˜Ÿåˆ—3:%@ æ‰€åœ¨çº¿ç¨‹:%@"</span>,queue_t, [<span class="built_in">NSThread</span> currentThread]); </span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_sync</span>(queue_t, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@"åŒæ­¥ä¸²è¡Œé˜Ÿåˆ—4:%@ æ‰€åœ¨çº¿ç¨‹:%@"</span>,queue_t, [<span class="built_in">NSThread</span> currentThread]);    </span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr></table></figure>

<p>  è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">åŒæ­¥ä¸²è¡Œé˜Ÿåˆ—<span class="number">1</span>:&lt;OS_dispatch_queue_serial: com<span class="variable">.queue</span>&gt; æ‰€åœ¨çº¿ç¨‹:&lt;NSThread: <span class="number">0</span>x102a06ca0&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">åŒæ­¥ä¸²è¡Œé˜Ÿåˆ—<span class="number">2</span>:&lt;OS_dispatch_queue_serial: com<span class="variable">.queue</span>&gt; æ‰€åœ¨çº¿ç¨‹:&lt;NSThread: <span class="number">0</span>x102a06ca0&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">åŒæ­¥ä¸²è¡Œé˜Ÿåˆ—<span class="number">3</span>:&lt;OS_dispatch_queue_serial: com<span class="variable">.queue</span>&gt; æ‰€åœ¨çº¿ç¨‹:&lt;NSThread: <span class="number">0</span>x102a06ca0&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">åŒæ­¥ä¸²è¡Œé˜Ÿåˆ—<span class="number">4</span>:&lt;OS_dispatch_queue_serial: com<span class="variable">.queue</span>&gt; æ‰€åœ¨çº¿ç¨‹:&lt;NSThread: <span class="number">0</span>x102a06ca0&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span></pre></td></tr></table></figure>

<p>ä¸²è¡Œé˜Ÿåˆ—åŒæ­¥æ‰§è¡Œï¼Œå¹¶ä¸”æ²¡æœ‰å¼€è¾Ÿæ–°çš„çº¿ç¨‹ï¼Œéƒ½åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œä¸”é¡ºåºæ‰§è¡Œã€‚</p>
<h5 id="2-åŒæ­¥å¹¶å‘é˜Ÿåˆ—"><a href="#2-åŒæ­¥å¹¶å‘é˜Ÿåˆ—" class="headerlink" title="2.åŒæ­¥å¹¶å‘é˜Ÿåˆ—"></a>2.åŒæ­¥å¹¶å‘é˜Ÿåˆ—</h5><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> queue_t = dispatch_queue_create(<span class="string">"com.queue"</span>, DISPATCH_QUEUE_CONCURRENT);</span></pre></td></tr><tr><td class="code"><pre><span class="line"> </span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_sync</span>(queue_t, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@"åŒæ­¥å¹¶å‘é˜Ÿåˆ—1:%@ æ‰€åœ¨çº¿ç¨‹:%@"</span>,queue_t, [<span class="built_in">NSThread</span> currentThread]); </span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"> </span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_sync</span>(queue_t, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@"åŒæ­¥å¹¶å‘é˜Ÿåˆ—2:%@ æ‰€åœ¨çº¿ç¨‹:%@"</span>,queue_t, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_sync</span>(queue_t, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@"åŒæ­¥å¹¶å‘é˜Ÿåˆ—3:%@ æ‰€åœ¨çº¿ç¨‹:%@"</span>,queue_t, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_sync</span>(queue_t, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@"åŒæ­¥å¹¶å‘é˜Ÿåˆ—4:%@ æ‰€åœ¨çº¿ç¨‹:%@"</span>,queue_t, [<span class="built_in">NSThread</span> currentThread]);  </span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">åŒæ­¥å¹¶å‘é˜Ÿåˆ—<span class="number">1</span>:&lt;OS_dispatch_queue_concurrent: com<span class="variable">.queue</span>&gt; æ‰€åœ¨çº¿ç¨‹:&lt;NSThread: <span class="number">0</span>x1005036d0&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">åŒæ­¥å¹¶å‘é˜Ÿåˆ—<span class="number">2</span>:&lt;OS_dispatch_queue_concurrent: com<span class="variable">.queue</span>&gt; æ‰€åœ¨çº¿ç¨‹:&lt;NSThread: <span class="number">0</span>x1005036d0&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">åŒæ­¥å¹¶å‘é˜Ÿåˆ—<span class="number">3</span>:&lt;OS_dispatch_queue_concurrent: com<span class="variable">.queue</span>&gt; æ‰€åœ¨çº¿ç¨‹:&lt;NSThread: <span class="number">0</span>x1005036d0&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">åŒæ­¥å¹¶å‘é˜Ÿåˆ—<span class="number">4</span>:&lt;OS_dispatch_queue_concurrent: com<span class="variable">.queue</span>&gt; æ‰€åœ¨çº¿ç¨‹:&lt;NSThread: <span class="number">0</span>x1005036d0&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span></pre></td></tr></table></figure>

<p>å¹¶å‘é˜Ÿåˆ—åŒæ­¥æ‰§è¡Œï¼Œæ²¡æœ‰å¼€è¾Ÿæ–°çš„çº¿ç¨‹ï¼Œåœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œé¡ºåºè¾“å‡ºã€‚</p>
<h5 id="3-å¼‚æ­¥ä¸²è¡Œé˜Ÿåˆ—"><a href="#3-å¼‚æ­¥ä¸²è¡Œé˜Ÿåˆ—" class="headerlink" title="3.å¼‚æ­¥ä¸²è¡Œé˜Ÿåˆ—"></a>3.å¼‚æ­¥ä¸²è¡Œé˜Ÿåˆ—</h5><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> queue_t = dispatch_queue_create(<span class="string">"com.queue"</span>, <span class="number">0</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  </span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(queue_t, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@"å¼‚æ­¥ä¸²è¡Œé˜Ÿåˆ—1:%@ æ‰€åœ¨çº¿ç¨‹:%@"</span>,queue_t, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  </span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(queue_t, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@"å¼‚æ­¥ä¸²è¡Œé˜Ÿåˆ—2:%@ æ‰€åœ¨çº¿ç¨‹:%@"</span>,queue_t, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  </span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(queue_t, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@"å¼‚æ­¥ä¸²è¡Œé˜Ÿåˆ—3:%@ æ‰€åœ¨çº¿ç¨‹:%@"</span>,queue_t, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  </span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(queue_t, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@"å¼‚æ­¥ä¸²è¡Œé˜Ÿåˆ—4:%@ æ‰€åœ¨çº¿ç¨‹:%@"</span>,queue_t, [<span class="built_in">NSThread</span> currentThread]); </span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr></table></figure>

<p> è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">å¼‚æ­¥ä¸²è¡Œé˜Ÿåˆ—<span class="number">1</span>:&lt;OS_dispatch_queue_serial: com<span class="variable">.queue</span>&gt; æ‰€åœ¨çº¿ç¨‹:&lt;NSThread: <span class="number">0</span>x10292cff0&gt;&#123;number = <span class="number">2</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">å¼‚æ­¥ä¸²è¡Œé˜Ÿåˆ—<span class="number">2</span>:&lt;OS_dispatch_queue_serial: com<span class="variable">.queue</span>&gt; æ‰€åœ¨çº¿ç¨‹:&lt;NSThread: <span class="number">0</span>x10292cff0&gt;&#123;number = <span class="number">2</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">å¼‚æ­¥ä¸²è¡Œé˜Ÿåˆ—<span class="number">3</span>:&lt;OS_dispatch_queue_serial: com<span class="variable">.queue</span>&gt; æ‰€åœ¨çº¿ç¨‹:&lt;NSThread: <span class="number">0</span>x10292cff0&gt;&#123;number = <span class="number">2</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">å¼‚æ­¥ä¸²è¡Œé˜Ÿåˆ—<span class="number">4</span>:&lt;OS_dispatch_queue_serial: com<span class="variable">.queue</span>&gt; æ‰€åœ¨çº¿ç¨‹:&lt;NSThread: <span class="number">0</span>x10292cff0&gt;&#123;number = <span class="number">2</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr></table></figure>

<p>ä¸²è¡Œé˜Ÿåˆ—å¼‚æ­¥æ‰§è¡Œæ—¶ï¼Œå¼€è¾Ÿäº†æ–°çº¿ç¨‹(ä¸»çº¿ç¨‹é™¤å¤–)ï¼Œä½†æ˜¯æ³¨æ„ï¼šä¸²è¡Œé˜Ÿåˆ—åªä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªä»»åŠ¡åœ¨è¢«è°ƒç”¨æ‰§è¡Œï¼Œæ˜¯ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¸‹ä¸€ä¸ªä»»åŠ¡å‡ºé˜Ÿæ‰§è¡Œï¼Œä½†æ˜¯ä¸ä¸€å®šéƒ½åœ¨åŒä¸€æ¡çº¿ç¨‹æ‰§è¡Œï¼Œåªæ˜¯åŒä¸€æ—¶é—´å¯¹äºå½“å‰ä¸²è¡Œé˜Ÿåˆ—åªåˆ†é…äº†ä¸€æ¡çº¿ç¨‹ï¼Œä½†æ˜¯å…·ä½“æ˜¯å“ªæ¡çº¿ç¨‹ï¼Œç”±ç³»ç»Ÿæ§åˆ¶ã€‚æ‰€ä»¥è¿™é‡Œçš„çº¿ç¨‹è¾“å‡ºæ˜¯æœ‰ä¸ç¡®å®šæ€§çš„ï¼Œä¸ä¸€å®šæ¯æ¡éƒ½ä¸€æ ·ï¼Œæ¯”å¦‚ç¬¬ä¸€æ¬¡åˆ†é…çº¿ç¨‹2ï¼Œä¸‹æ¬¡å‡ºé˜Ÿæ‰§è¡Œæ—¶ï¼Œçº¿ç¨‹2è¢«å…¶ä»–ä»»åŠ¡å ç”¨ï¼Œæ­¤æ—¶å°±ä¼šåˆ†é…çº¿ç¨‹3æˆ–çº¿ç¨‹4ç­‰ç­‰ä¸å®šçš„çº¿ç¨‹ï¼</p>
<h5 id="4-å¼‚æ­¥å¹¶å‘é˜Ÿåˆ—"><a href="#4-å¼‚æ­¥å¹¶å‘é˜Ÿåˆ—" class="headerlink" title="4.å¼‚æ­¥å¹¶å‘é˜Ÿåˆ—"></a>4.å¼‚æ­¥å¹¶å‘é˜Ÿåˆ—</h5><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> queue_t = dispatch_queue_create(<span class="string">"com.queue"</span>, DISPATCH_QUEUE_CONCURRENT);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(queue_t, ^&#123;       </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@"å¼‚æ­¥å¹¶å‘é˜Ÿåˆ—1:%@ æ‰€åœ¨çº¿ç¨‹:%@"</span>,queue_t, [<span class="built_in">NSThread</span> currentThread]);  </span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(queue_t, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@"å¼‚æ­¥å¹¶å‘é˜Ÿåˆ—2:%@ æ‰€åœ¨çº¿ç¨‹:%@"</span>,queue_t, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">       </span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(queue_t, ^&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@"å¼‚æ­¥å¹¶å‘é˜Ÿåˆ—3:%@ æ‰€åœ¨çº¿ç¨‹:%@"</span>,queue_t, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(queue_t, ^&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@"å¼‚æ­¥å¹¶å‘é˜Ÿåˆ—4:%@ æ‰€åœ¨çº¿ç¨‹:%@"</span>,queue_t, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr></table></figure>

<p>   è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">å¼‚æ­¥å¹¶å‘é˜Ÿåˆ—<span class="number">3</span>:&lt;OS_dispatch_queue_concurrent: com<span class="variable">.queue</span>&gt; æ‰€åœ¨çº¿ç¨‹:&lt;NSThread: <span class="number">0</span>x100796f10&gt;&#123;number = <span class="number">4</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">å¼‚æ­¥å¹¶å‘é˜Ÿåˆ—<span class="number">2</span>:&lt;OS_dispatch_queue_concurrent: com<span class="variable">.queue</span>&gt; æ‰€åœ¨çº¿ç¨‹:&lt;NSThread: <span class="number">0</span>x102800410&gt;&#123;number = <span class="number">3</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">å¼‚æ­¥å¹¶å‘é˜Ÿåˆ—<span class="number">1</span>:&lt;OS_dispatch_queue_concurrent: com<span class="variable">.queue</span>&gt; æ‰€åœ¨çº¿ç¨‹:&lt;NSThread: <span class="number">0</span>x100520ad0&gt;&#123;number = <span class="number">2</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">å¼‚æ­¥å¹¶å‘é˜Ÿåˆ—<span class="number">4</span>:&lt;OS_dispatch_queue_concurrent: com<span class="variable">.queue</span>&gt; æ‰€åœ¨çº¿ç¨‹:&lt;NSThread: <span class="number">0</span>x1028001f0&gt;&#123;number = <span class="number">5</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr></table></figure>

<p>å¹¶å‘é˜Ÿåˆ—å¼‚æ­¥æ‰§è¡Œï¼Œå¼€è¾Ÿäº†å¤šæ¡çº¿ç¨‹ï¼Œä¸”ä»»åŠ¡åˆ†åˆ«åœ¨ä¸åŒçš„çº¿ç¨‹æ‰§è¡Œï¼Œé¡ºåºä¸å®šã€‚</p>
<h5 id="5-å¤–è¯"><a href="#5-å¤–è¯" class="headerlink" title="5.å¤–è¯"></a>5.å¤–è¯</h5><p><code>dispatch_sync</code>å®˜ç½‘æ–‡æ¡£æœ‰è¿™æ ·ä¸€æ®µè¯´æ˜ï¼š</p>
<blockquote>
<p>As a performance optimization, this function executes blocks on the current thread whenever possible, with one obvious exception. Specifically, blocks submitted to the main dispatch queue always run on the main thread.</p>
<p><em>ä½œä¸ºæ€§èƒ½ä¼˜åŒ–ï¼Œæ­¤åŠŸèƒ½åœ¨å¯èƒ½çš„æƒ…å†µä¸‹å°½å¯èƒ½åœ¨å½“å‰çº¿ç¨‹ä¸Šæ‰§è¡Œå—ï¼Œä¸€ä¸ªæ˜æ˜¾çš„ä¾‹å¤–ã€‚å…·ä½“æ¥è¯´ï¼Œæäº¤åˆ°ä¸»è°ƒåº¦é˜Ÿåˆ—çš„å—å§‹ç»ˆåœ¨ä¸»çº¿ç¨‹ä¸Šè¿è¡Œã€‚</em></p>
</blockquote>
<p>å…¶ä¸åŒæ•ˆæœä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æäº¤åˆ°éä¸»çº¿ç¨‹</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> serial_queue = dispatch_queue_create(<span class="string">"com.mwpush"</span>, <span class="number">0</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>), ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"æäº¤åˆ°éä¸»é˜Ÿåˆ—ä¹‹å‰-%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">dispatch_sync</span>(serial_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"æäº¤åˆ°éä¸»é˜Ÿåˆ—ä¹‹å-%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//æäº¤åˆ°ä¸»çº¿ç¨‹</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>), ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"æäº¤åˆ°ä¸»é˜Ÿåˆ—ä¹‹å‰-%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">dispatch_sync</span>(dispatch_get_main_queue(), ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"æäº¤åˆ°ä¸»é˜Ÿåˆ—ä¹‹å-%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">æäº¤åˆ°éä¸»é˜Ÿåˆ—ä¹‹å‰-&lt;NSThread: <span class="number">0</span>x600002942200&gt;&#123;number = <span class="number">3</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">æäº¤åˆ°éä¸»é˜Ÿåˆ—ä¹‹å-&lt;NSThread: <span class="number">0</span>x600002942200&gt;&#123;number = <span class="number">3</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">æäº¤åˆ°ä¸»é˜Ÿåˆ—ä¹‹å‰-&lt;NSThread: <span class="number">0</span>x600002973380&gt;&#123;number = <span class="number">5</span>, name = (<span class="literal">null</span>)&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">æäº¤åˆ°ä¸»é˜Ÿåˆ—ä¹‹å-&lt;NSThread: <span class="number">0</span>x600002925a80&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span></pre></td></tr></table></figure>

<p>ä¸ºäº†ä¾¿äºåšå¯¹æ¯”ï¼Œæˆ‘å°†è¾“å‡ºåçš„é¡ºåºè°ƒæ•´äº†ç²˜è´´å‡ºæ¥ï¼Œå¤§å®¶çš„è¾“å‡ºé¡ºåºåº”è¯¥æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<p>å¯ä»¥å¾ˆæ˜æ˜¾çš„åŒºåˆ«ï¼šæäº¤åˆ°éä¸»é˜Ÿåˆ—ä¹‹å‰å’Œä¹‹åæ‰€åœ¨çº¿ç¨‹ç›¸åŒï¼Œè€Œæäº¤åˆ°ä¸»é˜Ÿåˆ—åæ‰§è¡Œçš„çº¿ç¨‹ä¾¿æ˜¯ä¸»çº¿ç¨‹ã€‚</p>
<p>æ­¤å¤–è¿˜æœ‰ä¸»é˜Ÿåˆ—ä¸å…¨å±€é˜Ÿåˆ—ï¼Œä¸»é˜Ÿåˆ—å±äºä¸²è¡Œï¼Œå…¨å±€é˜Ÿåˆ—å±äºå¹¶å‘ã€‚ä¸»é˜Ÿåˆ—åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œæ‰€ä»¥é€šè¿‡<code>dispatch_async</code>å¼‚æ­¥æ·»åŠ åˆ°ä¸»é˜Ÿåˆ—çš„ä»»åŠ¡ä¸ä¼šå¼€å¯æ–°çš„çº¿ç¨‹ï¼Œåœ¨ä¸»é˜Ÿåˆ—(ä¸²è¡Œé˜Ÿåˆ—)é¡ºåºæ‰§è¡Œã€‚é€šè¿‡<code>dispatch_sync</code>åŒæ­¥æ·»åŠ åˆ°ä¸»é˜Ÿåˆ—çš„ä»»åŠ¡å®¹æ˜“é€ æˆæ­»é”(ä¸æ˜¯ä¸€å®š)ï¼Œä¸‹é¢ä¼šè®²åˆ°ã€‚  </p>
<p>æ€»ç»“ï¼š<code>dispatch_sync</code>ä¸ä¼šå¼€è¾Ÿæ–°çº¿ç¨‹ï¼Œ <code>dispatch_async</code>ä¼šå¼€è¾Ÿæ–°çº¿ç¨‹(æ·»åŠ ä¸»é˜Ÿåˆ—é™¤å¤–ï¼Œä¸»é˜Ÿåˆ—ä»»åŠ¡å§‹ç»ˆåœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ)ã€‚å¹¶å‘éœ€è¦å¤šçº¿ç¨‹çš„æ”¯æŒï¼Œèƒ½åˆ›å»ºå¤šçº¿ç¨‹çš„æƒ…å†µä¸‹æ‰èƒ½å‘æŒ¥å¹¶å‘çš„æ•ˆç”¨ã€‚æäº¤ç»™é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œé™¤äº†ä¸»é˜Ÿåˆ—åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œä¹‹å¤–ï¼Œç³»ç»Ÿæ— æ³•ä¿è¯å…¶ä»–é˜Ÿåˆ—åœ¨å“ªä¸ªçº¿ç¨‹æ‰§è¡Œã€‚   </p>
<p>åœ¨è®¾è®¡å¹¶å‘ä»»åŠ¡æ—¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¤šä¸ªä¸²è¡Œé˜Ÿåˆ—å¹¶è¡Œçš„æ–¹å¼å¤„ç†ï¼Œä½†æ˜¯ä¸å»ºè®®è¿™æ ·åšï¼Œå› ä¸ºè¿™æ ·åšä¼šå¼€è¾Ÿå¤šæ¡çº¿ç¨‹ï¼Œæ¯ä¸ªä¸²è¡Œé˜Ÿåˆ—éƒ½éœ€è¦ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ï¼Œä»¥æ­¤æ–¹å¼æ¥å®ç°å¹¶å‘çš„ç›®çš„ã€‚æ€»ä½“å»ºè®®å°±æ˜¯æ— è®ºå¹¶å‘è¿˜æ˜¯ä¸²è¡Œéƒ½å°½å¯èƒ½çš„å°‘é€šè¿‡ç”¨æˆ·ä¸»åŠ¨åˆ›å»ºçº¿ç¨‹ï¼Œå¦‚æœ‰éœ€è¦å¯æäº¤ä»»åŠ¡åˆ°å…¨å±€å¹¶å‘é˜Ÿåˆ—å®ç°ç›®çš„ã€‚ä½¿ç”¨é˜Ÿåˆ—å¤„ç†å¤šä»»åŠ¡ï¼Œç³»ç»Ÿä¼šæ ¹æ®çº¿ç¨‹çš„æ‰§è¡Œæƒ…å†µåˆ†é…çº¿ç¨‹æ‰§è¡Œï¼Œå¹¶éä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªä»»åŠ¡ï¼Œä¸€ä¸ªä»»åŠ¡å¤„ç†å®Œæˆï¼Œå¯ä»¥ç»§ç»­å¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œç³»ç»Ÿä¼šåœ¨æ­¤åšä¼˜åŒ–ä½¿ç”¨å°½å¯èƒ½å°‘çš„çº¿ç¨‹æ‰§è¡Œæ›´å¤šçš„ä»»åŠ¡ã€‚å› ä¸ºçº¿ç¨‹çš„å¼€é”€ç›¸æ¯”é˜Ÿåˆ—å¤§çš„å¤šï¼Œæ‰€ä»¥å°½é‡å¤šä½¿ç”¨å¤šåˆ—å¤„ç†ä»»åŠ¡ï¼Œç”±ç³»ç»Ÿåˆ†é…çº¿ç¨‹å¤„ç†ã€‚</p>
<p> åœ¨ä½¿ç”¨æ—¶åº”æ³¨æ„æ­»é”é—®é¢˜ã€‚</p>
<p>å…³äºé˜Ÿåˆ—ç›¸å…³çš„è¯´æ˜åœ¨å¦ä¸€ç¯‡æ–‡ç« æœ‰ä»‹ç»ï¼Œé€šè¿‡ä¸‹é¢é“¾æ¥æŸ¥çœ‹ï¼š  </p>
<p><a href="http://www.mwpush.com/content/edab7fec.html">å…³äºä¸²è¡Œã€å¹¶å‘ã€å¹¶è¡Œç­‰çš„è¯´æ˜</a></p>
<h4 id="ä¸‰ã€æ­»é”-deadlock"><a href="#ä¸‰ã€æ­»é”-deadlock" class="headerlink" title="ä¸‰ã€æ­»é” (deadlock)"></a>ä¸‰ã€æ­»é” (deadlock)</h4><p>å…³äº<code>GCD</code>ä¸­çš„æ­»é”ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šè¯´æ˜ï¼Œä¹Ÿçœ‹äº†å¾ˆå¤šï¼Œä½†æ˜¯éƒ½æ˜¯çœ‹ä¼¼è®²çš„å¾ˆæœ‰é“ç†å´éš¾ä»¥è®©äººæ˜ç™½ï¼Œæˆ–è€…æœ‰äº›æ ¹æœ¬å°±æ˜¯è®²çš„ä¸å¯¹ï¼Œæ€»ä¼šæ‰¯åˆ°ä¸€äº›æ— æ‰€è°“çš„æ¡ä»¶ä¸Šã€‚å½“ç„¶ï¼Œæœ¬äººä¹Ÿæ˜¯è²Œä¼¼æ‡‚äº†ï¼Œæ‰€ä»¥è¯´ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼Œä»ä¸€æ®µæœ€åŸºæœ¬çš„ä»£ç å¼€å§‹ï¼Œå¦‚ä¸‹ï¼š</p>
   <figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">       </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡1"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">dispatch_sync</span>(dispatch_get_main_queue(), ^&#123;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡2"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  &#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡3"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  </span></pre></td></tr><tr><td class="code"><pre><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;  </span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
   <figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">deadlock[<span class="number">71971</span>:<span class="number">7964750</span>] ä»»åŠ¡<span class="number">1</span></span></pre></td></tr></table></figure>

<p>é™„ä¸Šå‡ å¼ å¼ é”™è¯¯çš„æˆªå›¾ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="/content/d771b58d/20191218_01.png" alt="20191218_01"></p>
<p>   <img src="/content/d771b58d/20191218_02.png" alt="11"></p>
<p>ç½‘ä¸Šå¾ˆå¤§ä¸€éƒ¨åˆ†æ–‡ç« åœ¨è®²åˆ°è¿™æ®µä»£ç çš„æ—¶å€™æ€»ä¼šæŠŠè¿™é‡Œçš„ä»»åŠ¡3ï¼Œä¹Ÿå°±æ˜¯<code>NSLog(@&quot;ä»»åŠ¡3&quot;);</code>ï¼Œè¿™éƒ¨åˆ†ä¹Ÿæ‰¯è¿›å»ï¼Œä½†æ˜¯è¿™æ®µä»£ç çš„é”™è¯¯åŸå› ä¸<code>NSLog(@&quot;ä»»åŠ¡3&quot;);</code>æœ‰ä¸æ²¡æœ‰æ ¹æœ¬æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œåˆ é™¤<code>NSLog(@&quot;ä»»åŠ¡3&quot;);</code>ä¹Ÿæ˜¯åŒæ ·çš„é”™è¯¯ã€‚</p>
<p>è¿™æ®µä»£ç åªèƒ½æ‰§è¡Œåˆ°ä»»åŠ¡1ï¼Œæˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹å›¾2ä¸­çš„ç¬¬ä¸€æ®µçº¢è‰²å­—ä½“éƒ¨åˆ†ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
   <figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line"><span class="string">"BUG IN CLIENT OF LIBDISPATCH: dispatch_sync called on queue already owned by current thread"</span></span></pre></td></tr></table></figure>

<p>ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼šåœ¨å½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰çš„é˜Ÿåˆ—ä¸Šè°ƒç”¨<code>dispatch_sync</code>ã€‚   </p>
<p>é‚£ä¹ˆå½“å‰çº¿ç¨‹æ˜¯å“ªä¸ªçº¿ç¨‹å‘¢ï¼Ÿæˆ‘ä»¬ä»å›¾2çš„è°ƒç”¨æ ˆå¯ä»¥çœ‹åˆ°æ˜¯<code>Thread 1</code>ï¼Œä¹Ÿå°±æ˜¯ä¸»çº¿ç¨‹ï¼Œé˜Ÿåˆ—å°±æ˜¯ä¸»é˜Ÿåˆ—ï¼Œè€Œä¸»é˜Ÿåˆ—è¿˜æ˜¯ä¸ª<code>Serial</code>ä¸²è¡Œé˜Ÿåˆ—ã€‚   </p>
<p>é‚£ä¹ˆå°±æ¥çœ‹ä¸€ä¸‹<code>dispatch_sync</code>çš„å®˜æ–¹è¯´æ˜ï¼Œå¦‚ä¸‹ï¼š</p>
<blockquote>
<p>Submits a block object for execution and returns after that block finishes executing</p>
<p>//æäº¤blockåˆ°é˜Ÿåˆ—ï¼Œå¹¶ç­‰ç€blockæ‰§è¡Œå®Œæ¯•è¿”å›ã€‚</p>
<p>Submits a block to the specified dispatch queue for synchronous execution. Unlike <code>dispatch_async</code>, this function does not return until the block has finished. Calling this function and targeting the current queue results in deadlock.</p>
<p>è¿™å¥ä¸»è¦çš„æ˜¯æœ€åä¸€å¥ï¼šè°ƒç”¨æ­¤æ–¹æ³•æäº¤å—åˆ°å½“å‰é˜Ÿåˆ—å°†é€ æˆæ­»é”ï¼å°±æ˜¯è¯´ï¼Œå¦‚æœæäº¤blockçš„ç›®æ ‡é˜Ÿåˆ—ä¸å½“å‰æ‰€åœ¨çš„é˜Ÿåˆ—æ˜¯åŒä¸€é˜Ÿåˆ—ï¼Œå°†é€ æˆæ­»é”ã€‚</p>
</blockquote>
<p> é‚£ä¹ˆæ¥åˆ†æä¸‹æˆ‘ä»¬çš„ä»£ç é€ æˆæ­»é”çš„åŸå› ï¼š</p>
<p>é¦–å…ˆä¸»é˜Ÿåˆ—æ˜¯åœ¨<code>main</code>æ–¹æ³•æ‰§è¡Œä¹‹å‰å°±å·²ç»ç”±ç³»ç»Ÿåˆ›å»ºå¥½äº†ï¼Œ<code>main</code>å‡½æ•°æœ¬èº«å°±åœ¨ä¸»é˜Ÿåˆ—ä¸­ï¼Œçº¿ç¨‹é¦–å…ˆè°ƒç”¨é˜Ÿåˆ—ä¸­çš„<code>main</code>æ–¹æ³•å¼€å§‹æ‰§è¡Œï¼Œå½“æ‰§è¡Œ<code>dispatch_sync</code>æ–¹æ³•æ—¶ï¼Œå°†è¦æ‰§è¡Œçš„ä»»åŠ¡2(<code>NSLog(@&quot;æ‰§è¡Œ2&quot;);</code>æ‰€åœ¨çš„<code>block</code>å—)ï¼Œæ·»åŠ åˆ°è·å–çš„å½“å‰é˜Ÿåˆ—çš„æœ«å°¾ï¼Œä¹Ÿå°±æ˜¯<code>main</code>çš„åé¢ï¼Œå¹¶ç­‰å¾…<code>block</code>æ‰§è¡Œå®Œæ¯•è¿”å›ã€‚ä½†æ˜¯ä¸²è¡Œé˜Ÿåˆ—çš„ç‰¹æ€§æ˜¯å…ˆè¿›å…ˆå‡º(FIFO)ï¼Œä¸”å‰ä¸€ä¸ªæ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹å‰ï¼Œåé¢æ–¹æ³•ä¸èƒ½æ‰§è¡Œï¼Œéœ€è¦ç­‰å¾…æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯åœ¨<code>block</code>ä¹‹å‰çš„<code>main</code>æ–¹æ³•è¿˜æ²¡æœ‰è¿˜è¡Œå®Œæ¯•ï¼Œå°±ä¸èƒ½æ‰§è¡Œ<code>block</code>ï¼Œè€Œ<code>block</code>åˆæ˜¯é€šè¿‡åŒæ­¥æ–¹æ³•æ·»åŠ æ‰§è¡Œçš„ï¼Œæ·»åŠ åå°±éœ€è¦ç­‰å¾…æ‰§è¡Œï¼Œè€Œä¸”è¿˜å¾—æ‰§è¡Œå®Œæ¯•æ‰èƒ½è¿”å›ã€‚è¿™æ ·é€ æˆäº†<code>main</code>æƒ³æ‰§è¡Œï¼Œä½†æ˜¯éœ€è¦ç­‰å¾…<code>block</code>æ‰§è¡Œå®Œæ¯•ï¼Œè€Œ<code>block</code>è¦æ‰§è¡Œï¼Œä½†æ˜¯<code>main</code>æ–¹æ³•è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œæ‰€ä»¥ä¸èƒ½æ‰§è¡Œï¼Œäº’ç›¸ç‰µåˆ¶ï¼Œé€ æˆæ­»é”ã€‚</p>
<p>ç”¨é€šä¿—ç‚¹çš„è¯æ¥è¯´å°±æ˜¯ï¼š<strong>ä¸²è¡Œé˜Ÿåˆ—</strong>ä¸­çš„ä»»åŠ¡1åœ¨æ‰§è¡Œï¼Œä»»åŠ¡1è¦æ‰§è¡Œçš„ä»£ç å°±æ˜¯å°†ä»»åŠ¡2æ·»åŠ åˆ°ä»»åŠ¡1æ‰€åœ¨çš„é˜Ÿåˆ—ä¸­<strong>åŒæ­¥æ‰§è¡Œ</strong>ï¼Œå› ä¸ºæ˜¯åŒæ­¥æ·»åŠ ï¼Œå°±éœ€è¦ç­‰å¾…ä»»åŠ¡2æ‰§è¡Œå¹¶æ‰§è¡Œå®Œæ¯•è¿”å›ç»“æœï¼Œä»»åŠ¡1æ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚ä½†æ˜¯æ­¤æ—¶é˜Ÿåˆ—ä¸­ä»»åŠ¡1æ’åœ¨ä»»åŠ¡2çš„å‰é¢ï¼Œéœ€è¦å…ˆæ‰§è¡Œå®Œæ¯•æ‰èƒ½æ‰§è¡Œä»»åŠ¡2ï¼Œè€Œä»»åŠ¡2åˆè¦ä»»åŠ¡1ç­‰å¾…ï¼Œæ‰€ä»¥å½¼æ­¤ç‰µåˆ¶ï¼Œéƒ½ä¸èƒ½æ‰§è¡Œï¼Œé€ æˆæ­»é”ã€‚</p>
<p>ä»¥ä¸Šæ˜¯æ·»åŠ åˆ°ç³»ç»Ÿçš„ä¸»é˜Ÿåˆ—ä¸­é€ æˆçš„æ­»é”ï¼Œä¸‹é¢åœ¨æ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºçš„é˜Ÿåˆ—çš„æ­»é”ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">dispatch_queue_t</span> serial_queue = dispatch_queue_create(<span class="string">"com.mwpush"</span>, <span class="number">0</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡1"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">dispatch_sync</span>(serial_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡2"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">dispatch_sync</span>(serial_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡3"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        &#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡4"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡5"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">deadlock[<span class="number">72943</span>:<span class="number">8153590</span>] ä»»åŠ¡<span class="number">1</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">deadlock[<span class="number">72943</span>:<span class="number">8153590</span>] ä»»åŠ¡<span class="number">2</span></span></pre></td></tr></table></figure>

<p>åŒæ ·æ˜¯ä¸²è¡Œé˜Ÿåˆ—ï¼Œä¸ºä½•ç¬¬ä¸€ä¸ª<code>dispatch_sync</code>æ²¡æœ‰é€ æˆæ­»é”ï¼Œè€Œç¬¬äºŒä¸ªå°±é€ æˆäº†å‘¢ï¼Ÿå…¶å®å°±æ˜¯æ–‡æ¡£ä¸­è¯´çš„ï¼š<em>å¦‚æœæäº¤blockçš„ç›®æ ‡é˜Ÿåˆ—ä¸å½“å‰æ‰€åœ¨çš„é˜Ÿåˆ—æ˜¯åŒä¸€é˜Ÿåˆ—ï¼Œå°†é€ æˆæ­»é”</em>ã€‚å› ä¸ºå½“æ‰§è¡Œç¬¬ä¸€ä¸ª<code>dispatch_sync</code>æ—¶ï¼Œå°†ä»»åŠ¡2æ·»åŠ åˆ°æˆ‘ä»¬åˆ›å»ºçš„<code>serial_queue</code>é˜Ÿåˆ—ä¸­ï¼Œè€Œæ­¤æ—¶æ‰€åœ¨çš„é˜Ÿåˆ—æ˜¯ç³»ç»Ÿçš„ä¸»é˜Ÿåˆ—ï¼Œæ·»åŠ åˆ°çš„é˜Ÿåˆ—ä¸å½“å‰æ‰€åœ¨çš„é˜Ÿåˆ—ä¸æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ã€‚è€Œå½“ç¬¬äºŒä¸ª<code>dispatch_sync</code>æ‰§è¡Œæ—¶ï¼Œæ‰€åœ¨çš„é˜Ÿåˆ—å°±æ˜¯æˆ‘ä»¬åˆ›å»ºçš„<code>serial_queue</code>é˜Ÿåˆ—ï¼Œç›®æ ‡é˜Ÿåˆ—ä¸å½“å‰æ‰€åœ¨é˜Ÿåˆ—ä¸ºåŒä¸€é˜Ÿåˆ—ï¼Œé€ æˆæ­»é”çš„è¿‡ç¨‹ä¸Šé¢å·²ç»è®²è§£äº†ã€‚å„ä½å¯ä»¥å°è¯•å°†ç¬¬ä¸€ä¸ª<code>dispatch_sync</code>æ¢æˆ<code>dispatch_async</code>ç­‰ï¼Œè‡ªå·±è¯•è¯•ç»“æœï¼Œè¿™é‡Œå°±ä¸åœ¨å¤šè¯´ã€‚</p>
<h4 id="å››ã€è°ƒåº¦ç»„-Dispatch-Group"><a href="#å››ã€è°ƒåº¦ç»„-Dispatch-Group" class="headerlink" title="å››ã€è°ƒåº¦ç»„(Dispatch Group)"></a>å››ã€è°ƒåº¦ç»„(Dispatch Group)</h4><p>å½“é˜Ÿåˆ—ä¸­æœ‰å¤šä¸ªä»»åŠ¡éœ€è¦å¤„ç†ï¼Œä¸”éœ€è¦æ ¹æ®è¿™äº›ä»»åŠ¡çš„å¤„ç†ç»“æœæ‰§è¡ŒæŸäº›æ“ä½œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©è°ƒåº¦ç»„(<code>Dispatch Group</code>)æ¥æ“ä½œï¼Œå½“ç„¶ä¹Ÿæœ‰å…¶ä»–çš„å®ç°æ–¹å¼ï¼Œä½†æ˜¯ç›¸å¯¹æ¥è¯´ï¼Œä½¿ç”¨è°ƒåº¦ç»„å®ç°ä»£ç æ•´æ´ä¸”é€»è¾‘æ¸…æ™°ã€‚å½“ç„¶ä½¿ç”¨ä¸²è¡Œé˜Ÿåˆ—ä¹Ÿèƒ½è¾¾åˆ°ç›®çš„ï¼Œä½†æ˜¯å¦‚æœå¤§éƒ¨åˆ†ä»»åŠ¡ä¹‹é—´æ²¡æœ‰ä¾èµ–å…³ç³»ï¼Œåˆ™æœ€å¥½é€‰æ‹©å¹¶å‘å¤„ç†ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> g_queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_t group = dispatch_group_create();</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_async(group, g_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡1"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_async(group, g_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡2"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_async(group, g_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡3"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_async(group, g_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡4"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_notify(group, g_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"å…¨éƒ¨ä»»åŠ¡æ‰§è¡Œå®Œæ¯•"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">3</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">4</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">2</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">å…¨éƒ¨ä»»åŠ¡æ‰§è¡Œå®Œæ¯•</span></pre></td></tr></table></figure>

<p>å°†ä»»åŠ¡æäº¤åˆ°å…¨å±€å¹¶å‘é˜Ÿåˆ—å¹¶å¼‚æ­¥æ‰§è¡Œï¼Œä»»åŠ¡1ï¼Œ2ï¼Œ3ï¼Œ4çš„è¾“å‡ºé¡ºåºä¸å®šï¼Œä½†æ˜¯æœ€åçš„â€œå…¨éƒ¨ä»»åŠ¡æ‰§è¡Œå®Œæ¯•â€ä¸€å®šæœ€åè¾“å‡ºï¼Œä¹Ÿå°±æ˜¯ç­‰åˆ°æ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆåæ‰§è¡Œã€‚æˆ‘ä»¬å¯ä»¥è¿½åŠ æ•°æ®åˆ†å—ä¸‹è½½ã€å¤„ç†ç­‰åˆ°è°ƒåº¦ç»„ï¼Œæœ€ååœ¨<code>dispatch_group_notify</code>ä¸­å°†æ‰§è¡Œå®Œæ¯•çš„æ‰€æœ‰æ•°æ®è¿›è¡Œç»Ÿä¸€å¤„ç†ã€‚ä¹Ÿå¯ä»¥ç­‰æ•°æ®å¤„ç†å®Œæˆåˆ°ä¸»çº¿ç¨‹æ›´æ–°UIæ“ä½œï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦å°†<code>dispatch_group_notify</code>ä¸­çš„é˜Ÿåˆ—è®¾ç½®ä¸º<code>dispatch_get_main_queue()</code>å³å¯ã€‚</p>
<p><code>dispatch_group_wait</code>ç­‰å¾…æ–¹æ³•ï¼Œçœ‹ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> g_queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_t group = dispatch_group_create();</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_async(group, g_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡1"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_async(group, g_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡2"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_async(group, g_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡3"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_async(group, g_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡4"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">5</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_wait(group, DISPATCH_TIME_FOREVER);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"å…¶ä»–æ“ä½œ"</span>);</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">3</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">2</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">4</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">å…¶ä»–æ“ä½œ <span class="comment">//æ­¤å¤„ä¸º5ç§’åè¾“å‡ºçš„</span></span></pre></td></tr></table></figure>

<p>ä¸ä¸Šé¢ä»£ç ä¸åŒä¹‹å¤„ä»…åœ¨äºä¸€ä¸ªä½¿ç”¨äº†<code>dispatch_group_notify</code>ï¼Œä¸€ä¸ªä½¿ç”¨äº†<code>dispatch_group_wait</code>ã€‚</p>
<p><code>dispatch_group_wait</code>æ˜¯ä¸€ä¸ªåŒæ­¥å‡½æ•°ï¼ŒåŒæ­¥æ„å‘³ç€ç­‰å¾…ï¼Œé˜»å¡ï¼Œä»åå­—ä¸­å°±å¯ä»¥çœ‹å¾—å‡ºæ¥ã€‚å®ƒçš„ä½œç”¨æ˜¯ç­‰å¾…ï¼Œç›´åˆ°ä¸ä¹‹å…³è”çš„ç»„ä¸­çš„é˜Ÿåˆ—ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œæ¯•æˆ–è¶…è¿‡äº†æŒ‡å®šçš„è¶…æ—¶æ—¶é—´ç»§ç»­æ‰§è¡Œã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨â€œä»»åŠ¡4â€ä¸­è®¾ç½®äº†ç¡çœ 5ç§’é’Ÿï¼Œæœ€åçš„â€œå…¶ä»–æ“ä½œâ€æ˜¯è¿‡äº†5ç§’é’Ÿåæ‰æ‰§è¡Œè¾“å‡ºçš„ã€‚</p>
<p><code>dispatch_group_wait</code>ç¬¬äºŒä¸ªå‚æ•°æ˜¯è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œæ˜¯<code>dispatch_time_t</code>ç±»å‹ï¼Œå½“è®¾ç½®ä¸º<code>DISPATCH_TIME_FOREVER</code>æ—¶ï¼Œæ„å‘³ç€æ°¸ä¹…ç­‰å¾…ï¼Œå°±æ˜¯ç­‰æ‰€æœ‰ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•æ‰ç»§ç»­æ‰§è¡Œã€‚æ­¤æ—¶ï¼Œä¸<code>dispatch_group_notify</code>ç›¸åŒä¹‹å¤„æ˜¯éƒ½ä¼šç­‰åˆ°ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œæ¯•åšå…¶ä»–æ“ä½œï¼Œä¸åŒä¹‹å¤„åœ¨äº<code>dispatch_group_wait</code>ä¼šé˜»å¡æ‰€åœ¨çº¿ç¨‹ï¼Œ<code>dispatch_group_notify</code>ä¸é˜»å¡çº¿ç¨‹ã€‚æ‰€ä»¥åœ¨ä¸»çº¿ç¨‹ä¸­æ…ç”¨<code>dispatch_group_wait</code>æ–¹æ³•ã€‚</p>
<p><code>dispatch_group_wait</code>æ˜¯æœ‰è¿”å›å€¼çš„ï¼Œå…¶è¿”å›å€¼ç±»å‹ä¸º<code>long</code>ï¼Œå½“æ‰€æœ‰ä»»åŠ¡åœ¨è®¾ç½®çš„è¶…æ—¶æ—¶é—´å†…å…¨éƒ¨å®Œæˆï¼Œè¿”å›å€¼ä¸º0ï¼Œå¦åˆ™éé›¶(è¶…æ—¶)ï¼Œä¹Ÿå°±æ˜¯è¯´é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡è‡³å°‘è¿˜æœ‰ä¸€ä¸ªæœªå®Œæˆï¼Œä¹Ÿè®¸æœ‰å¤šä¸ªã€‚ç­‰å¾…æ—¶é—´è®¾ç½®ä¸º<code>DISPATCH_TIME_FOREVER</code>åˆ™è¿”å›å€¼æ’ä¸º0ï¼Œå› ä¸ºæ°¸ä¸è¶…æ—¶ï¼Œä¹Ÿå°±æ˜¯ä»»åŠ¡æ€»ä¼šå‰éƒ¨æ‰§è¡Œå®Œæ¯•ã€‚è¿˜æœ‰ä¸€ä¸ªä¸ºæˆ‘ä»¬å‡†å¤‡å¥½çš„å¸¸é‡<code>DISPATCH_TIME_NOW</code>ï¼Œå°†<code>dispatch_group_wait</code>æ—¶é—´å‚æ•°è®¾ç½®ä¸º<code>DISPATCH_TIME_NOW</code>æ—¶ï¼Œåˆ™æ„å‘³ç€ä¸ç­‰å¾…ï¼Œæ­¤æ—¶ä¸é˜»å¡çº¿ç¨‹ã€‚é™¤äº†ä½¿ç”¨ä»¥ä¸Šä¸¤ç§ç³»ç»Ÿä¸ºæˆ‘ä»¬å‡†å¤‡å¥½çš„æ—¶é—´å¸¸é‡ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ—¶é—´ï¼Œæ—¶é—´ç±»å‹ä¸º<code>dispatch_time_t</code>ï¼Œå…³äº<code>dispatch_time_t</code>ç±»å‹çš„è¯´æ˜è¯·å…³æ³¨ä¸‹ä¸€ç¯‡<code>GCD</code>æ–‡ç« ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å°†<code>dispatch_group_wait</code>å’Œ<code>dispatch_group_notify</code>ç»„åˆä½¿ç”¨ï¼Œä½¿ç”¨<code>dispatch_group_wait</code>æ—¶ï¼Œåº”æ”¾åœ¨éä¸»çº¿ç¨‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> g_queue = dispatch_get_global_queue(DISPAT</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_t group = dispatch_group_create();</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_async(group, g_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡1"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_async(group, g_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡2"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_async(group, g_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡3"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_async(group, g_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡4"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_wait(group, DISPATCH_TIME_FOREVER);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡5"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_notify(group, g_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"æœ€åæ‰§è¡Œæ•´ç†ä»»åŠ¡"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">2</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">3</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">4</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">5</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">æœ€åæ‰§è¡Œæ•´ç†ä»»åŠ¡</span></pre></td></tr></table></figure>

<p>ä»¥ä¸Šæ˜¯é€šè¿‡<code>dispatch_group_async</code>æ–¹æ³•æäº¤ä»»åŠ¡åˆ°é˜Ÿåˆ—å…¥ç»„åè‡ªåŠ¨æ‰§è¡Œå¹¶å®Œæˆçš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ‰‹åŠ¨å…¥ç»„æ‰§è¡Œï¼Œé€šè¿‡ä½¿ç”¨<code>dispatch_group_enter</code>å’Œ<code>dispatch_group_leave</code>æ–¹æ³•ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå°±æ˜¯è¦åŠ å…¥çš„ç»„ã€‚ä¸¤ä¸ªæ–¹æ³•æ˜¯ä¸€å¯¹å„¿çš„å…³ç³»ï¼Œç¼ºä¸€ä¸å¯ï¼Œæœ‰å…¥å°±å¾—æœ‰å‡ºï¼Œç±»ä¼¼äºå¼•ç”¨è®¡æ•°ï¼Œå…¥ç»„å°±æ˜¯åŠ ä¸€ï¼Œå‡ºç»„å°±æ˜¯å‡ä¸€ã€‚å¦‚æœæ•°é‡ä¸å¯¹åº”ï¼Œå…¥æ¯”å‡ºå¤šï¼Œåˆ™ä»»åŠ¡<code>dispatch_group_notify</code>å’Œ<code>dispatch_group_wait</code>æ°¸è¿œä¸ä¼šæ‰§è¡Œã€‚å¦‚æœå‡ºæ¯”å…¥å¤šï¼Œåˆ™ä¼šæŠ¥<code>Unbalanced call to dispatch_group_leave()</code>é”™è¯¯ï¼Œå…·ä½“çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> g_queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_t group = dispatch_group_create();</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_enter(group);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡1"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_leave(group);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_enter(group);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡2"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_leave(group);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_enter(group);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡2"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_leave(group);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_enter(group);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"ä»»åŠ¡4"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_leave(group);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_notify(group, g_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"æœ€åæ‰§è¡Œæ•´ç†ä»»åŠ¡"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr></table></figure>

<p>ä»¥ä¸Šæ˜¯æ­£ç¡®çš„å†™æ³•ï¼Œä¸€ä¸€å¯¹ä¸€ä¸ªï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">2</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">2</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">4</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">æœ€åæ‰§è¡Œæ•´ç†ä»»åŠ¡</span></pre></td></tr></table></figure>

<p>é€šè¿‡<code>dispatch_group_enter</code>å’Œ<code>dispatch_group_leave</code>æ‰‹åŠ¨è¿›ç»„å‡ºç»„çš„ä»»åŠ¡ï¼Œå°±æ˜¯æ­£å¸¸çš„å‡½æ•°æ–¹æ³•ï¼Œéœ€è¦æ ¹æ®éœ€è¦è‡ªå·±æ‰§è¡ŒåŒæ­¥æˆ–å¼‚æ­¥æ–¹æ³•ï¼Œä¸Šé¢çš„ä»£ç ä¸ºåŒæ­¥æ–¹æ³•ï¼Œæ‰€ä»¥è¾“å‡ºç»“æœä¸ºé¡ºåºè¾“å‡ºã€‚å½“æˆ‘ä»¬æ‰§è¡Œå¼‚æ­¥æ–¹æ³•æ—¶ï¼Œ<code>dispatch_group_leave</code>è¦æ”¾åœ¨å¼‚æ­¥å‡½æ•°å†…çš„æ–¹æ³•æ‰§è¡Œå®Œæ¯•å¤„ï¼å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">dispatch_group_enter(group);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(g_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">3</span>];  <span class="comment">//æ¨¡æ‹Ÿè€—æ—¶</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"å¼‚æ­¥ä»»åŠ¡"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    dispatch_group_leave(group);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr></table></figure>

<p>è¿™æ ·æ‰èƒ½ä¿è¯ä»»åŠ¡å…¨éƒ¨ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åœ¨æ‰§è¡Œ<code>dispatch_group_notify</code>æ–¹æ³•ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">2</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">2</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">4</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">å¼‚æ­¥ä»»åŠ¡</span></pre></td></tr><tr><td class="code"><pre><span class="line">æœ€åæ‰§è¡Œæ•´ç†ä»»åŠ¡</span></pre></td></tr></table></figure>

<p>å¦‚æœæ”¾åœ¨å¤–é¢ï¼Œå¦‚ä¸‹ä»£ç ï¼Œåˆ™ä¸èƒ½ä¿è¯æ‰€æœ‰ä»»åŠ¡éƒ½å¤„ç†å®Œæ¯•åæ‰§è¡Œ<code>dispatch_group_notify</code>ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">//é”™è¯¯æ¼”ç¤º</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_enter(group);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(g_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">3</span>];  <span class="comment">//æ¨¡æ‹Ÿè€—æ—¶</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"å¼‚æ­¥ä»»åŠ¡"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_leave(group);</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">2</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">2</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">4</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">æœ€åæ‰§è¡Œæ•´ç†ä»»åŠ¡</span></pre></td></tr><tr><td class="code"><pre><span class="line">å¼‚æ­¥ä»»åŠ¡</span></pre></td></tr></table></figure>

<p>PSï¼š<code>dispatch_group_enter</code>ã€<code>dispatch_group_leave</code>ã€<code>dispatch_group_notify</code>ã€<code>dispatch_group_wait</code>ä¸€èµ·ä½¿ç”¨çš„æ–¹å¼è·Ÿä¸Šé¢çš„æ“ä½œä¸€æ ·ï¼Œä¸åœ¨èµ˜è¿°ã€‚</p>
<p>ä»¥ä¸Šä»£ç éƒ½æ˜¯åœ¨åŒä¸€å¹¶å‘å¤šåˆ—ä¸­å®ç°çš„ï¼Œä¹Ÿå¯ä»¥å°†ä¸åŒé‡è¦ç­‰çº§çš„ä»»åŠ¡æäº¤åˆ°ä¸åŒçš„é˜Ÿåˆ—åå…¥ç»„æ‰§è¡Œï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> gd_queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> gh_queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, <span class="number">0</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_t group = dispatch_group_create();</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_async(group, gd_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"é»˜è®¤ä¼˜å…ˆçº§çš„ä»»åŠ¡1"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_async(group, gd_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"é»˜è®¤ä¼˜å…ˆçº§çš„ä»»åŠ¡2"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_async(group, gh_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡1"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_async(group, gh_queue, ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡2"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"åˆ°ä¸»çº¿ç¨‹æ‰§è¡Œæ‰€éœ€çš„æ“ä½œ"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr></table></figure>

<p>å½“ç„¶é˜Ÿåˆ—ä¹Ÿå¯ä»¥æ˜¯ä¸²è¡Œé˜Ÿåˆ—ï¼Œä¸è¿‡ä½¿ç”¨ä¸²è¡Œé˜Ÿåˆ—æ‰§è¡Œå°±æ²¡æœ‰æ„ä¹‰äº†ï¼Œä»»åŠ¡ä¾ç„¶éœ€è¦ä¸€ä¸ªä¸€ä¸ªçš„æ‰§è¡Œï¼ŒåŒä¸€é˜Ÿåˆ—ä»»åŠ¡ä¸èƒ½å®ç°å¹¶å‘çš„ç›®çš„ï¼Œå¯æ ¹æ®å…·ä½“éœ€è¦è‡ªè¡Œé€‰æ‹©ï¼</p>
]]></content>
      <categories>
        <category>ç§»åŠ¨å¼€å‘</category>
        <category>IOSå¼€å‘</category>
      </categories>
      <tags>
        <tag>ObjC</tag>
        <tag>Objective-C</tag>
        <tag>ios</tag>
        <tag>gcd</tag>
        <tag>é˜Ÿåˆ—</tag>
        <tag>concurrent</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äºä¸²è¡Œã€å¹¶å‘ã€å¹¶è¡Œç­‰çš„è¯´æ˜</title>
    <url>/content/edab7fec.html</url>
    <content><![CDATA[<h4 id="ä¸€ã€æ¦‚å¿µæœ¯è¯­"><a href="#ä¸€ã€æ¦‚å¿µæœ¯è¯­" class="headerlink" title="ä¸€ã€æ¦‚å¿µæœ¯è¯­"></a>ä¸€ã€æ¦‚å¿µæœ¯è¯­</h4><ol>
<li><p>è¿›ç¨‹ (<code>process</code>)</p>
<p>ç³»ç»Ÿä¸­æ­£åœ¨è¿è¡Œçš„ä¸€ä¸ªç¨‹åºçš„å®ä¾‹(å³ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶)ï¼Œå…·æœ‰ä¸€å®šçš„ç‹¬ç«‹åŠŸèƒ½ï¼Œæ˜¯çº¿ç¨‹çš„å®¹å™¨</p>
</li>
</ol>
<ol start="2">
<li><p>çº¿ç¨‹ (<code>thread</code>)</p>
<p>çº¿ç¨‹æ˜¯è¿›ç¨‹æ‰§è¡Œçš„æœ€å°å•ä½ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­è‡³å°‘åŒ…å«ä¸€ä¸ªçº¿ç¨‹(ä¸»çº¿ç¨‹)ï¼Œè¿›ç¨‹ä¸­ä»»åŠ¡éƒ½åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œ(ä¸»çº¿ç¨‹æˆ–å­çº¿ç¨‹)ã€‚æ˜¯ä»£ç ç‹¬ç«‹æ‰§è¡Œçš„è·¯å¾„ã€‚</p>
<a id="more"></a>
</li>
<li><p>ä»»åŠ¡ (<code>task</code>)</p>
<p>éœ€è¦æ‰§è¡Œçš„å·¥ä½œçš„æŠ½è±¡æ¦‚å¿µã€‚</p>
</li>
<li><p>å¹¶è¡Œ (<code>parallel</code>)</p>
<p>å¹¶è¡Œæ˜¯ä¸€ç§ä½¿ç”¨å¤šç§è¿ç®—ç¡¬ä»¶(å¦‚ï¼šå¤šæ ¸å¤„ç†å™¨)ï¼Œä»¥ä¾¿æ›´å¿«çš„æ‰§è¡Œè®¡ç®—ã€‚æ˜¯ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹ä»¶åœ¨åŒä¸€æ—¶é—´å‘ç”Ÿã€‚ç›®çš„æ˜¯å°†è®¡ç®—æœºä¸åŒçš„ä»»åŠ¡å§”æ´¾ç»™åŒæ—¶æ‰§è¡Œçš„ä¸åŒå¤„ç†å™¨æ¥å¤„ç†ï¼Œä»¥ä¾¿å°½æ—©è·å¾—ç»“æœã€‚æ¯”å¦‚é“¶è¡Œä¸šåŠ¡ï¼ŒåŒæ—¶å¼€é€šå¤šä¸ªä¸šåŠ¡çª—å£æ¥åŠç†ä¸šåŠ¡ï¼Œæ¯ä¸ªçª—å£éƒ½å¯ä»¥æ‰§è¡Œç‰¹å®šçš„ä»»åŠ¡ï¼Œå¤šä¸ªçª—å£å¯ä»¥åŒæ—¶åŠç†ä¸šåŠ¡ã€‚</p>
</li>
</ol>
<ol start="5">
<li><p>å¹¶å‘ (<code>concurrent</code>)</p>
<p>æ˜¯ä¸€ç§ç¨‹åºç»“æ„æŠ€æœ¯ï¼Œæœ‰å¤šä¸ªæ§åˆ¶çº¿ç¨‹ï¼Œæ˜¯ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹ä»¶åœ¨åŒä¸€æ—¶é—´é—´éš”å‘ç”Ÿã€‚ä»æ¦‚å¿µä¸Šå°†ï¼Œæ§åˆ¶çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œå®é™…ä¸Šæ˜¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´ä¸æ–­åˆ‡æ¢ä»¥è¾¾åˆ°å¤šçº¿ç¨‹æ‰§è¡Œä»»åŠ¡çš„ç›®çš„ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åœ¨å¤šä¸ªç‰©ç†å¤„ç†å™¨ä¸Šæ‰§è¡Œã€‚æ¯”å¦‚é“¶è¡Œä¸šåŠ¡ï¼Œåªå¼€é€šäº†ä¸€ä¸ªä¸šåŠ¡çª—å£ï¼Œä½†æ˜¯å¯ä»¥æ’å¤šä¸ªé˜Ÿä¼åˆ°ä¸€ä¸ªçª—å£åŠç†ä¸šåŠ¡ã€‚</p>
</li>
</ol>
<ol start="6">
<li><p>ä¸²è¡Œ (<code>serial</code>)</p>
<p>å¤šä¸ªä»»åŠ¡ä¾æ¬¡æ‰§è¡Œï¼Œå½“ä¸€ä¸ªä»»åŠ¡å®Œæˆä»¥åç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚ä¾‹å¦‚Aï¼ŒBï¼ŒCä¸‰ä¸ªä»»åŠ¡ï¼ŒAæ‰§è¡Œå®Œæ¯•æ‰§è¡ŒBï¼ŒBæ‰§è¡Œå®Œæ¯•æ‰§è¡ŒCã€‚æ¯”å¦‚é“¶è¡Œä¸šåŠ¡ï¼Œåªå¼€é€šäº†ä¸€ä¸ªä¸šåŠ¡çª—å£ï¼Œå¹¶ä¸”åªèƒ½æ’ä¸€æ¡é˜Ÿä¼è¿›è¡Œä¸šåŠ¡åŠç†ã€‚</p>
</li>
</ol>
<ol start="7">
<li><p>é˜Ÿåˆ— (<code>queue</code>)</p>
<p>æ˜¯ä¸€ç§å…ˆè¿›å…ˆå‡º(FIFO)çš„çº¿æ€§è¡¨ã€‚ä¸ç°å®ä¸–ç•Œä¸­çš„è§„åˆ™ä¸€æ ·ï¼Œå…ˆè¿›å…¥çš„å…ˆåŠç†ä¸šåŠ¡ã€‚</p>
</li>
</ol>
<ol start="8">
<li><p>åŒæ­¥ (<code>synchronous</code>)</p>
<p>è°ƒç”¨åï¼Œç­‰ä»»åŠ¡å®Œæˆä¹‹åè¿”å›çš„ç§°ä¸ºåŒæ­¥ï¼ŒåŒæ­¥æ‰§è¡Œä¼šé˜»å¡çº¿ç¨‹ã€‚</p>
</li>
</ol>
<ol start="9">
<li><p>å¼‚æ­¥ (<code>asynchronous</code>)</p>
<p>è°ƒç”¨åï¼Œç«‹å³è¿”å›çš„ç§°ä¸ºå¼‚æ­¥ï¼Œå¼‚æ­¥æ‰§è¡Œä¸ä¼šé˜»å¡çº¿ç¨‹ã€‚</p>
</li>
</ol>
<ol start="10">
<li><p>ä¸²è¡Œé˜Ÿåˆ— (<code>serial queue</code>)</p>
<p>æŒ‰ç…§FIFOåŸåˆ™ï¼Œå‡ºé˜Ÿåå°†ä»»åŠ¡ç§»äº¤ç»™çº¿ç¨‹æ‰§è¡Œå®é™…å·¥ä½œï¼Œåé¢ä¸€ä¸ªä»»åŠ¡éœ€è¦ç­‰å¾…å‰é¢ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•åœ¨å‡ºé˜Ÿç§»äº¤ï¼Œä¾æ¬¡ç±»æ¨</p>
</li>
</ol>
<ol start="11">
<li><p>å¹¶å‘é˜Ÿåˆ— (<code>concurrent queue</code>)</p>
<p>éµå¾ªFIFOåŸåˆ™å…¥é˜Ÿå‡ºé˜Ÿï¼Œä»»åŠ¡å‡ºé˜Ÿæ„å‘³ç€å°†ä»»åŠ¡ç§»äº¤ç»™ä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶å‘ä¸ç”¨ç­‰å¾…ï¼Œç§»äº¤ç»™çº¿ç¨‹åç«‹åˆ»è¿”å›ï¼Œåä¸€ä¸ªä»»åŠ¡ç»§ç»­å‡ºé˜Ÿï¼Œç§»äº¤çº¿ç¨‹ã€‚ä¼šå› ä¸ºç³»ç»Ÿå› ç´ ä¸ä»»åŠ¡å¤æ‚åº¦å‡ºç°ä¸åŒçš„æ‰§è¡Œç»“æœï¼Œä½†å‡ºé˜Ÿä¹Ÿæ˜¯æŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºæ‰§è¡Œï¼Œåªæ˜¯ç§»äº¤ç»™çº¿ç¨‹åçš„å¤„ç†ç»“æœä¸åŒ(å¼€è¾Ÿå¤šçº¿ç¨‹æ‰ä¼šå‡ºç°ä¸åŒçš„æ‰§è¡Œç»“æœï¼Œå•çº¿ç¨‹ä¾ç„¶é¡ºåºè¾“å‡ºï¼Œå› ä¸ºåªæœ‰ä¸€æ¡çº¿ç¨‹æ‰§è¡Œä»»åŠ¡)ã€‚</p>
</li>
</ol>
<h4 id="äºŒã€å›¾è§£è¯´æ˜"><a href="#äºŒã€å›¾è§£è¯´æ˜" class="headerlink" title="äºŒã€å›¾è§£è¯´æ˜"></a>äºŒã€å›¾è§£è¯´æ˜</h4><p>å¯å‚ç…§ä¸‹å›¾ç†è§£.</p>
<p>ä¸²è¡Œï¼Œå¹¶å‘ï¼Œä¸å¹¶è¡Œçš„åŒºåˆ«ã€‚(å›¾ç‰‡å‡æ‘˜è‡ªç½‘ç»œ)</p>
<p><img src="/content/edab7fec/20191216_01.jpg" alt="20191216_01"></p>
<p>ä¸²è¡Œåˆ—é˜Ÿï¼Œå¹¶å‘é˜Ÿåˆ—çš„åŒºåˆ«ã€‚(å›¾ç‰‡å‡æ‘˜è‡ªç½‘ç»œ)</p>
<p><img src="/content/edab7fec/20191216_02.jpg" alt="20191216_01"></p>
]]></content>
      <categories>
        <category>ç¨‹åºè®¾è®¡</category>
        <category>å…¶ä»–</category>
      </categories>
      <tags>
        <tag>ä¸²è¡Œ</tag>
        <tag>å¹¶å‘</tag>
        <tag>å¹¶è¡Œ</tag>
        <tag>serail</tag>
        <tag>coucurrent</tag>
        <tag>queue</tag>
      </tags>
  </entry>
  <entry>
    <title>[IOS.OC]selfä¸superè°ƒç”¨æœ¬è´¨åˆ†æ</title>
    <url>/content/3b516ae7.html</url>
    <content><![CDATA[<h4 id="ä¸€ã€self-åŸºæœ¬è¯´æ˜"><a href="#ä¸€ã€self-åŸºæœ¬è¯´æ˜" class="headerlink" title="ä¸€ã€self åŸºæœ¬è¯´æ˜"></a>ä¸€ã€self åŸºæœ¬è¯´æ˜</h4><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨åˆ°<code>self</code>å…³é”®å­—ï¼Œæ¯”å¦‚ï¼Œè®¿é—®å±æ€§ï¼Œè°ƒç”¨å®ä¾‹æ–¹æ³•ç­‰ã€‚é‚£ä¹ˆ<code>self</code>åˆ°åº•æŒ‡çš„æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£çš„è§£é‡Šå’Œå®šä¹‰ï¼š</p>
<blockquote>
<p>Returns the receiver.   //è¿”å›æ¥æ”¶å™¨</p>
</blockquote>
<p>åœ¨çœ‹ä¸€ä¸‹<code>NSObject</code>ä¸­å…³äº<code>self</code>çš„ä¸€äº›è¯´æ³•ï¼š</p>
<a id="more"></a>
<blockquote>
<p>Rather than using <code>[[XYZPerson alloc] init]</code> in the class factory method, instead try using <code>[[self alloc] init]</code>.</p>
<p>Using <code>self</code> in a class factory method means that youâ€™re referring to the class itself.</p>
</blockquote>
<p>åœ¨å·¥å‚æ–¹æ³•ä¸­ä½¿ç”¨<code>self</code>æ„å‘³ç€å¼•ç”¨ç±»æœ¬èº«ï¼Œæ„æ€å°±æ˜¯è¯´<code>self</code>å°±æ˜¯å½“å‰ç±»ï¼Œé‚£ä¹ˆå†æ¥çœ‹ä¸€ä¸‹æºç ä¸­å¯¹<code>self</code>çš„å®šä¹‰ï¼Œä»£ç (1-1)ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">+ (<span class="keyword">id</span>)<span class="keyword">self</span> &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">return</span> (<span class="keyword">id</span>)<span class="keyword">self</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//-----------------------------åˆ†å‰²çº¿--------------------------</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">id</span>)<span class="keyword">self</span> &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°<code>self</code>åªæ˜¯è¿”å›æœ¬èº«ï¼Œä¹Ÿå°±æ˜¯å½“å‰è°ƒç”¨è€…ã€‚<font color="red">(PS:è°ƒç”¨è€…å¹¶ä¸ä¸€å®šæ˜¯å½“å‰ç±»ï¼Œç»§ç»­çœ‹ä¸‹æ–‡å¯æ˜ç™½)</font></p>
<p>å› ä¸º<code>self</code>æ˜¯æ¶ˆæ¯æœºåˆ¶ä¸­çš„ç¬¬ä¸€ä¸ªéšè—å‚æ•°ï¼Œåœ¨æ¶ˆæ¯ä¼ é€’çš„è¿‡ç¨‹ä¸­ï¼Œæœ¬èµ‹å€¼ä¸ºè°ƒç”¨è€…ï¼Œä¹Ÿå°±æ˜¯æ¶ˆæ¯æ¥æ”¶è€…ã€‚ç¬¬äºŒä¸ªéšè—å‚æ•°ä¸º<code>_cmd</code>ï¼Œä¹Ÿå°±æ˜¯<code>SEL</code>ï¼Œè°ƒç”¨çš„æ–¹æ³•ã€‚</p>
<h4 id="äºŒã€super-åŸºæœ¬è¯´æ˜"><a href="#äºŒã€super-åŸºæœ¬è¯´æ˜" class="headerlink" title="äºŒã€super åŸºæœ¬è¯´æ˜"></a>äºŒã€super åŸºæœ¬è¯´æ˜</h4><p><code>super</code>å…³é”®å­—ï¼Œ<font color="red">ï¼ˆPSï¼šä¸çŸ¥ä¸ºä½•å¤§éƒ¨åˆ†æ–‡ç« ä¸­éƒ½è¯´superä¸æ˜¯å…³é”®å­—ï¼Œå…³é”®å­—çš„æ¦‚å¿µå°±æ˜¯ä¿ç•™å­—ï¼Œå¾ˆæ˜æ˜¾superæ˜¯ä¿ç•™å­—ï¼‰</font>ä¹Ÿæ˜¯æˆ‘ä»¬ç»å¸¸çœ‹åˆ°å’Œä½¿ç”¨çš„ã€‚ä»£ç (2-1)ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//-----------------------------åˆ†å‰²çº¿--------------------------</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">instancetype</span>)init &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">if</span>(<span class="keyword">self</span>)&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="comment">//...</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>å…³äº<code>super</code>çš„è¯´æ˜ï¼Œæœ¬äººå¹¶æ²¡æœ‰åœ¨å®˜æ–¹æ–‡æ¡£ä¸­çœ‹åˆ°ï¼Œå¦‚æœå¤§å®¶æœ‰å‘ç°è¯·å…³æ³¨æœ¬æ–‡æœ«å°¾çš„å…¬ä¼—å·ï¼Œå‘ŠçŸ¥æœ¬äººï¼Œå°†ä¸èƒœæ„Ÿæ¿€ã€‚åªæ˜¯åœ¨<code>NSObject</code>ä¸­æœ‰éƒ¨åˆ†è¯´æ˜å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>Thereâ€™s another important keyword available to you in Objective-C, called <code>super</code>. Sending a message to <code>super</code> is a way to call through to a method implementation defined by a superclass further up the inheritance chain. The most common use of <code>super</code> is when overriding a method.</p>
</blockquote>
<p>æ„æ€æ˜¯è¯´ï¼Œ<code>super</code>æ˜¯ä¸€ä¸ªé‡è¦çš„å…³é”®å­—<font color="red">(è¿™é‡Œä¹Ÿæœ‰è¯´superæ˜¯å…³é”®å­—ï¼Œæ‰€ä»¥ç½‘ä¸Šå¾ˆå¤šè¯´æ³•æ˜¯é”™è¯¯çš„ï¼Œå¤§å®¶è¦è‡ªå·±ç”„åˆ«ï¼)</font>ï¼Œå‘<code>super</code>å‘é€æ¶ˆæ¯æ˜¯è°ƒç”¨ç»§æ‰¿é“¾ä¸Šçš„è¶…ç±»æ–¹æ³•ã€‚<code>super</code>æœ€å¸¸è§çš„ç”¨æ³•å°±æ˜¯è¦†ç›–ä¸€ä¸ªæ–¹æ³•ã€‚</p>
<h4 id="ä¸‰ã€æ¢ç©¶selfå’Œsuper"><a href="#ä¸‰ã€æ¢ç©¶selfå’Œsuper" class="headerlink" title="ä¸‰ã€æ¢ç©¶selfå’Œsuper"></a>ä¸‰ã€æ¢ç©¶<code>self</code>å’Œ<code>super</code></h4><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªåŸºäº Single View Appçš„æ¨¡æ¿é¡¹ç›®ï¼Œæ·»åŠ <code>Person</code>å’Œ<code>Student</code>ç±»ï¼Œ<code>Person</code>ç±»ç»§æ‰¿äº<code>NSObject</code>ç±»ï¼Œ<code>Student</code>ç±»ç»§æ‰¿äº<code>Person</code>ç±»ï¼Œä»¥å¤‡åé¢ä½¿ç”¨ã€‚ä¸‹é¢æˆ‘ä»¬åœ¨é¡¹ç›®é»˜è®¤åˆ›å»ºçš„<code>ViewController.m</code>ç±»ä¸­æ·»åŠ ä»£ç (3-1)ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"self:%@"</span>, <span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span> <span class="keyword">class</span>]));</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"super:%@"</span>, <span class="built_in">NSStringFromClass</span>([<span class="keyword">super</span> <span class="keyword">class</span>]));</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>æŸ¥çœ‹è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">demo1[<span class="number">2534</span>:<span class="number">11854005</span>] self:ViewController</span></pre></td></tr><tr><td class="code"><pre><span class="line">demo1[<span class="number">2534</span>:<span class="number">11854005</span>] <span class="keyword">super</span>:ViewController</span></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°<code>self</code>ä¸<code>super</code>çš„è¾“å‡ºåŒæ ·æ˜¯<code>ViewController</code>ï¼Œä¹Ÿå°±æ˜¯å½“å‰ç±»ã€‚ç„¶åæˆ‘ä»¬ç»§ç»­è¯•éªŒï¼Œåœ¨<code>Person</code>å’Œ<code>Student</code>ç±»ä¸­åˆ†åˆ«æ·»åŠ <code>eat</code>æ–¹æ³•ï¼Œä»£ç (3-2)ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Person.h"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)eat &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ eat!"</span>, <span class="keyword">self</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@end</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="comment">//-----------------------------åˆ†å‰²çº¿--------------------------</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Student.h"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Student</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)eat &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">super</span> eat];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ eat!"</span>, <span class="keyword">self</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@end</span></span></pre></td></tr></table></figure>

<p>ç„¶ååœ¨<code>ViewController.m</code>çš„<code>ViewDidLoad</code>æ–¹æ³•ä¸­ï¼Œåˆ›å»º<code>Student</code>ç±»å¹¶è°ƒç”¨<code>eat</code>æ–¹æ³•ï¼Œä»£ç (3-3)ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">Student * student = [[Student alloc] init];</span></pre></td></tr><tr><td class="code"><pre><span class="line">[student eat];</span></pre></td></tr></table></figure>

<p>è¿è¡Œï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">demo1[<span class="number">2962</span>:<span class="number">11906123</span>] &lt;Student: <span class="number">0</span>x600003fc8100&gt; eat!</span></pre></td></tr><tr><td class="code"><pre><span class="line">demo1[<span class="number">2962</span>:<span class="number">11906123</span>] &lt;Student: <span class="number">0</span>x600003fc8100&gt; eat!</span></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ˜æ˜æ˜¯åœ¨<code>Student</code>ç±»ä¸­é€šè¿‡<code>super</code>è°ƒç”¨çš„çˆ¶ç±»<code>Person</code>ä¸­çš„<code>eat</code>æ–¹æ³•ï¼Œä¸ºä½•<code>Person</code>ä¸­çš„<code>eat</code>æ–¹æ³•è¾“å‡ºçš„ä¹Ÿæ˜¯<code>Student eat</code>å‘¢ï¼Ÿå…³äºè¿™ä¸€éƒ¨åˆ†çš„è§£é‡Šï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šè¯´æ˜è§£é‡Šï¼Œæ€»æ„Ÿè§‰ä¸å¤Ÿè¯¦ç»†å½»åº•ï¼Œä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡å‘½ä»¤è¡Œå°†<code>Student.m</code>æ–‡ä»¶è½¬æˆ<code>.cpp</code>æ–‡ä»¶ï¼Œï¼Œ<code>cd</code>è¿›å…¥åˆ°<code>Student.m</code>æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼Œä½¿ç”¨å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">xcrun -sdk iphonesimulator clang -rewrite-objc Student.m</span></pre></td></tr></table></figure>

<p>ä¼šåœ¨å½“å‰æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆ<code>Student.cpp</code>æ–‡ä»¶ï¼Œæ‰“å¼€æ‰¾åˆ°ä»¥ä¸‹ä»£ç (3-4)ï¼Œ</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> _I_Student_eat(Student * self, SEL _cmd) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    ((<span class="keyword">void</span> (*)(__rw_objc_super *, SEL))(<span class="keyword">void</span> *)objc_msgSendSuper)((__rw_objc_super)&#123;(id)self, (id)class_getSuperclass(objc_getClass(<span class="string">"Student"</span>))&#125;, sel_registerName(<span class="string">"eat"</span>));</span></pre></td></tr><tr><td class="code"><pre><span class="line">    NSLog((NSString *)&amp;__NSConstantStringImpl__var_folders_fm_9d3dmfcj49598v7_hghf3qjc0000gn_T_Student_370c84_mi_0, self);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>æ‰¾åˆ°å…³äº<code>super</code>è°ƒç”¨çš„éƒ¨åˆ†ä»£ç (3-5)ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">((<span class="keyword">void</span> (*)(__rw_objc_super *, SEL))(<span class="keyword">void</span> *)objc_msgSendSuper)((__rw_objc_super)&#123;(id)self, (id)class_getSuperclass(objc_getClass(<span class="string">"Student"</span>))&#125;, sel_registerName(<span class="string">"eat"</span>));</span></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°ï¼Œå½“<code>super</code>è°ƒç”¨æ—¶ï¼Œå…¶å®æ˜¯è°ƒç”¨çš„<code>objc_msgSendSuper</code>æ–¹æ³•è¿›è¡Œçš„æ¶ˆæ¯å‘é€ï¼Œæˆ‘ä»¬çœ‹ä¸‹å®˜æ–¹æ–‡æ¡£å¯¹äºæ­¤æ–¹æ³•çš„è§£é‡Šï¼š</p>
<blockquote>
<p>Sends a message with a simple return value to the superclass of an instance of a class.</p>
</blockquote>
<p>å‘è¶…ç±»å‘é€æ¶ˆæ¯ã€‚</p>
<p>é€šè¿‡ä»£ç (3-5)ï¼Œå¯ä»¥å¾—çŸ¥ï¼Œæˆ‘ä»¬è¿™é‡Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ç»“æ„ä½“æŒ‡é’ˆç±»å‹<code>__rw_objc_super</code>ï¼Œä¸€ä¸ªæ˜¯è¿”å›<code>SEL</code>ç±»å‹æ–¹æ³•ç¼–å·çš„<code>sel_registerName</code>ã€‚è€Œ<code>__rw_objc_super</code>åœ¨æˆ‘ä»¬ç¼–è¯‘çš„<code>Student.cpp</code>æ–‡ä»¶ä¸­å¯ä»¥æ‰¾åˆ°åŸå‹ï¼Œä»£ç (3-6)ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">rw_objc_super</span> &#123;</span> </span></pre></td></tr><tr><td class="code"><pre><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">objc_object</span> *<span class="title">object</span>;</span> </span></pre></td></tr><tr><td class="code"><pre><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">objc_object</span> *<span class="title">superClass</span>;</span> </span></pre></td></tr><tr><td class="code"><pre><span class="line">	__rw_objc_super(struct objc_object *o, struct objc_object *s) : object(o), superClass(s) &#123;&#125; </span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;;</span></pre></td></tr></table></figure>

<p>ç»“åˆå®˜æ–¹æ–‡æ¡£å¯¹<code>objc_msgSendSuper</code>æ–¹æ³•å‚æ•°çš„è¯´æ˜æˆ‘ä»¬å¾—çŸ¥ï¼Œ<code>__rw_objc_super</code>ï¼Œä¹Ÿå°±æ˜¯<code>objc_super</code>ã€‚å®˜æ–¹æ–‡æ¡£å¯¹æ­¤å‚æ•°çš„è¯´æ˜å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>A pointer to an <a href="https://developer.apple.com/documentation/objectivec/objc_super?language=objc" target="_blank" rel="noopener"><code>objc_super</code></a> data structure. Pass values identifying the context the message was sent to, including the instance of the class that is to receive the message and the superclass at which to start searching for the method implementation.</p>
</blockquote>
<p>æŒ‡å‘<code>objc_super</code>çš„ç»“æ„ä½“æŒ‡é’ˆï¼Œä¼ é€’æ ‡è¯†äº†ä¸Šä¸‹æ–‡çš„æ¶ˆæ¯ï¼ŒåŒ…å«äº†æ¶ˆæ¯æ¥æ”¶è€…å’Œè¦åœ¨è¶…ç±»ä¸­æœç´¢çš„æ–¹æ³•å®ç°ã€‚æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹<code>objc_super</code>ç»“æ„ä½“çš„æºç (3-7)ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// Specifies the superclass of an instance. </span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_super</span> &#123;</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">/// Specifies an instance of a class.</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    __unsafe_unretained _Nonnull id receiver;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">/// Specifies the particular superclass of the instance to message. </span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !defined(__cplusplus)  &amp;&amp;  !__OBJC2__</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">/* For compatibility with old objc-runtime.h header */</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    __unsafe_unretained _Nonnull Class <span class="class"><span class="keyword">class</span>;</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    __unsafe_unretained _Nonnull Class super_class;</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">/* super_class is the first class to search */</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;;</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span></pre></td></tr></table></figure>

<p>ç»“åˆæˆ‘ä»¬ç¼–è¯‘çš„ä»£ç (3-5)ï¼Œæˆ‘ä»¬å¾—çŸ¥ï¼Œæ¶ˆæ¯çš„æ¥æ”¶è€…åœ¨è¿™é‡Œä¼ é€’çš„å°±æ˜¯å½“å‰å¯¹è±¡<code>self</code>ï¼Œå³<code>Student</code>ç±»çš„å®ä¾‹å¯¹è±¡ï¼Œæ–¹æ³•å³<code>eat</code> ã€‚</p>
<p>é€šè¿‡ä¸Šé¢çš„åˆ†ææˆ‘ä»¬å¾—çŸ¥ï¼Œåœ¨æˆ‘ä»¬ä½¿ç”¨<code>super</code>æ–¹æ³•è°ƒç”¨çˆ¶ç±»æ–¹æ³•æ—¶ï¼Œå…¶å®ä¼ é€’äº†éšè—å‚æ•°ã€‚æˆ‘ä»¬ä¸Šé¢è¯´è¿‡ï¼Œ<code>self</code>è°ƒç”¨è¿”å›æ–¹æ³•æœ¬èº«ï¼Œå¹¶ä¸ä¸€å®šæ˜¯ä½ çœ‹åˆ°çš„å½“å‰è°ƒç”¨è€…ã€‚è¿™é‡Œå¯ä»¥è¯´æ˜ï¼Œå½“æˆ‘ä»¬åœ¨çˆ¶ç±»ä¸­ä½¿ç”¨<code>self</code>æ—¶ï¼Œå› ä¸ºæ˜¯åœ¨å­ç±»ä¸­é€šè¿‡<code>super</code>æ–¹æ³•è°ƒç”¨çš„çˆ¶ç±»æ–¹æ³•ï¼Œåœ¨è¿™è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡éšè—ç»“æ„ä½“å‚æ•°ï¼Œæ¶ˆæ¯æ¥æ”¶è€…ä¼ é€’çš„æ˜¯å½“å‰çš„<code>self</code>ï¼Œä¹Ÿå°±æ˜¯<code>Student</code>çš„å®ä¾‹ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨çˆ¶ç±»ä¸­ä½¿ç”¨<code>self</code>æ—¶ï¼Œå…¶å®æ˜¯ä½¿ç”¨å­ç±»çš„å®ä¾‹åœ¨è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œæ‰€ä»¥ä¹Ÿå°±æœ‰äº†ä»£ç (3-1)å’Œ(3-3)çš„è¾“å‡ºã€‚</p>
]]></content>
      <categories>
        <category>ç§»åŠ¨å¼€å‘</category>
        <category>IOSå¼€å‘</category>
      </categories>
      <tags>
        <tag>ObjC</tag>
        <tag>super</tag>
        <tag>self</tag>
        <tag>IOS</tag>
        <tag>Objective-C</tag>
      </tags>
  </entry>
  <entry>
    <title>[IOS.OC]å…³äºç±»ç°‡</title>
    <url>/content/b7bda735.html</url>
    <content><![CDATA[<h4 id="ä¸€ã€å¼•è¯­"><a href="#ä¸€ã€å¼•è¯­" class="headerlink" title="ä¸€ã€å¼•è¯­"></a>ä¸€ã€å¼•è¯­</h4><p>é¦–å…ˆæ–°å»ºåŸºäº Single View Appçš„å·¥ç¨‹ï¼Œåœ¨<code>ViewController.m</code>æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç (1-1)ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSString</span> * string1 = [[<span class="built_in">NSString</span> alloc] init];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"string1 length:%lu"</span>, string1.length);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>
<a id="more"></a>
<p>è¿™æ˜¯ä¸€æ®µæ™®é€šçš„ä¸èƒ½åœ¨æ™®é€šçš„åˆ›å»ºä¸å¯å˜å­—ç¬¦ä¸²çš„è¿‡ç¨‹ï¼Œ<code>length</code>ä¸º<code>NSString</code>çš„è·å–é•¿åº¦çš„å±æ€§ï¼Œæˆ‘ä»¬è¾“å‡ºäº†å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œç»“æœä¸º0ã€‚ç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª<code>Person</code>ç±»ï¼Œæ·»åŠ å±æ€§å˜é‡<code>age</code>ï¼Œä»£ç (1-2)ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">NSUInteger</span> age;</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@end</span></span></pre></td></tr></table></figure>

<p>ç„¶ååœ¨<code>ViewControlelr.m</code>ä¸­æ·»åŠ ä»£ç (1-3)ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSString</span> * string1 = [[<span class="built_in">NSString</span> alloc] init];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"string1 length:%lu"</span>, string1.length);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    Person * person = [[Person alloc] init];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%lu"</span>, person.age);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>
<p>é€šè¿‡è¿è¡Œæˆ‘ä»¬å‘ç°ä»£ç å®Œå…¨æ²¡æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯¹ä¸Šé¢çš„ä»£ç åšå¦‚ä¸‹ä¿®æ”¹ï¼Œä»£ç (1-4)ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    Person * person = [Person alloc];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%lu"</span>, person.age);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSString</span> * string1 = [<span class="built_in">NSString</span> alloc];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"string1 length:%lu"</span>, string1.length);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¿è¡Œæˆ‘ä»¬å‘ç°æœ‰å¦‚ä¸‹ç»“æœï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">11</span>-<span class="number">27</span> <span class="number">21</span>:<span class="number">12</span>:<span class="number">01</span><span class="variable">.183451</span>+<span class="number">0800</span> allocmessage[<span class="number">5302</span>:<span class="number">2528864</span>] <span class="number">0</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">11</span>-<span class="number">27</span> <span class="number">21</span>:<span class="number">12</span>:<span class="number">01</span><span class="variable">.183520</span>+<span class="number">0800</span> allocmessage[<span class="number">5302</span>:<span class="number">2528864</span>] Did you forget to nest alloc <span class="keyword">and</span> init?</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">11</span>-<span class="number">27</span> <span class="number">21</span>:<span class="number">12</span>:<span class="number">01</span><span class="variable">.185386</span>+<span class="number">0800</span> allocmessage[<span class="number">5302</span>:<span class="number">2528864</span>] *** Terminating app due to uncaught exception 'NSInvalidArgumentException', reason: '*** -length only defined <span class="keyword">for</span> abstract <span class="keyword">class</span>.  Define -[NSPlaceholderString length]!'</span></pre></td></tr></table></figure>

<p>å½“è¾“å‡º<code>person.age</code>æ—¶æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œæ­£ç¡®è¾“å‡ºç»“æœï¼Œè€Œæ‰§è¡Œåˆ°<code>string1.length</code>æ—¶æŠ¥é”™äº†ã€‚é”™è¯¯æç¤ºå‘Šè¯‰æˆ‘ä»¬<code>NSString</code>è¦åµŒå¥—ä½¿ç”¨<code>alloc</code>å’Œ<code>init</code>æ–¹æ³•ï¼Œå¹¶ä¸”<code>length</code>å±æ€§ä»…ä»…æ˜¯å®šä¹‰åœ¨ä¸€ä¸ªæŠ½è±¡ç±»ä¸­ã€‚é‚£ä¹ˆæˆ‘ä»¬æ¥ä¸€çœ‹ä»€ä¹ˆæ˜¯æŠ½è±¡ç±»ï¼Œæ‘˜è‡ªç™¾åº¦ç™¾ç§‘çš„æ¦‚å¿µå¦‚ä¸‹ï¼š</p>
<blockquote>
<p>æŠ½è±¡ç±»æ˜¯ä¸å®Œæ•´çš„ï¼Œå®ƒåªèƒ½ç”¨ä½œåŸºç±»ã€‚åœ¨é¢å‘å¯¹è±¡æ–¹æ³•ä¸­ï¼ŒæŠ½è±¡ç±»ä¸»è¦ç”¨æ¥è¿›è¡Œç±»å‹éšè—å’Œå……å½“å…¨å±€å˜é‡çš„è§’è‰²ã€‚</p>
<p>åœ¨é¢å‘å¯¹è±¡çš„æ¦‚å¿µä¸­ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯é€šè¿‡ç±»æ¥æç»˜çš„ï¼Œä½†æ˜¯åè¿‡æ¥ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ç±»éƒ½æ˜¯ç”¨æ¥æç»˜å¯¹è±¡çš„ï¼Œå¦‚æœä¸€ä¸ªç±»ä¸­æ²¡æœ‰åŒ…å«è¶³å¤Ÿçš„ä¿¡æ¯æ¥æç»˜ä¸€ä¸ªå…·ä½“çš„å¯¹è±¡ï¼Œè¿™æ ·çš„ç±»å°±æ˜¯æŠ½è±¡ç±»</p>
<p>æŠ½è±¡ç±»ä¸èƒ½å®ä¾‹åŒ–</p>
</blockquote>
<p>é€šè¿‡ä»¥ä¸Šè¯´æ˜æˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼Œå…¶å®<code>NSString</code>æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç±»ä¸­åªæ˜¯è¿›è¡Œäº†ç®€å•çš„è¡Œä¸ºå£°æ˜ï¼Œå¹¶æ²¡æœ‰å®ç°ã€‚è€Œåœ¨<code>Objective-C</code>ä¸­å¹¶æ²¡æœ‰æ˜ç¡®çš„æŠ½è±¡ç±»çš„å®šä¹‰ï¼Œæ‰€ä»¥è¿™æ ·çš„å®ç°æ–¹å¼æˆ‘ä»¬ç§°è°“â€ç±»ç°‡â€œã€‚</p>
<h4 id="äºŒã€ç±»ç°‡çš„æ¦‚å¿µ"><a href="#äºŒã€ç±»ç°‡çš„æ¦‚å¿µ" class="headerlink" title="äºŒã€ç±»ç°‡çš„æ¦‚å¿µ"></a>äºŒã€ç±»ç°‡çš„æ¦‚å¿µ</h4><p>ç±»ç°‡(class cluster)ï¼Œæ˜¯ä¸€ç§æ¨¡å¼ï¼Œå¯ä»¥éšè—â€æŠ½è±¡åŸºç±»(abstract  base class)â€œèƒŒåçš„å®ç°ç»†èŠ‚ï¼Œç”¨æˆ·æ— éœ€åˆ›å»ºå­ç±»çš„å®ä¾‹ï¼Œåªéœ€è°ƒç”¨åŸºç±»æ–¹æ³•æ¥åˆ›å»ºå³å¯ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹ï¼Œä»£ç (3-1)ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">NSString</span> * string1 = [<span class="built_in">NSString</span> alloc];</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSString</span> * string2 = [string1 init];</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSString</span> * string3 = <span class="string">@"string"</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSString</span> * string4 = [[<span class="built_in">NSString</span> alloc] initWithString:string2];</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSString</span> * string5 = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@"</span>, <span class="string">@"string"</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"string1:%s"</span>, object_getClassName(string1));</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"string2:%s"</span>, object_getClassName(string2));</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"string3:%s"</span>, object_getClassName(string3));</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"string4:%s"</span>, object_getClassName(string4));</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"string5:%s"</span>, object_getClassName(string5));</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">11</span>-<span class="number">27</span> <span class="number">22</span>:<span class="number">54</span>:<span class="number">42</span><span class="variable">.423153</span>+<span class="number">0800</span> allocmessage[<span class="number">81291</span>:<span class="number">9763415</span>] string1:NSPlaceholderString</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">11</span>-<span class="number">27</span> <span class="number">22</span>:<span class="number">54</span>:<span class="number">42</span><span class="variable">.423323</span>+<span class="number">0800</span> allocmessage[<span class="number">81291</span>:<span class="number">9763415</span>] string2:<span class="number">__</span>NSCFConstantString</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">11</span>-<span class="number">27</span> <span class="number">22</span>:<span class="number">54</span>:<span class="number">42</span><span class="variable">.423428</span>+<span class="number">0800</span> allocmessage[<span class="number">81291</span>:<span class="number">9763415</span>] string3:<span class="number">__</span>NSCFConstantString</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">11</span>-<span class="number">27</span> <span class="number">22</span>:<span class="number">54</span>:<span class="number">42</span><span class="variable">.423523</span>+<span class="number">0800</span> allocmessage[<span class="number">81291</span>:<span class="number">9763415</span>] string4:<span class="number">__</span>NSCFConstantString</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">11</span>-<span class="number">27</span> <span class="number">22</span>:<span class="number">54</span>:<span class="number">42</span><span class="variable">.423616</span>+<span class="number">0800</span> allocmessage[<span class="number">81291</span>:<span class="number">9763415</span>] string5:NSTaggedPointerString</span></pre></td></tr></table></figure>

<p>PS:é€šè¿‡ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹å‡ºï¼Œ<code>string3</code>å’Œ<code>string4</code>æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥åœ¨åˆ›å»ºå­—ç¬¦ä¸²æ—¶ï¼Œå¦‚æœä¸æ˜¯é€šè¿‡ä¸€ä¸ªå­—ç¬¦ä¸²æ¥åˆ›å»ºå¦ä¸€ä¸ªå­—ç¬¦ä¸²çš„æƒ…å†µç”¨<code>string3</code>çš„æ–¹å¼åˆ›å»ºå³å¯ã€‚</p>
<p>é€šè¿‡ç»“æœå¯ä»¥çœ‹å‡ºæˆ‘ä»¬åˆ›å»ºçš„å­—ç¬¦ä¸²å¯¹è±¡æœ¬è´¨ä¸Šå¹¶ä¸æ˜¯ä¸€ä¸ª<code>NSString</code>ç±»å‹ï¼Œè€Œæ˜¯å…¶å­ç±»ç±»å‹ï¼Œæˆ‘ä»¬é€šè¿‡ä»¥ä¸‹æ–¹æ³•å¯ä»¥éªŒè¯ï¼Œä»£ç (3-2)ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"superclass:%@"</span>, [<span class="built_in">NSClassFromString</span>(<span class="string">@"NSTaggedPointerString"</span>) superclass]);</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœä¸ºï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">11</span>-<span class="number">27</span> <span class="number">22</span>:<span class="number">23</span>:<span class="number">02</span><span class="variable">.662405</span>+<span class="number">0800</span> allocmessage[<span class="number">81090</span>:<span class="number">9732886</span>] superclass:NSString</span></pre></td></tr></table></figure>

<p>æ‰€ä»¥å½“æˆ‘ä»¬ä½¿ç”¨<code>isMemberOfClass</code>æ¥åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æ˜¯å½“å‰ç±»æ—¶ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯å¦å®šçš„ï¼Œä»£ç (3-3)ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>([string3 isMemberOfClass:[<span class="built_in">NSString</span> <span class="keyword">class</span>]]) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">      <span class="built_in">NSLog</span>(<span class="string">@"æ˜¯NSStringå½“å‰ç±»"</span>);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  &#125;<span class="keyword">else</span> <span class="built_in">NSLog</span>(<span class="string">@"å¦"</span>);</span></pre></td></tr></table></figure>

<p>ç»“æ„ä¸ºï¼šå¦ã€‚</p>
<p>å½“ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>isKindOfClass</code>æ¥åˆ¤æ–­ï¼Œç»“æœæ˜¯æ­£ç¡®æ˜¯æ­£ç¡®çš„ã€‚</p>
<h4 id="ä¸‰ã€åœ°å€éªŒè¯"><a href="#ä¸‰ã€åœ°å€éªŒè¯" class="headerlink" title="ä¸‰ã€åœ°å€éªŒè¯"></a>ä¸‰ã€åœ°å€éªŒè¯</h4><p>é¦–å…ˆé‡å†™<code>Person</code>ç±»çš„<code>init</code>åˆå§‹åŒ–æ–¹æ³•ï¼Œä»£ç (4-1)ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">instancetype</span>)init &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">if</span>(<span class="keyword">self</span>)&#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="keyword">self</span>.age = <span class="number">10</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>ç„¶ååœ¨<code>ViewController</code>çš„<code>viewDidLoad</code>æ–¹æ³•ä¸­æ·»åŠ ä»£ç (4-2)ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    Person * person1 = [Person alloc];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    Person * person2 = [person1 init];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"person1 address:%p"</span>, person1);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"person2 address:%p"</span>, person2);</span></pre></td></tr><tr><td class="code"><pre><span class="line">  </span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSString</span> * string1 = [<span class="built_in">NSString</span> alloc];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSString</span> * string2 = [string1 init];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSString</span> * string3 = [string1 init];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSString</span> * string4 = [string2 init];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSString</span> * string5 = [string1 initWithFormat:<span class="string">@"string1"</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSString</span> * string6 = [string1 initWithString:<span class="string">@"string2"</span>];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"string1 address:%p"</span>, string1);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"string2 address:%p"</span>, string2);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"string3 address:%p"</span>, string3);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"string4 address:%p"</span>, string4);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"string5 address:%p"</span>, string5);</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"string6 address:%p"</span>, string6);</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">11</span>-<span class="number">27</span> <span class="number">23</span>:<span class="number">14</span>:<span class="number">34</span><span class="variable">.355410</span>+<span class="number">0800</span> allocmessage[<span class="number">81487</span>:<span class="number">9784814</span>] person1 address:<span class="number">0</span>x600001fe8340</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">11</span>-<span class="number">27</span> <span class="number">23</span>:<span class="number">14</span>:<span class="number">34</span><span class="variable">.355542</span>+<span class="number">0800</span> allocmessage[<span class="number">81487</span>:<span class="number">9784814</span>] person2 address:<span class="number">0</span>x600001fe8340</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">11</span>-<span class="number">27</span> <span class="number">23</span>:<span class="number">14</span>:<span class="number">34</span><span class="variable">.355643</span>+<span class="number">0800</span> allocmessage[<span class="number">81487</span>:<span class="number">9784814</span>] string1 address:<span class="number">0</span>x1103f16f8</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">11</span>-<span class="number">27</span> <span class="number">23</span>:<span class="number">14</span>:<span class="number">34</span><span class="variable">.355714</span>+<span class="number">0800</span> allocmessage[<span class="number">81487</span>:<span class="number">9784814</span>] string2 address:<span class="number">0</span>x1103fb878</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">11</span>-<span class="number">27</span> <span class="number">23</span>:<span class="number">14</span>:<span class="number">34</span><span class="variable">.355779</span>+<span class="number">0800</span> allocmessage[<span class="number">81487</span>:<span class="number">9784814</span>] string3 address:<span class="number">0</span>x1103fb878</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">11</span>-<span class="number">27</span> <span class="number">23</span>:<span class="number">14</span>:<span class="number">34</span><span class="variable">.355851</span>+<span class="number">0800</span> allocmessage[<span class="number">81487</span>:<span class="number">9784814</span>] string4 address:<span class="number">0</span>x1103fb878</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">11</span>-<span class="number">27</span> <span class="number">23</span>:<span class="number">14</span>:<span class="number">34</span><span class="variable">.355940</span>+<span class="number">0800</span> allocmessage[<span class="number">81487</span>:<span class="number">9784814</span>] string5 address:<span class="number">0</span>xb716bea187e38d28</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">11</span>-<span class="number">27</span> <span class="number">23</span>:<span class="number">14</span>:<span class="number">34</span><span class="variable">.356021</span>+<span class="number">0800</span> allocmessage[<span class="number">81487</span>:<span class="number">9784814</span>] string6 address:<span class="number">0</span>x10fdce0e8</span></pre></td></tr></table></figure>

<p>é€šè¿‡ä»¥ä¸Šä»£ç å¯ä»¥çœ‹å‡ºï¼Œ<code>Person</code>ç±»åˆ›å»ºçš„å¯¹è±¡ï¼Œåœ¨<code>alloc</code>åˆ†é…å†…å­˜ç©ºé—´ä¸åˆå§‹åŒ–åçš„åœ°å€æ˜¯ä¸€è‡´çš„ï¼Œä¹Ÿå°±æ˜¯è¯´<code>init</code>åˆå§‹åŒ–æ–¹æ³•åªæ˜¯å®Œæˆäº†æˆ‘ä»¬è¦†ç›–æ–¹æ³•çš„èµ‹å€¼åˆå§‹åŒ–æ“ä½œã€‚è€Œ<code>NSString</code>åˆ›å»ºçš„å¯¹è±¡åœ¨<code>alloc</code>åˆ†é…å†…å­˜ç©ºé—´åï¼Œåˆå§‹åŒ–<code>init</code>æ–¹æ³•åˆä¸€æ¬¡å®Œæˆäº†åˆ†é…ç©ºé—´çš„æ“ä½œï¼Œé‡æ–°åˆ†é…äº†å†…å­˜åœ°å€ã€‚</p>
<p>è€Œé€šè¿‡åŸºæœ¬çš„<code>init</code>åˆå§‹åŒ–æ–¹æ³•åˆ†é…çš„å†…å­˜åœ°å€æ˜¯ä¸€è‡´çš„ï¼Œæ— è®ºå¤šæ¬¡è°ƒç”¨ä¹Ÿä¸ä¼šæ”¹å˜ï¼Œå³æŒ‡å‘äº†åŒä¸€å—å†…å­˜åŒºåŸŸã€‚è€Œ<code>initWithFormat</code>ï¼Œ<code>initWithString</code>ç­‰å¸¦å‚æ•°çš„åˆå§‹åŒ–æ–¹æ³•åˆ™é‡æ–°åˆ†é…äº†ä¸åŒçš„å†…å­˜ç©ºé—´ã€‚</p>
<p>PSï¼šé€šè¿‡ä»¥ä¸Šä»£ç å¯ä»¥å‘ç°ï¼Œç±»ç°‡<code>alloc</code>åˆ†é…å†…å­˜ç©ºé—´åï¼Œ<code>init</code>æ–¹æ³•åˆä¸€æ¬¡é‡æ–°åˆ†é…äº†å†…å­˜ç©ºé—´ï¼Œåˆä¸€æ¬¡å®Œæˆäº†å¼€è¾Ÿåœ°å€çš„æ“ä½œã€‚è€Œéç±»ç°‡çš„<code>Person</code>ç±»åˆ™æ— æ­¤æ“ä½œã€‚</p>
<p>åœ¨å…³äº<code>Initializers</code>çš„å®˜æ–¹æ–‡æ¡£ä¸­æœ‰è¿™æ ·çš„å™è¿°ï¼š</p>
<blockquote>
<p>Although <code>init...</code> methods are required by their method signature to return an object, that object is not necessarily the one that was most recently allocatedâ€”the receiver of the <code>init...</code> message. In other words, the object you get back from an initializer might not be the one you thought was being initialized.</p>
</blockquote>
<p>PS:å¤§æ¦‚æ„æ€æ˜¯è¯´ï¼šè™½ç„¶<code>init</code>é€šè¿‡æ–¹æ³•è¿”å›äº†ä¸€ä¸ªå¯¹è±¡ï¼Œä½†è¿™ä¸ªè¿™ä¸ªå¯¹è±¡å¹¶ä¸ä¸€å®šæ˜¯æ‚¨æœ€è¿‘åˆ†é…çš„å¯¹è±¡ã€‚æ¢å¥è¯è¯´ï¼Œè¿”å›çš„å¯¹è±¡å¹¶ä¸ä¸€å®šæ˜¯ä½ è®¤ä¸ºçš„åˆå§‹åŒ–æ–¹æ³•è¿”å›çš„å¯¹è±¡ã€‚</p>
<p>è¿™äº›æˆ‘ä»¬åœ¨ç±»ç°‡çš„æ¨¡å¼ä¸­ä¹Ÿå¾—åˆ°äº†éªŒè¯ã€‚</p>
<h4 id="å››ã€ç±»ç°‡çš„å®ç°"><a href="#å››ã€ç±»ç°‡çš„å®ç°" class="headerlink" title="å››ã€ç±»ç°‡çš„å®ç°"></a>å››ã€ç±»ç°‡çš„å®ç°</h4><p>æ”¹é€ <code>Person</code>ç±»ï¼Œ<code>.h</code>æ–‡æ–‡ä»¶ä»£ç (5-1)ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NS_ASSUME_NONNULL_BEGIN</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSUInteger</span>, MWPersonType) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    MWPTypeProgrammer,</span></pre></td></tr><tr><td class="code"><pre><span class="line">    MWPTypeDesigner,</span></pre></td></tr><tr><td class="code"><pre><span class="line">    MWPTypeTester,</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">instancetype</span>)initWithPersonType:(MWPersonType)type;</span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)work;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@end</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">NS_ASSUME_NONNULL_END</span></span></pre></td></tr></table></figure>

<p><code>.m</code>æ–‡ä»¶ä»£ç (5-2)ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Person.h"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"MWPersonProgrammer.h"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"MWPersonDesigner.h"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"MWPersonTester.h"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">instancetype</span>)initWithPersonType:(MWPersonType)type &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="keyword">switch</span> (type) &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="keyword">case</span> MWPTypeProgrammer:</span></pre></td></tr><tr><td class="code"><pre><span class="line">            <span class="keyword">return</span> <span class="keyword">self</span> = [[MWPersonProgrammer alloc] init];</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="keyword">case</span> MWPTypeDesigner:</span></pre></td></tr><tr><td class="code"><pre><span class="line">            <span class="keyword">return</span> <span class="keyword">self</span> = [[MWPersonDesigner alloc] init] ;</span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="keyword">case</span> MWPTypeTester:</span></pre></td></tr><tr><td class="code"><pre><span class="line">            <span class="keyword">return</span> <span class="keyword">self</span> = [[MWPersonTester alloc] init];</span></pre></td></tr><tr><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)work &#123;</span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="comment">//do something</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="keyword">@end</span></span></pre></td></tr></table></figure>

<p>åˆ†åˆ«å®ç°<code>MWPersonProgrammer</code>ï¼Œ<code>MWPersonDesigner</code>ï¼Œ<code>MWPersonTester</code>ï¼Œå¹¶å…¨éƒ¨ç»§æ‰¿äº<code>Person</code>ç±»ï¼Œå¹¶åœ¨<code>.m</code>æ–‡ä»¶ä¸­å®ç°è‡ªå·±çš„<code>work</code>æ–¹æ³•ã€‚</p>
<h4 id="äº”ã€å¼•ç”³"><a href="#äº”ã€å¼•ç”³" class="headerlink" title="äº”ã€å¼•ç”³"></a>äº”ã€å¼•ç”³</h4><p>æˆ‘ä»¬ç†Ÿæ‚‰çš„<code>self = [super init]</code>è¿™ç§å†™æ³•ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªåŸå› å°±æ˜¯ç±»ç°‡çš„æ¨¡å¼ã€‚å› ä¸ºè¿”å›ç±»å‹å¹¶ä¸ä¸€å®šæ˜¯å½“å‰ç±»å‹ã€‚ä¸Šé¢çš„ä¾‹å­ï¼Œå½“æˆ‘ä»¬åˆå§‹åŒ–<code>Person</code>çš„å¯¹è±¡æ—¶ï¼Œå…¶è¿”å›çš„å¯¹è±¡å¹¶ä¸æ˜¯<code>Person</code>å¯¹è±¡ã€‚<code>self = [super init]</code>å†™æ³•å¹¶ä¸ä¼šå¯¹<code>self</code>çš„æŒ‡å‘é€ æˆä»»ä½•å½±å“ï¼Œ<code>self</code>æ€»æ˜¯æŒ‡å‘å½“å‰ç±»ï¼Œçˆ¶ç±»çš„æŒ‡é’ˆå¯ä»¥æŒ‡å‘å­ç±»ã€‚ä¸»è¦çš„ç›®çš„å°±æ˜¯ç¡®ä¿çˆ¶ç±»åˆå§‹åŒ–æˆåŠŸï¼Œä¸ä¼šè¿”å›<code>nil</code>ã€‚</p>
<h4 id="å…­ã€ç»“è¯­"><a href="#å…­ã€ç»“è¯­" class="headerlink" title="å…­ã€ç»“è¯­"></a>å…­ã€ç»“è¯­</h4><p>OCä¸­ç±»ç°‡çš„æ¨¡å¼è¢«å¤§é‡ä½¿ç”¨ï¼Œå¦‚<code>NSNumber</code>ï¼Œ<code>NSArray</code>ï¼Œ<code>UIButton</code>ï¼Œ<code>NSDictionary</code>ç­‰ã€‚ç±»ç°‡å¹¶éæ— æ³•ç»§æ‰¿ï¼Œè€Œæ˜¯éœ€è¦å®ç°ç‰¹å®šçš„æ–¹æ³•ç­‰ã€‚</p>
]]></content>
      <categories>
        <category>ç§»åŠ¨å¼€å‘</category>
        <category>IOSå¼€å‘</category>
      </categories>
      <tags>
        <tag>ObjC</tag>
        <tag>IOS</tag>
        <tag>Objective-C</tag>
        <tag>ç±»ç°‡</tag>
      </tags>
  </entry>
</search>
